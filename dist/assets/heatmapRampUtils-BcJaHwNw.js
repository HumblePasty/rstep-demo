const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CgLC99fU.js","./index-C6GyxWqK.css"])))=>i.map(i=>d[i]);
import{b1 as b,br as I,_ as d,bI as C,dV as y,aO as c,ox as V}from"./index-CgLC99fU.js";import{j as E,$ as x}from"./utils-CJGPEsa3.js";const $=/^-?(\d+)(\.(\d+))?$/i;function R(t,n){return t-n}function U(t,n){let e,l;return e=Number(t.toFixed(n)),e<t?l=e+1/10**n:(l=e,e-=1/10**n),e=Number(e.toFixed(n)),l=Number(l.toFixed(n)),[e,l]}function N(t,n,e,l,o){const a=O(t,n,e,l),i=a.previous==null||a.previous<=o,r=a.next==null||a.next<=o;return i&&r||a.previous+a.next<=2*o}function w(t){const n=String(t),e=n.match($);if(e!=null&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(n.toLowerCase().includes("e")){const l=n.split("e"),o=l[0],a=l[1];if(o&&a){const i=Number(o);let r=Number(a);const u=r>0;u||(r=Math.abs(r));const s=w(i);return u?(s.integer+=r,r>s.fractional?s.fractional=0:s.fractional-=r):(s.fractional+=r,r>s.integer?s.integer=1:s.integer-=r),s}}return{integer:0,fractional:0}}function O(t,n,e,l){const o={previous:null,next:null};if(e!=null){const a=t-e,i=n-e-a;o.previous=Math.floor(Math.abs(100*i/a))}if(l!=null){const a=l-t,i=l-n-a;o.next=Math.floor(Math.abs(100*i/a))}return o}function G(t,n={}){const e=t.slice(),{tolerance:l=2,strictBounds:o=!1,indexes:a=e.map((i,r)=>r)}=n;a.sort(R);for(let i=0;i<a.length;i++){const r=a[i],u=e[r],s=r===0?null:e[r-1],A=r===e.length-1?null:e[r+1],p=w(u).fractional;if(p){let f,m=0,g=!1;for(;m<=p&&!g;){const h=U(u,m);f=o&&i===0?h[1]:h[0],g=N(u,f,s,A,l),m++}g&&(e[r]=f)}}return e}const _={maximumFractionDigits:20};function M(t){return b(t,_)}const B="<",T=">";function Q(t,n,e,l){let o="";return n===0?o=`${B} `:n===e&&(o=`${T} `),o+(l?E(t,l):M(t))}const P=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function F(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const n=t.visualVariables.find(i=>i.type==="color");if(!n)return null;let e=null,l=null;if(n.stops){if(n.stops.length===1)return n.stops[0].color;e=n.stops[0].value,l=n.stops[n.stops.length-1].value}const o=e!=null&&l!=null?e+(l-e)/2:0,{getColor:a}=await d(async()=>{const{getColor:i}=await import("./index-CgLC99fU.js").then(r=>r.Ar);return{getColor:i}},__vite__mapDeps([0,1]),import.meta.url);return a(n,o)??null}async function z(t,n){const e=t.trailCap,l=t.trailWidth||1,o=n||await F(t)||t.color;return new I({cap:e,color:o,width:l})}function L(t,n){var e,l;if(!n.field)return null;if("featureReduction"in t)switch((e=t.featureReduction)==null?void 0:e.type){case"cluster":case"binning":{const o=t.featureReduction.fields.find(({name:a})=>a.toLowerCase()===n.field.toLowerCase());return o&&"getField"in t?t.getField(o.onStatisticField):null}}return"getField"in t?(l=t.getField)==null?void 0:l.call(t,n.field):null}function q(t,n){var l,o,a;const e="popupTemplate"in t?(l=t.popupTemplate)==null?void 0:l.fieldInfos:null;if(e!=null&&e.length&&n)return(a=(o=e.find(i=>{var r;return((r=i.fieldName)==null?void 0:r.toLowerCase())===n.toLowerCase()}))==null?void 0:o.format)==null?void 0:a.dateFormat}function H(t,n,e){var a,i,r,u;const l=L(t,n);if(!l||!x(l)&&!C(l))return null;let o=q(t,l.name);if(!o&&l.type==="date"){let s=0,A=0;n.stops?(s=((i=(a=n.stops)==null?void 0:a.at(0))==null?void 0:i.value)??s,A=((u=(r=n.stops)==null?void 0:r.at(-1))==null?void 0:u.value)??A):"minDataValue"in n&&"maxDataValue"in n&&(s=n.minDataValue??s,A=n.maxDataValue??A),o=A-s>2*y.days?"short-date":"short-date-short-time"}return{fieldType:l.type,format:o,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:e,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}}}function Z(t){var n,e;if("authoringInfo"in t)return(e=(n=t.authoringInfo)==null?void 0:n.visualVariables)==null?void 0:e.find(({theme:l})=>l==="reference-size")}const j=new c([64,64,64]);function v(t,n){const e=[],l=t.length-1;return t.length===5?e.push(0,2,4):e.push(0,l),t.map((o,a)=>e.includes(a)?Q(o,a,l,n):null)}async function X(t,n,e){let l=!1,o=[],a=[];if(t.stops){const s=t.stops;o=s.map(A=>A.value),l=s.some(A=>!!A.label),l&&(a=s.map(A=>A.label))}const i=o[0],r=o[o.length-1];if(i==null&&r==null)return null;const u=l?null:v(o,e);return(await Promise.all(o.map(async(s,A)=>({value:s,color:t.type==="opacity"?await k(s,t,n):(await d(async()=>{const{getColor:p}=await import("./index-CgLC99fU.js").then(f=>f.Ar);return{getColor:p}},__vite__mapDeps([0,1]),import.meta.url)).getColor(t,s),label:l?a[A]:(u==null?void 0:u[A])??""})))).reverse()}async function k(t,n,e){const l=new c(e??j),o=(await d(async()=>{const{getOpacity:a}=await import("./index-CgLC99fU.js").then(i=>i.Ar);return{getOpacity:a}},__vite__mapDeps([0,1]),import.meta.url)).getOpacity(n,t);return o!=null&&(l.a=o),l}function Y(t){let n=!1,e=[],l=[];e=t.map(r=>r.value),n=t.some(r=>!!r.label),n&&(l=t.map(r=>r.label??""));const o=e[0],a=e[e.length-1];if(o==null&&a==null)return null;const i=n?null:v(e);return e.map((r,u)=>({value:r,color:D(r,t),label:n?l[u]:(i==null?void 0:i[u])??""})).reverse()}function D(t,n){const{startIndex:e,endIndex:l,weight:o}=K(t,n);if(e===l)return n[e].color;const a=c.blendColors(n[e].color,n[l].color,o);return new c(a)}function K(t,n){let e=0,l=n.length-1;return n.some((o,a)=>t<o.value?(l=a,!0):(e=a,!1)),{startIndex:e,endIndex:l,weight:(t-n[e].value)/(n[l].value-n[e].value)}}function J(t,n){let e=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((l,o)=>{o===0?e.push({value:n.max,color:new c(l.toColor),label:"high"}):e.push({value:null,color:new c(l.toColor),label:""}),o===t.colorRamps.length-1?e.push({value:n.min,color:new c(l.fromColor),label:"low"}):e.push({value:null,color:new c(l.fromColor),label:""})});else{let l,o;t&&t.type==="algorithmic"?(l=t.fromColor,o=t.toColor):(l=[0,0,0,1],o=[255,255,255,1]),e=[{value:n.max,color:new c(o),label:"high"},{value:n.min,color:new c(l),label:"low"}]}return e}function tt(t){if(!t.colorStops)return[];const n=[...t.colorStops].filter(l=>{var o;return((o=l.color)==null?void 0:o.a)>0});let e=n.length-1;if(n&&n[0]){const l=n[e];l&&l.ratio!==1&&(n.push(new V({ratio:1,color:l.color})),e++)}return n.map((l,o)=>{var i,r;let a="";return o===0?a=((i=t.legendOptions)==null?void 0:i.minLabel)||"low":o===e&&(a=((r=t.legendOptions)==null?void 0:r.maxLabel)||"high"),{color:l.color,label:a,ratio:l.ratio}}).reverse()}export{T as a,D as b,Z as c,Y as d,tt as e,J as f,F as g,H as h,w as i,X as j,O as l,B as o,z as p,Q as r,P as s,G as u};
