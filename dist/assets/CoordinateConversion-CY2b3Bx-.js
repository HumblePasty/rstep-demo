const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-DlufD1Wj.js","./index-CW6gHi3a.js","./index-C6GyxWqK.css","./calcite-checkbox-CgxxSJf9.js","./calcite-input-BKC7kfZC.js","./input2-B5IiZeOu.js","./Validation-C-kZUWUF.js","./input-j1u1wOBY.js","./input-message-BHkzXRKV.js","./progress-D7J4sG-N.js","./calcite-label-BRdcXbax.js","./calcite-option-EWvrCJ6e.js","./calcite-select-DZ9v8zsS.js"])))=>i.map(i=>d[i]);
import{bV as J,r,o as c,p as V,bY as Q,a9 as I,d3 as q,jm as K,mP as Y,k as S,mQ as Z,de as X,w as P,b as w,hr as ee,ab as te,b5 as W,bv as k,iK as oe,cu as z,iM as ie,iN as se,_ as y,br as n,bt as M,nb as ne,nc as O,nd as re,iQ as B}from"./index-CW6gHi3a.js";import{p as ae,c as D,u as le,m as de}from"./formatUtils-BXKfRA-p.js";import{t as ce}from"./GoTo-D23tvqtp.js";import{e as G}from"./Heading-fz-dJAMO.js";import{i as pe}from"./legacyIcon-BW3-0ey6.js";import{t as f}from"./accessibleHandler-zttpahxM.js";import"./number-DJ1nw-kS.js";import"./coordinateFormatter-BT80Cx2W.js";let C=class extends J{constructor(o){super(o),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){var o,e;return(e=this.format)==null?void 0:e.getDisplayCoordinate((o=this.position)==null?void 0:o.coordinate)}};r([c({readOnly:!0})],C.prototype,"displayCoordinate",null),r([c()],C.prototype,"format",void 0),r([c()],C.prototype,"position",void 0),C=r([V("esri.widgets.CoordinateConversion.support.Conversion")],C);const T=C,$={default:"default",crosshair:"crosshair"},he=new W([0,0,500]),ue="xy",ve=["mgrs","utm","usng","dd","dms","ddm"],A="esri__coordinateConversionWidgetState",b={conversions:"conversions",formats:"formats",view:"view",viewChange:"view-change"},_e="esri/images/search/search-symbol-32.png";let g=class extends ce(Q.EventedAccessor){constructor(e){super(e),this._conversionPromise=null,this._locationGraphic=null,this._pointerCount=0,this.conversions=new I,this.formats=new I,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new I,this.locationSymbol=new q({url:K(_e),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){const e=async()=>this.messages=await Y("esri/widgets/CoordinateConversion/t9n/CoordinateConversion");this.formats.addMany(ae()),e().then(()=>{if(!this.destroyed&&(D(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach(t=>{t.viewModel=this,this.addHandles(S(()=>t.currentPattern,this._saveWidgetState),t.name??"unnamed-format")}),this.addHandles(this.conversions.on("change",this._handleConversionChange),b.conversions),this.addHandles(this.formats.on("change",this._handleFormatChange),b.formats),this.addHandles(Z(()=>{e().then(()=>{D(this.messages,this.formats)})})),X().then(()=>{this.formatterAvailable=!0}).catch(t=>{P.getLogger(this).error(new w("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:t})),this.formatterAvailable=!1,this._filterFormatsAndConversions()}).then(()=>this.addHandles(S(()=>this.view,this._handleViewChange,ee),b.viewChange)),this.conversions.length===0)){const t=this.formats.find(i=>i.name===ue)||this.formats.at(0);this.conversions.add(new T({format:t}))}})}destroy(){this.removeHandles(),this._cleanUpView(this.view),this.view=null}castConversions(e){return this._castToConversions(e)}set currentLocation(e){this._set("currentLocation",e),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(e){switch(e){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",e);break;case"live":this._startLiveMode(),this._set("mode",e)}}get mode(){return this._get("mode")||"live"}get state(){const{messages:e,view:t}=this,i=t==null?void 0:t.ready;return e?i?"ready":t?"loading":"disabled":"disabled"}get storage(){const{storageType:e}=this;return e==="session"?sessionStorage:localStorage}get waitingForConversions(){return this._conversionPromise!=null}setLocation(e){var i,s;if(this._locationGraphic&&((i=this.view)==null||i.graphics.remove(this._locationGraphic)),!e)return;const t=e.clone();t.hasZ&&(t.z=void 0),this._locationGraphic=new te({geometry:t,symbol:this.locationSymbol}),(s=this.view)==null||s.graphics.add(this._locationGraphic)}async convert(e,t){if(!le(t))throw new w("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:t});return Promise.resolve().then(()=>e.convert(t))}async goToLocation(e){var a,d,u;const{view:t}=this;if(!t)throw new w("coordinate-conversion:go-to-failed","no view");const i=t.type==="3d"?t.clippingArea:null,s=(d=(a=t.map)==null?void 0:a.basemap)==null?void 0:d.baseLayers;if(i||(s==null?void 0:s.length)>0){const _=i??((u=s.at(0))==null?void 0:u.fullExtent);if(_!=null&&!_.contains(e))throw new w("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:e})}return this.callGoTo({target:e})}pause(){this.currentLocation=null,this.removeHandles(b.view),this.view&&(this.view.cursor=$.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic))}async previewConversion(e,t=this.currentLocation||he){return(await H(e,t)).displayCoordinate}resume(){this.mode==="capture"?this._startCaptureMode():this._startLiveMode()}reverseConvert(e,t){return t.reverseConvert(e)}async updateConversions(e,t){if((t==null?void 0:t.type)!=="point")throw this._clearConversions(this.conversions),new w("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:t});return this._convertMany(e,t)}_castToConversions(e){const t=new I;return e.forEach(i=>{let s=null;if(i instanceof T)s=i;else if(typeof i=="string"){const a=this.formats.find(d=>d.name===i);a&&(s=new T({format:a}))}s&&t.add(s)}),t}_cleanUpView(e){e&&(this._locationGraphic&&e.graphics.remove(this._locationGraphic),this.removeHandles(b.view),e.cursor=$.default)}_clearConversions(e){e.forEach(t=>{t.position={location:null,coordinate:null}})}async _convertMany(e,t){return Promise.all(e.map(i=>H(i,t)))}_handleConversionChange(e){for(const t of e.added){const{format:i}=t;i&&(i.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(i,this.currentLocation).then(s=>{t.position=s,this._set("waitingForConversions",!1)})))}this._saveWidgetState()}_handleFormatChange(e){e.added.forEach(t=>{this.addHandles(S(()=>t.currentPattern,this._saveWidgetState),t.name??"unnamed-format"),t.viewModel=this}),e.removed.forEach(t=>{t.viewModel=null;const i=this.conversions.filter(s=>s.format===t);this.conversions.removeMany(i),t.name&&this.removeHandles(t.name)})}_loadWidgetState(){try{const e=JSON.parse(this.storage.getItem(A));e&&this._setWidgetState(e)}catch(e){P.getLogger(this).error(new w("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:e}))}}_startCaptureMode(){this.removeHandles(b.view),this.view&&(this.view.cursor=$.crosshair,this.currentLocation&&this.setLocation(this.currentLocation),this.addHandles(this.view.on("click",this._onClick),b.view))}_startLiveMode(){this._pointerCount=0,this.removeHandles(b.view),this.view&&(this.view.cursor=$.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic),this.addHandles([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],b.view))}_handleViewChange(e,t){t&&t!==e&&this._cleanUpView(t),e&&(this.mode==="capture"?this._startCaptureMode():this._startLiveMode(),t&&this._filterFormatsAndConversions())}_onClick(e){var t;if(e.button===0){const i=(t=this.view)==null?void 0:t.toMap(e),s=i==null?void 0:i.normalize();this.setLocation(s),this.currentLocation=s}}_onPointerDown(e){var i;const{pointerType:t}=e;if(this._pointerCount++,(t==="touch"||t==="pen")&&this._pointerCount===1){const s=(i=this.view)==null?void 0:i.toMap(e);this.currentLocation=s==null?void 0:s.normalize()}}_onPointerMove(e){var i;const{pointerType:t}=e;if(t==="mouse"||this._pointerCount===1){const s=(i=this.view)==null?void 0:i.toMap(e);this.currentLocation=s==null?void 0:s.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(e){try{e.formats.forEach(t=>{const i=this.formats.find(s=>s.name===t.name);i&&e.locale===k()&&t.currentPattern&&(i.currentPattern=t.currentPattern),i&&t.index>=0&&this.conversions.add(new T({format:i}))})}catch(t){P.getLogger(this).warn(new w("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:t}))}}_saveWidgetState(){if(!this.storageEnabled)return;const e=this._toJSON();try{this.storage.setItem(A,JSON.stringify({formats:e,locale:k()}))}catch(t){P.getLogger(this).error(new w("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:t}))}}async _updateConversions(){try{await this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}}_toJSON(){return this.formats.filter(e=>{const t=e.name;return t==="xy"||t==="basemap"||de(t)}).map(e=>({name:e.name,currentPattern:e.currentPattern,defaultPattern:e.defaultPattern,index:this.conversions.findIndex(t=>t.format===e)})).sort((e,t)=>e.index-t.index).toArray()}_filterFormatsAndConversions(){const{formatterAvailable:e,conversions:t,formats:i}=this;e||this.addHandles(oe(()=>{var s;return(s=this.view)==null?void 0:s.spatialReference},s=>{const a=s.isWebMercator||s.isWGS84,d=i.filter(v=>{const{name:m}=v;return!!me(m)||m==="xy"&&!a}),u=this.filteredFormats.filter(v=>v.name==="xy"&&a&&!this.formats.includes(v)),_=t.filter(v=>d.includes(v.format));i.removeMany(d),t.removeMany(_),this.filteredFormats.addMany(d.filter(v=>!this.filteredFormats.includes(v))),i.addMany(u)},{once:!0,initial:!0}),b.view)}};async function H(o,e){var t;try{o.position=await((t=o.format)==null?void 0:t.convert(e))}catch{o.position=null}return o}function me(o){return ve.includes(o)}r([c()],g.prototype,"conversions",void 0),r([z("conversions")],g.prototype,"castConversions",null),r([c({type:W})],g.prototype,"currentLocation",null),r([c()],g.prototype,"formats",void 0),r([c()],g.prototype,"messages",void 0),r([c()],g.prototype,"mode",null),r([c()],g.prototype,"filteredFormats",void 0),r([c({readOnly:!0})],g.prototype,"state",null),r([c()],g.prototype,"locationSymbol",void 0),r([c({readOnly:!0,dependsOn:["storageType"]})],g.prototype,"storage",null),r([c()],g.prototype,"storageEnabled",void 0),r([c()],g.prototype,"storageType",void 0),r([c({readOnly:!0})],g.prototype,"waitingForConversions",null),r([c()],g.prototype,"view",void 0),g=r([V("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],g);const N=g,h="esri-coordinate-conversion",l={base:h,captureMode:`${h}--capture-mode`,noBasemap:`${h}--no-basemap`,popup:`${h}__popup`,clipboardPopup:`${h}__clipboard-popup`,conversionList:`${h}__conversion-list`,conversionRow:`${h}__row`,coordDisplay:`${h}__display`,expandButton:`${h}__expand-button`,expanded:`${h}__conversions-view--expanded`,expandDown:`${h}__conversions-view--expand-down`,expandUp:`${h}__conversions-view--expand-up`,conversionsView:`${h}__conversions-view`,rowSelect:`${h}__select-row`,toolDisplay:`${h}__tools`,modeToggle:`${h}__mode-toggle`,rowButton:`${h}__row-button`,coordinateInput:`${h}__input-coordinate`,inputForm:`${h}__input-form`,inputFormGroup:`${h}__input-group`,inputSelect:`${h}__input-select`,sectionHeading:`${h}__heading`,patternInput:`${h}__pattern-input`,settings:`${h}__settings`,settingsFormGroup:`${h}__settings-group`,settingsFormGroupHorizontal:`${h}__settings-group-horizontal`,previewCoordinate:`${h}__preview-coordinate`},R={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0},ge=750,be=2500;let p=class extends ie{constructor(o,e){super(o,e),this._popupMessage=null,this._popupTimeoutId=void 0,this._clipboardPopupTimeoutId=void 0,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new N,this.visibleElements={...R}}loadDependencies(){return se({button:()=>y(()=>import("./calcite-button-DlufD1Wj.js"),__vite__mapDeps([0,1,2]),import.meta.url),checkbox:()=>y(()=>import("./calcite-checkbox-CgxxSJf9.js"),__vite__mapDeps([3,1,2]),import.meta.url),input:()=>y(()=>import("./calcite-input-BKC7kfZC.js"),__vite__mapDeps([4,5,1,2,6,7,8,9]),import.meta.url),label:()=>y(()=>import("./calcite-label-BRdcXbax.js"),__vite__mapDeps([10,1,2]),import.meta.url),option:()=>y(()=>import("./calcite-option-EWvrCJ6e.js"),__vite__mapDeps([11,1,2]),import.meta.url),select:()=>y(()=>import("./calcite-select-DZ9v8zsS.js"),__vite__mapDeps([12,1,2,6,8]),import.meta.url)})}get conversions(){return this.viewModel.conversions}set conversions(o){this.viewModel.conversions=o}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(o){this.viewModel.currentLocation=o}get formats(){return this.viewModel.formats}set formats(o){this.viewModel.formats=o}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(o){this.viewModel.goToOverride=o}get icon(){return"coordinate-system"}set icon(o){this._overrideIfSome("icon",o)}get label(){var o;return((o=this.messages)==null?void 0:o.widgetLabel)??""}set label(o){this._overrideIfSome("label",o)}get mode(){return this.viewModel.mode}set mode(o){this.viewModel.mode=o}set multipleConversions(o){o===!1&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",o)}get multipleConversions(){const o=this._get("multipleConversions");return typeof o!="boolean"||o}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(o){this.viewModel.locationSymbol=o}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(o){this.viewModel.storageEnabled=o}get storageType(){return this.viewModel.storageType}set storageType(o){this.viewModel.storageType=o}get view(){return this.viewModel.view}set view(o){this.viewModel.view=o}castVisibleElements(o){return{...R,...o}}reverseConvert(o,e){return this.viewModel.reverseConvert(o,e)}render(){var u,_;const o=(u=this.viewModel)==null?void 0:u.state,e=o==="disabled"?n("div",{key:"esri-coordinate__no-basemap"},(_=this.messages)==null?void 0:_.noBasemap):null,t=!e&&this._inputVisible?this._renderInputForm():null,i=!e&&this._settingsVisible?this._renderSettings():null,s=e||t||i?null:this._renderConversionsView(),a=this._popupVisible?this._renderPopup():null,d={[l.captureMode]:this.mode==="capture",[M.disabled]:o==="loading",[l.noBasemap]:o==="disabled"};return n("div",{class:this.classes(l.base,M.widget,d)},a,e,s,i,t)}_addConversion(o){const e=o.target,t=e.selectedOption.value,i=U(e);if(t==null||i==null)return;const s=new T({format:t});e.value="default",i>=0?(this.conversions.removeAt(i),this.conversions.add(s,i)):this.conversions.add(s)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((o,e)=>{const t=e.format;return t!=null&&t.hasDisplayProperties?t:o},null)||this.formats.find(o=>o.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(o){var t,i;const e=(t=we(o.currentTarget))==null?void 0:t.displayCoordinate;e!=null&&((i=o.clipboardData)==null||i.setData("text/plain",e),this._showClipboardPopup(),o.preventDefault())}_processUserInput(o){const e=ne(o,"key"),t=this.viewModel;if(e!=="Enter"&&e)this._badInput&&(this._badInput=!1);else{const i=this._conversionFormat||this.conversions.at(0).format;if(!i)return;const s=this._coordinateInput.value;this._reverseConvert(s,i).then(a=>{this.mode==="capture"?t.resume():this.mode="capture",this.currentLocation=a,t.setLocation(a),this._onConvertComplete()}).catch(a=>{var d;P.getLogger(this).error(a),this._showPopup((d=this.messages)==null?void 0:d.invalidCoordinate),this._badInput=!0})}}async _reverseConvert(o,e){const t=this.viewModel,i=await e.reverseConvert(o);return this._goToEnabled&&i&&t.goToLocation(i).catch(s=>{var a;P.getLogger(this).warn(s),this._showPopup((a=this.messages)==null?void 0:a.locationOffBasemap)}),i}_setInputFormat(o){const e=o.target.selectedOption.value;e!=null&&(this._conversionFormat=e)}_setPreviewConversion(){var t,i;const o=this._findSettingsFormat(),e=this.viewModel;if(o){const s=this.conversions.find(a=>a.format===o);this._previewConversion=new T({format:o,position:{location:this.currentLocation,coordinate:(t=s==null?void 0:s.position)==null?void 0:t.coordinate}}),(i=this._previewConversion.position)!=null&&i.coordinate||e.previewConversion(this._previewConversion)}}_setSettingsFormat(o){const e=o.target.selectedOption.value;e!=null&&(this._settingsFormat=e,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hideClipboardPopup()},ge)}_showPopup(o,e=be){this._popupMessage=o,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hidePopup()},e)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(o){o.stopPropagation();const e=o.target,t=this._findSettingsFormat();t&&(t.currentPattern=e.value)}_renderConversion(o,e){const{messages:t}=this;if(!t)return n("li",null);const{format:i}=o,s=(i==null?void 0:i.label)??"",a=`${this.id}__list-item-${e}`,d=`${s} ${t.conversionOutputSuffix}`,u=e===0,_=u||this._expanded,v=u?this._renderFirstConversion(o):this._renderTools(e,o,a),m=u&&!o.displayCoordinate?t.noLocation:o.displayCoordinate,x=n("div",{"aria-label":m,class:l.coordDisplay,"data-conversion":o,role:"listitem",tabIndex:0,title:m??""},m),F=this._renderOptions(this.formats.filter(L=>L!==i));return _?n("li",{"aria-label":d,class:l.conversionRow,id:a,key:o,role:"group",tabIndex:0,title:d},n("calcite-select",{"aria-controls":a,bind:this,class:l.rowSelect,"data-index":e,label:t.selectFormat,scale:"s",onCalciteSelectChange:this._addConversion},n("calcite-option",{label:s.toUpperCase(),selected:!0},s.toUpperCase()),F),x,v):null}_renderCopyButton(o){const e=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:t}=this;return t?n("li",{"aria-label":t.copy,bind:this,class:this.classes(M.widgetButton,l.rowButton),"data-conversion":o,onclick:this._copyCoordinateOutput,oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:t.copy},e,n("span",{"aria-hidden":"true",class:pe.duplicate})):n("li",null)}_renderFirstConversion(o){const e=this.id,{messages:t,messagesCommon:i,multipleConversions:s,visibleElements:a}=this;if(!i||!t)return n("ul",null);const d=this.mode==="live"?t.captureMode:t.liveMode,u=this._expanded?i.collapse:i.expand,_=o.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(o):null,v=s&&a.expandButton&&this._renderIconButton({iconType:this._expanded?"chevron-down":"chevron-up",clickFunction:this._toggleExpand,classes:[l.expandButton],attributes:{"aria-controls":`${e}__${l.conversionList}`,label:u}}),m=!s&&a.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[l.modeToggle],attributes:{label:d}});return n("ul",{class:l.toolDisplay},_,v,m)}_renderInputForm(){const o=this._conversionFormat||this.conversions.at(0).format,e=this.formats.findIndex(m=>m.name===(o==null?void 0:o.name)),t=this.id,i=`${t}__${l.coordinateInput}`,s=`${t}__${l.coordinateInput}__header`,a=this._renderOptions(this.formats,!0,e),{messages:d,messagesCommon:u,headingLevel:_}=this;if(!u||!d)return n("div",null);const v=this._renderIconButton({iconType:O(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleInputVisibility,attributes:{label:u.back}});return n("div",{"aria-labelledby":s,class:l.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},n("div",{class:l.sectionHeading},v,n(G,{class:M.heading,id:s,level:_},d.inputCoordTitle)),n("div",{class:l.inputFormGroup},n("calcite-select",{"aria-controls":i,bind:this,class:l.inputSelect,label:d.selectFormat,scale:"s",onCalciteSelectChange:this._setInputFormat},a),n("calcite-input",{afterCreate:re,"aria-labelledby":s,bind:this,class:l.coordinateInput,"data-format":o,"data-node-ref":"_coordinateInput",id:i,onkeydown:this._processUserInput,placeholder:d.inputCoordTitle,required:!0,scale:"s",spellcheck:!1,status:this._badInput?"invalid":"idle"})),n("div",{class:l.inputFormGroup},n("calcite-label",{layout:"inline",scale:"s"},n("calcite-checkbox",{bind:this,checked:this._goToEnabled,onCalciteCheckboxChange:this._toggleGoTo}),d.goTo),n("calcite-button",{appearance:"outline",bind:this,kind:"neutral",onclick:this._processUserInput,type:"button",width:"auto"},d.convert)))}_renderConversionsView(){const{messages:o}=this;if(!o)return n("div",null);const e=`${this.id}__${l.conversionList}`,t=this._renderPrimaryTools(),i=this._renderOptions(this.formats),s=this.conversions.map((u,_)=>this._renderConversion(u,_)).toArray(),a=this._expanded?n("div",{class:l.conversionRow},n("calcite-select",{"aria-controls":e,bind:this,"data-index":-1,label:o.addConversion,scale:"s",onCalciteSelectChange:this._addConversion},n("calcite-option",{disabled:!0,selected:!0,value:"default"},o.addConversion),i),t):null,d={[l.expanded]:this._expanded,[l.expandUp]:this.orientation==="expand-up",[l.expandDown]:this.orientation==="expand-down"};return n("div",{class:this.classes(l.conversionsView,d),key:"esri-coordinate-conversion__main-view"},n("ul",{"aria-expanded":this._expanded?"true":"false",class:l.conversionList,id:e},s),a)}_renderOptions(o,e,t){var a;const i=this.conversions.at(0),s=(a=i.format)==null?void 0:a.name;return o.map((d,u)=>{const _=!(e||!i)&&(s===d.name||this.conversions.map(v=>{var m;return(m=v.format)==null?void 0:m.name}).includes(d.name));return n("calcite-option",{disabled:_,key:d.name??"unnamed-format",label:d.label.toUpperCase(),selected:u===t,value:d},d.label)}).toArray()}_renderPopup(){return n("div",{class:l.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){const{messages:o}=this;return o?n("div",{class:this.classes(l.popup,l.clipboardPopup),role:"alert"},o.copySuccessMessage):n("div",null)}_renderPrimaryTools(){const{messages:o,visibleElements:e}=this;if(!o)return n("ul",null);const t=this.mode==="live"?o.captureMode:o.liveMode,i=e.inputButton&&this._renderIconButton({iconType:"pencil",clickFunction:this._toggleInputVisibility,attributes:{label:o.inputCoordTitle}}),s=e.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[l.modeToggle],attributes:{label:t}}),a=e.settingsButton&&this._renderIconButton({iconType:"gear",clickFunction:this._toggleSettingsVisibility,attributes:{label:o.settingsTitle}});return n("ul",{class:l.toolDisplay},i,s,a)}_renderSettings(){var E;const o=this.id,e=`${o}__${l.patternInput}`,t=`${o}__${l.patternInput}__header`,i=`${o}__${l.previewCoordinate}`,s=this.formats.filter(j=>j.hasDisplayProperties),a=this._findSettingsFormat(),d=a?s.indexOf(a):-1,u=this._renderOptions(s,!0,d),_=a==null?void 0:a.currentPattern,{messages:v,messagesCommon:m,headingLevel:x}=this;if(!m||!v)return n("div",null);const F=this._renderIconButton({iconType:O(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleSettingsVisibility,attributes:{label:m.back}}),L=this._renderIconButton({iconType:"refresh",clickFunction:this._setDefaultPattern,attributes:{label:v.defaultPattern}});return n("div",{"aria-labelledby":t,class:l.settings,key:l.settings},n("div",{class:l.sectionHeading},F,n(G,{class:M.heading,id:t,level:x},v.settingsTitle)),n("div",{class:l.settingsFormGroup},n("label",{for:e},v.changeCoordinateDisplay),n("calcite-select",{bind:this,label:v.selectFormat,width:"full",onCalciteSelectChange:this._setSettingsFormat},u),n("div",{class:l.settingsFormGroupHorizontal},n("calcite-input",{"aria-controls":i,bind:this,class:l.patternInput,id:e,spellcheck:!1,type:"text",value:_,onCalciteInputInput:this._updateCurrentPattern}),L)),n("div",{class:l.settingsFormGroup},n("label",null,m.preview,n("div",{class:l.previewCoordinate,id:i,tabIndex:0},(E=this._previewConversion)==null?void 0:E.displayCoordinate))))}_renderIconButton(o){const{iconType:e,clickFunction:t,classes:i,attributes:s}=o;return n("calcite-button",{appearance:"transparent",bind:this,class:this.classes(i),iconStart:e,kind:"neutral",onclick:t,onkeydown:t,...s})}_renderTools(o,e,t){const i=e.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(e):null,{messages:s}=this;if(!s)return n("ul",null);const a=this._renderIconButton({iconType:"x",clickFunction:this._removeConversion,attributes:{"aria-controls":t,label:s.removeConversion,"data-index":o}});return n("ul",{class:l.toolDisplay,role:"listitem"},i,n("li",{class:this.classes(l.rowButton)},a))}_copyCoordinateOutput(o){const e=o.target;if(!("createTextRange"in document.body)){const t=window.getSelection(),i=document.createRange();i.selectNodeContents(e),t==null||t.removeAllRanges(),t==null||t.addRange(i)}document.execCommand("copy")}_removeConversion(o){const e=U(o.currentTarget);e!=null&&this.conversions.removeAt(e)}_setDefaultPattern(o){o.stopPropagation();const e=this._findSettingsFormat();e&&(e.currentPattern=e.defaultPattern)}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode=this.mode==="live"?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};r([c()],p.prototype,"conversions",null),r([c()],p.prototype,"currentLocation",null),r([c()],p.prototype,"formats",null),r([c()],p.prototype,"goToOverride",null),r([c()],p.prototype,"headingLevel",void 0),r([c()],p.prototype,"icon",null),r([c()],p.prototype,"label",null),r([c(),B("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],p.prototype,"messages",void 0),r([c(),B("esri/t9n/common")],p.prototype,"messagesCommon",void 0),r([c()],p.prototype,"mode",null),r([c()],p.prototype,"orientation",void 0),r([c()],p.prototype,"multipleConversions",null),r([c()],p.prototype,"locationSymbol",null),r([c()],p.prototype,"storageEnabled",null),r([c()],p.prototype,"storageType",null),r([c()],p.prototype,"view",null),r([c({type:N})],p.prototype,"viewModel",void 0),r([c()],p.prototype,"visibleElements",void 0),r([z("visibleElements")],p.prototype,"castVisibleElements",null),r([f()],p.prototype,"_copyCoordinateOutput",null),r([f()],p.prototype,"_removeConversion",null),r([f()],p.prototype,"_setDefaultPattern",null),r([f()],p.prototype,"_toggleExpand",null),r([f()],p.prototype,"_toggleInputVisibility",null),r([f()],p.prototype,"_toggleMode",null),r([f()],p.prototype,"_toggleSettingsVisibility",null),p=r([V("esri.widgets.CoordinateConversion")],p);const Fe=p;function U(o){return o["data-index"]}function we(o){return o["data-conversion"]}export{Fe as default};
