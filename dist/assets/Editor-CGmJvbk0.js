const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-Dn1EUE6k.js","./index-iReJxP8N.js","./index-C6GyxWqK.css","./calcite-icon-CG93KzbT.js","./calcite-scrim-AMBqcegi.js","./calcite-label-0SkcO5DK.js","./calcite-radio-button-DN1jHyRu.js","./calcite-radio-button-group-CJGiqTEW.js","./Validation-DpVTY-4_.js","./input-message-Bxw2ubNv.js","./calcite-block-D8R8Hoik.js","./handle-lGMwN-By.js","./calcite-combobox-Dx1DfZri.js","./combobox-NH0B-WG8.js","./core-Cpfj44ZG.js","./filter-DLXSdvIM.js","./utils2-Bhwn2ag5.js","./combobox-item-Id086i_t.js","./calcite-combobox-item-wqobC9HP.js","./calcite-combobox-item-group-B5AHvFjX.js","./combobox-item-group-BNhCIfcn.js","./calcite-input-BJbMR36K.js","./input2-CoY8fj8g.js","./input-j1u1wOBY.js","./progress-BWKsX47I.js","./calcite-input-date-picker-BtxZvBQc.js","./input-text-BwNL0R2I.js","./calcite-input-message-CU5EsQ98.js","./calcite-input-number-C9hWOfZ7.js","./input-number-B5Kn5gKq.js","./calcite-input-time-picker-CV6WZwfD.js","./calcite-input-time-zone-joixbaE6.js","./calcite-list-CSiFAJ9a.js","./resources4-F8vB_VGv.js","./utils3-yYa_M45t.js","./calcite-list-item-DtqS7ygw.js","./calcite-loader-Bt4CsKoC.js","./calcite-notice-Bt_0bixh.js","./calcite-switch-BhcXTaI0.js","./calcite-text-area-BnIDUYgC.js","./throttle-QpwxM8lL.js","./symbolLayerUtils-Bt0u6V2_.js","./Upload-zMPX__2f.js","./progressUtils-CP1npzhE.js","./infoFor3D-BU6V8avP.js","./helpMessageUtils3d-C2BWg4G5.js","./calcite-accordion-Qbg8nNxp.js","./calcite-accordion-item-DZRPxygy.js","./calcite-flow-item-yCDGxbne.js","./calcite-flow-DAN3cZ6T.js"])))=>i.map(i=>d[i]);
import{ia as fe,_ as b,bG as f,mN as Ca,bZ as G,r,o as l,p as x,cN as as,ij as ss,Y as it,d as zt,F as Xe,eV as si,bV as ns,uO as Wi,O as ht,k as C,dM as mt,su as kt,uP as rs,uQ as We,uR as os,uS as ls,uT as Ui,eQ as Zt,bP as Ni,uU as ds,uV as us,b as P,uW as ps,uX as cs,pk as hs,eR as ms,pi as fs,uY as ys,cF as wi,fn as at,i3 as _t,dO as qt,J as Hi,M as q,aj as st,km as Ia,gS as ce,gT as he,tt as Gi,ak as Qe,uZ as gs,u_ as vs,fm as _s,c0 as jt,al as nt,b1 as ft,bY as ji,sv as ws,sw as bs,g_ as B,u$ as Bi,iZ as ks,pn as Fs,v0 as Cs,v1 as Is,pg as zi,lD as Es,i9 as bi,pl as Vs,bI as yt,bJ as Ce,v2 as xs,po as Ms,pj as $s,v3 as Ft,v4 as Zi,v5 as Ct,v6 as It,v7 as qi,v8 as Ts,v9 as As,id as ge,mO as ki,cP as Os,n as Le,kE as Dt,gG as Fi,i7 as Re,P as Ee,bH as gt,va as Pe,vb as Ss,sb as Ls,m as R,so as Rs,vc as Ps,sL as Ds,vd as Ws,sM as Us,i6 as Ci,bD as ve,a0 as Ns,cq as Hs,bt as Kt,hX as Wt,ve as Ea,nF as Gs,gR as js,vf as Bs,bN as zs,vg as Zs,vh as Va,kD as qs,kB as Ks,N as Ki,k3 as Bt,aT as Mt,i5 as xa,eF as Ii,vi as Ei,am as Ji,rg as Js,li as Qs,b$ as Ys,vj as Xs,aS as Qi,vk as Yi,k6 as en,aU as tn,aW as an,B as sn,aq as Jt,ap as nn,kX as rn,as as on,ar as ln,rf as Ma,rh as dn,kJ as ni,ka as un,vl as pn,q3 as cn,vm as Vi,t9 as xi,vn as hn,vo as mn,a_ as fn,vp as yn}from"./index-iReJxP8N.js";import{G as ri,U as Ut,a as oi,z as gn,V as Xi,N as ea,S as ta,b as ut,C as vn,F as _n,$ as ia,A as aa,Z as wn,R as bn,w as kn,v as Fn,g as Je,c as Cn,x as li,O as $a,J as In,j as En,T as Qt,q as Vn,B as xn,E as Mn,K as $n,Y as Tn,y as An,p as On,I as Sn,h as Ln}from"./Spinner-CqnsnV-A.js";import{e as et,n as pt}from"./Heading-BBrXYaau.js";import{e as Nt}from"./editableLayers-BiFd3gYd.js";import{$ as sa}from"./utils-CRigrOJq.js";import{K as Mi,W as Rn}from"./featureUtils-C3H-t3UV.js";import{createArcadeProfile as Pn,createArcadeExecutor as Dn}from"./arcade-BJT8xpb1.js";import{s as Ta}from"./ReactiveMap-05bFi4WI.js";import{V as Wn,f as di}from"./symbolUtils-CwIOeDwm.js";import{e as Un}from"./helpMessageUtils-M95XMmyR.js";import{e as Aa}from"./GraphicState-DFKHUg2c.js";import{h as Oa}from"./HighlightHelper-CzzHmQb_.js";import{a as Nn}from"./infoFor3D-BU6V8avP.js";import{l as Hn,m as Gn,i as jn}from"./uploadAssetErrors-Br3CoOQ1.js";import"./unitFormatUtils-DyLDOfDW.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./AttachmentInfo-C6gB8w-9.js";import"./legacyIcon-DkTFV6vi.js";import"./catalogUtils-DeI3Qqxj.js";import"./Basemap-D9uk5GRZ.js";import"./TimeOnly-BQxnHfCi.js";import"./ImmutableArray-BPVd6ESQ.js";import"./utils-B_IptSIW.js";import"./cimSymbolUtils-D2uV1o_m.js";import"./mat2df32-orApM5a3.js";import"./webStyleSymbolUtils-DqYMDVBn.js";import"./devEnvironmentUtils-CnNDiFMM.js";const Sa={danger:"exclamation-mark-circle",info:"information",success:"check",warning:"exclamation-mark-triangle",brand:void 0,neutral:void 0,inverse:void 0},Ue="esri-editor__prompt",Ne={base:Ue,header:`${Ue}__header`,heading:`${Ue}__header__heading`,message:`${Ue}__message`,divider:`${Ue}__divider`,actions:`${Ue}__actions`},Bn=()=>fe({button:()=>b(()=>import("./calcite-button-Dn1EUE6k.js"),__vite__mapDeps([0,1,2]),import.meta.url),icon:()=>b(()=>import("./calcite-icon-CG93KzbT.js"),__vite__mapDeps([3,1,2]),import.meta.url),scrim:()=>b(()=>import("./calcite-scrim-AMBqcegi.js"),__vite__mapDeps([4,1,2]),import.meta.url),label:()=>b(()=>import("./calcite-label-0SkcO5DK.js"),__vite__mapDeps([5,1,2]),import.meta.url),"radio-button":()=>b(()=>import("./calcite-radio-button-DN1jHyRu.js"),__vite__mapDeps([6,1,2]),import.meta.url),"radio-button-group":()=>b(()=>import("./calcite-radio-button-group-CJGiqTEW.js"),__vite__mapDeps([7,1,2,8,9]),import.meta.url)});function La({actions:t,context:e,headingLevel:i,message:a,title:s,...n}){const{primary:o,secondary:d}=t;let u;switch(e){case"danger":u="danger";break;case"info":u="brand";break;default:u="neutral"}const p=f("calcite-button",{afterCreate:c=>Ca(c),appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:u,onclick:o.action,width:d?"half":"full"},o.label),h=d&&f("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:u,onclick:d.action,width:"half"},d.label);return f("calcite-scrim",{"data-testid":"prompt",key:"prompt"},f("div",{class:`${Ne.base}--${e}`},f("div",{class:Ne.header},f("calcite-icon",{icon:Sa.warning}),f(et,{class:Ne.heading,level:i},s)),f("div",{class:Ne.message},a),zn(n)??f("div",{class:Ne.divider}),f("div",{class:Ne.actions},h,p)))}function zn({radios:t,onRadioSelection:e,defaultRadioSelection:i}){return t!=null&&t.length?f("calcite-radio-button-group",{name:"PromptChoiceList"},t.map(a=>f("calcite-label",{layout:"inline"},f("calcite-radio-button",{checked:a.value===i,value:a.value,onCalciteRadioButtonChange:()=>e==null?void 0:e(a.value)}),a.label))):void 0}const ee="esri-feature-form",Yt=`${ee}__group`,He=`${ee}__input`,Xt=`${ee}__related-records`,A={base:ee,form:`${ee}__form`,formHeader:`${ee}__form-header`,label:`${ee}__label`,labelTextContent:`${ee}__label-text-content`,fieldInput:`${He}`,inputRadio:`${He}--radio`,inputRadioGroup:`${He}--radio-group`,inputRadioLabel:`${He}--radio-label`,inputDisabled:`${He}--disabled`,inputSwitch:`${He}--switch`,centeredButton:`${ee}__centered-button`,description:`${ee}__description-text`,listObserver:`${ee}__list-observer`,relatedRecordsHeader:`${Xt}_header`,relatedRecordsLabel:`${Xt}_label`,relatedRecordsList:`${Xt}_list`,dateInputContainer:`${`${ee}__date`}-input-container`,textElement:`${ee}__text-element`,group:Yt,groupSequential:`${Yt}--sequential`,groupActive:`${Yt}--active`};let Te=class extends G{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};r([l()],Te.prototype,"objectType",void 0),r([l()],Te.prototype,"maxValue",void 0),r([l()],Te.prototype,"minValue",void 0),r([l()],Te.prototype,"codedValue",void 0),Te=r([x("esri.layers.support.ContingentValue")],Te);const H=Te;let Ae=class extends G{constructor(e){super(e),this.isRetired=!1}};r([l()],Ae.prototype,"id",void 0),r([l()],Ae.prototype,"isRetired",void 0),r([l()],Ae.prototype,"subtype",void 0),r([l()],Ae.prototype,"values",void 0),Ae=r([x("esri.layers.support.Contingency")],Ae);const na=Ae;let lt=class extends G{constructor(e){super(e)}};r([l()],lt.prototype,"fieldGroup",void 0),r([l()],lt.prototype,"type",void 0),lt=r([x("esri.layers.support.ContingencyConstraintViolation")],lt);const ra=lt;let dt=class extends G{constructor(e){super(e)}};r([l()],dt.prototype,"contingentValuesAllGroups",void 0),r([l()],dt.prototype,"contingentValuesByFieldGroup",void 0),dt=r([x("esri.layers.support.ContingentValuesResult")],dt);const Zn=dt;let Oe=class extends G{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};r([l()],Oe.prototype,"name",void 0),r([l()],Oe.prototype,"fields",void 0),r([l()],Oe.prototype,"isEditingRestrictive",void 0),r([l()],Oe.prototype,"contingencies",void 0),Oe=r([x("esri.layers.support.FieldGroup")],Oe);const ui=Oe;var $t;let be=$t=class extends as(ss){constructor(t){super(t),this.request=it,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return ri(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(t){await t.load();const e=t.sourceJSON;if(t.layerId===void 0)return null;const i=e.hasContingentValuesDefinition;if(i)return new $t({layer:t}).load();if(i===void 0){const a=zt(t.url);if(a==null)return null;const s=a.url.path;if((await la(s)).supportsQueryDataElements){const n=t.layerId.toString(),o=await oa(s,n);if(o){const d=o.map(u=>({name:u.name,isEditingRestrictive:u.isEditingRestrictive,fields:u.fieldNames.names.map(p=>t.fieldsIndex.normalizeFieldName(p))}));return new $t({layer:t,fieldGroupDefinitions:d}).load()}}}return null}async load(t){const e=this.layer.load(t).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,t));return this.addResolvingPromise(e),this}validateContingencyConstraints(t,e){const i=Object.keys(t),a=[],s=[];for(const n of this.fieldGroups){const o=n.isEditingRestrictive?"error":"warning";if(e&&!n.fields.some(h=>e.includes(h)))continue;if(!n.fields.every(h=>i.includes(h))){s.push(new ra({fieldGroup:n,type:o}));continue}let d=!1;const u=t[this.subtypeFieldName],p=n.contingencies.filter(h=>!(!h.isRetired&&h.subtype)||h.subtype.code===u);if(p.length!==0){for(const h of p){let c=!0;for(const m in h.values){const g=h.values[m];if(g.objectType!=="any"){if(g.objectType==="null"){if(t[m]!=null){c=!1;break}}else if(g.objectType==="code"){if(t[m]!==g.codedValue.code){c=!1;break}}else if(g.objectType==="range"){const y=t[m];if(y<g.minValue||y>g.maxValue){c=!1;break}}}}if(c){d=!0;break}}d||a.push(new ra({fieldGroup:n,type:o}))}}return{invalid:a,incomplete:s}}getContingentValues(t,e,i=!1){const a=t[this.subtypeFieldName],s=a!=null,n={};let o=[];const d=this.fieldGroups.filter(u=>u.fields.includes(e));o.push(new H({objectType:"any"}));for(const u of d){let p=[];const h=u.contingencies.filter(g=>!(g.isRetired||g.subtype&&s&&g.subtype.code!==a));let c=!1;const m={};for(const g of h){let y,_=!0;for(const v in g.values){const w=g.values[v];if(e!==v){if(t[v]!==void 0&&w.objectType!=="any"){if(w.objectType==="null")t[v]!==null&&(_=!1);else if(w.objectType==="code")t[v]!==w.codedValue.code&&(_=!1);else if(w.objectType==="range"){const k=t[v];(k<w.minValue||k>w.maxValue)&&(_=!1)}}}else y=w,c=c||w.objectType==="range"}if(y&&_){if(y.objectType==="any"){p.length=0,p.push(y);break}const v=qn(y);m[v]||p.push(y),m[v]=!0}}c&&(p=Kn(p)),n[u.name]=p,o=i?Yn(o,p):[]}return d.length===1&&i&&(o=[]),new Zn({contingentValuesAllGroups:o,contingentValuesByFieldGroup:n})}async _initializeContingentValues(t,e){const i=t??await this._fetchFieldGroupDefs(e);if(i.length===0)return void(this.fieldGroups=[]);const a=await this._fetchContingentValues(i,e);this.fieldGroups=a}async _fetchFieldGroupDefs(t){if(this.layer.layerId===void 0)return[];const e=this.layer.sourceJSON,i=this.layer.layerId.toString(),a=zt(this.layer.url).url.path;return e.hasContingentValuesDefinition?(await Xn(a,i,t)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(n=>this.layer.fieldsIndex.normalizeFieldName(n))})):e.hasContingentValuesDefinition!==void 0?[]:la(a,t).then(async s=>s.supportsQueryDataElements?(await oa(a,i,t)).map(n=>({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fieldNames.names.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):[])}async _fetchContingentValues(t,e){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,a=this.layer.layerId.toString(),s=zt(this.layer.url).url.path;if(i.hasContingentValuesDefinition){const o=await tr(s,a,e);return this._constructFieldGroupsAGOL(t,o)}const n=await er(s,a,e);return this._constructFieldGroupsEnterprise(t,n)}_constructFieldGroupsAGOL(t,e){return t.map(i=>{const a=e.contingentValuesDefinition.fieldGroups.find(s=>s.name===i.name);if(a){let s=[];return s=e.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,e,a.subTypes):this._parseAGOLFieldGroup(i,e,a.contingentValues),new ui({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:s})}return null}).filter(Xe)}_parseAGOLFieldGroupSubtype(t,e,i){let a=[];return i==null||i.forEach(s=>{const n=this._getSubtypeAGOL(s.name);a=a.concat(this._parseAGOLFieldGroup(t,e,s.contingentValues,n))}),a}_parseAGOLFieldGroup(t,e,i,a=null){const s=[];for(const n of i??[]){const o=this._parseAGOLContingency(n,t,e,a);s.push(o)}return s}_parseAGOLContingency(t,e,i,a){const s=t.id,n=!!t.retired&&t.retired===1,o={};for(let d=0,u=0;d<e.fields.length;d++){const p=e.fields[d],h=i.typeCodes[t.types[d]];if(h==="Code"){let c=t.values[u];u++;const m=this._getDomain(a,p),g=this.layer.getField(p);if((g==null?void 0:g.type)==="string"){const v=i.stringDicts.find(w=>w.domain===(m==null?void 0:m.name));v&&(c=v.entries[c])}const y=m==null?void 0:m.codedValues.find(v=>v.code===c),_=new H({codedValue:y,objectType:"code"});o[p]=_}else if(h==="Range"){const c=t.values[u];u++;const m=c.range[0],g=c.range[1],y=new H({minValue:m,maxValue:g,objectType:"range"});o[p]=y}else if(h==="Any"){const c=new H({objectType:"any"});o[p]=c}else{const c=new H({objectType:"null"});o[p]=c}}return new na({id:s,isRetired:n,subtype:a,values:o})}_constructFieldGroupsEnterprise(t,e){const i=e.fieldGroups;return t.map(a=>{const s=i.find(n=>n.name===a.name);if(s){const n=s.contingencies.map(o=>{const d=o.id,u=o.isRetired||!1,p=this._getSubtypeEnterprise(o.subtypeCode),h={};for(let c=0;c<a.fields.length;c++){const m=a.fields[c];let g=o.values[c];if(typeof g=="number"||typeof g=="string"){const y=this._getDomain(p,m),_=this.layer.getField(m);si(_)?g=e.stringDictionary[g]:ns(_)&&(g=new Date(`${g}+00:00`).getTime());const v=y==null?void 0:y.codedValues.find(k=>k.code===g),w=new H({codedValue:v,objectType:"code"});h[m]=w}else if(typeof g=="object"){const y=g.minValue,_=g.maxValue,v=new H({minValue:y,maxValue:_,objectType:"range"});h[m]=v}else if(g){const y=new H({objectType:"any"});h[m]=y}else{const y=new H({objectType:"null"});h[m]=y}}return new na({id:d,isRetired:u,subtype:p,values:h})});return new ui({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fields,contingencies:n})}return null}).filter(Xe)}_getSubtypeEnterprise(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const a=e.subtypes.find(s=>s.code===t);i=Wi.fromJSON(a)}return i||null}_getSubtypeAGOL(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const a=e.subtypes.find(s=>s.name===t);i=Wi.fromJSON(a)}return i||null}_getDomain(t,e){const i=t?ir(t,e):this.layer.getFieldDomain(e);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(e):i}};function qn(t){switch(t.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return t.codedValue.name+t.codedValue.code.toString();case"range":return t.minValue.toString()+"-"+t.maxValue.toString()}}function Kn(t){let e,i;t.sort((s,n)=>s.objectType==="null"?-1:n.objectType==="null"?1:s.minValue-n.minValue);const a=[];for(const s of t)s.objectType!=="null"?e!=null&&i!=null?i<s.minValue?(a.push(new H({objectType:"range",minValue:e,maxValue:i})),e=s.minValue,i=s.maxValue):i<s.maxValue&&(i=s.maxValue):(e=s.minValue,i=s.maxValue):a.push(s);return a.push(new H({objectType:"range",minValue:e,maxValue:i})),a}function Jn(t,e){const i=[];let a,s=0;for(const n of t)for(;s<e.length;s++){const o=e[s];if(n.objectType==="null"&&o.objectType==="null")i.push(new H({objectType:"null"}));else{if(n.objectType==="null")break;if(o.objectType==="null")continue}if(n.maxValue<o.minValue)break;if(n.maxValue===o.minValue){i.push(new H({objectType:"range",minValue:n.maxValue,maxValue:o.minValue}));break}if(!(n.minValue>o.maxValue))if(n.minValue!==o.maxValue){if(a=n.minValue>o.minValue?n.minValue:o.minValue,n.maxValue<o.maxValue){i.push(new H({objectType:"range",minValue:a,maxValue:n.maxValue}));break}i.push(new H({objectType:"range",minValue:a,maxValue:o.maxValue}))}else i.push(new H({objectType:"range",minValue:n.minValue,maxValue:o.maxValue}))}return i}function Qn(t,e){const i=[];for(const a of t)e.some(s=>{if(a.objectType===s.objectType)switch(a.objectType){case"any":case"null":return!0;case"code":return a.codedValue.code===s.codedValue.code&&a.codedValue.name===s.codedValue.name}return!1})&&i.push(a);return i}function Yn(t,e){var s,n;if(t.length===0||e.length===0)return[];if(t[0].objectType==="any")return e;if(e[0].objectType==="any")return t;const i=t[0].objectType==="range"||((s=t[1])==null?void 0:s.objectType)==="range",a=e[0].objectType==="range"||((n=e[1])==null?void 0:n.objectType)==="range";return i||a?Jn(t,e):Qn(t,e)}async function Xn(t,e,i){return it(`${t}/${e}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(a=>a.data.fieldGroups??[])}async function oa(t,e,i){return it(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(a=>{var s;return((s=a.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups)??[]})}async function la(t,e){return it(t,{responseType:"json",query:{f:"json"},...e}).then(i=>i.data)}async function er(t,e,i){return it(`${t}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(a=>{var s;return(s=a.data.contingentValueSets)==null?void 0:s[0]})}async function tr(t,e,i){return it(`${t}/${e}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(a=>a.data)}function ir(t,e){const i=t.domains;if(i){const[a,s]=Object.entries(i).find(([n])=>n.trim().toLowerCase()===e.trim().toLowerCase())||[];return s||null}return null}r([l({constructOnly:!0})],be.prototype,"layer",void 0),r([l({constructOnly:!0})],be.prototype,"request",void 0),r([l({type:[ui]})],be.prototype,"fieldGroups",void 0),r([l({constructOnly:!0})],be.prototype,"fieldGroupDefinitions",void 0),r([l()],be.prototype,"subtypeFieldName",null),be=$t=r([x("esri.layers.support.LayerContingentValuesCache")],be);const ar=be;let J=class extends G{constructor(e){super(e),this.element=null,this.feature=null,this.layer=null,this.timeZone=null,this.type=null,this.visibilityExpressionExecutor=null}get description(){var e;return this.getFormattedLabel((e=this.element)==null?void 0:e.description)}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get label(){var e;return this.getFormattedLabel((e=this.element)==null?void 0:e.label)}get updating(){return!1}get visible(){return this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null}getFormattedLabel(e){const{feature:i,layer:a,timeZone:s}=this;return a==null||e==null?e:Ut({label:e,attributes:i.attributes,fieldsIndex:a.fieldsIndex,timeZone:s})}};r([l({readOnly:!0})],J.prototype,"description",null),r([l({constructOnly:!0})],J.prototype,"element",void 0),r([l()],J.prototype,"evaluatedVisibilityExpression",null),r([l()],J.prototype,"feature",void 0),r([l()],J.prototype,"label",null),r([l()],J.prototype,"layer",void 0),r([l()],J.prototype,"timeZone",void 0),r([l()],J.prototype,"type",void 0),r([l()],J.prototype,"updating",null),r([l()],J.prototype,"visible",null),r([l()],J.prototype,"visibilityExpressionExecutor",void 0),J=r([x("esri.widgets.FeatureForm.InputBase")],J);const $i=J;var se;(function(t){t.Text="text",t.Number="number",t.Date="date",t.Unsupported="unsupported"})(se||(se={}));const sr=(t,e)=>{if(!t)return!0;const{operations:i}=t;switch(e){case"INSERT":return i.supportsAdd;case"UPDATE":case"DELETE":return i.supportsUpdate;default:return!0}};let ke=class extends $i{constructor(e){super(e),this.arcadeEditType="NA",this.editableExpressionExecutor=null}get editable(){return!!this.layerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get evaluatedEditableExpression(){const{editableExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get layerAllowsEdits(){const{layer:e}=this;if(!e)return!1;const i=ht(e),a=i==null?void 0:i.operations.supportsEditing,s=sr(i,this.arcadeEditType);return!(!a||!s)}};r([l()],ke.prototype,"arcadeEditType",void 0),r([l()],ke.prototype,"editable",null),r([l()],ke.prototype,"editableExpressionExecutor",void 0),r([l()],ke.prototype,"evaluatedEditableExpression",null),r([l()],ke.prototype,"layerAllowsEdits",null),ke=r([x("esri.widgets.FeatureForm.EditableInput")],ke);const Ra=ke;let F=class extends Ra{constructor(e){super(e),this._storedValue=null,this.error=null,this.preservesValueWhenHidden=!0,this.field=null,this.group=null,this.requiredExpressionExecutor=null,this.type="field",this._fieldInputWasVisibleDuringLifetime=!1,this.valueExpressionExecutor=null}initialize(){this.addHandles(C(()=>this.feature,()=>this._fieldInputWasVisibleDuringLifetime=!1,mt))}get _dateFormRange(){const{element:e,field:i}=this;if(this.dataType!=="date")return{};const a=e!=null&&e.domain?kt(i,e.domain):null;if(!(e!=null&&e.input))return a??{};const s=e.input,{type:n}=s;let o={};if(n!=="date-picker"&&n!=="time-picker"&&n!=="datetimeoffset-picker"||(o=rs(i,s.max,s.min)),n==="datetime-picker"){const{max:p,min:h}=s;o={max:p!=null&&da(p)?p.getTime():null,min:h!=null&&da(h)?h.getTime():null}}const{max:d,min:u}=o;if(a){const{max:p,min:h}=a,c=We(p)&&(d==null||d!=null&&p<d),m=We(h)&&(u==null||u!=null&&h>u);return{max:c?p:d??null,min:m?h:u??null,rawMax:c?a.rawMax:(o==null?void 0:o.rawMax)??null,rawMin:m?a.rawMin:(o==null?void 0:o.rawMin)??null}}return{min:u,max:d,rawMax:(o==null?void 0:o.rawMax)??null,rawMin:(o==null?void 0:o.rawMin)??null}}get _dateRange(){const{_dateFormRange:e,field:i}=this;if(this.dataType!=="date")return{};const a=kt(i);if(!a)return e;const{max:s,min:n,rawMax:o,rawMin:d}=e;if(i.type==="date"){const{max:u,min:p}=a;return{max:We(s)&&(u===null||u!=null&&s<u)?s:u??null,min:We(n)&&(p===null||p!=null&&n>p)?n:p??null}}if(i.type==="date-only"||i.type==="time-only"||i.type==="timestamp-offset"){const{max:u,min:p,rawMax:h,rawMin:c}=a,m=We(s)&&o&&(u==null||s<u);return{max:m?s:u,min:We(n)&&d&&(p==null||n>p)?n:p,rawMax:m?o:h,rawMin:m?d:c}}return{max:null,min:null}}get _configAllowsEdits(){var n,o;const{element:e,layer:i,name:a}=this;if(e!=null)return e.editableExpression?!!this.evaluatedEditableExpression:e.editable!==!1;if(i!=null&&i.userHasUpdateItemPrivileges)return!0;const s=i&&"popupTemplate"in i?(o=(n=i==null?void 0:i.popupTemplate)==null?void 0:n.fieldInfos)==null?void 0:o.find(({fieldName:d})=>d===a):null;return(s==null?void 0:s.isEditable)??!0}get _layerAndFieldAllowEdits(){var e;return this.layerAllowsEdits&&((e=this.field)==null?void 0:e.editable)}get _isVisibleByDefault(){const{field:e,layer:i}=this;return!!(e!=null&&e.visible)&&os(e,i)}get _isEditTrackingField(){var e;return ls(this.layer).includes((e=this.name)==null?void 0:e.toLowerCase())}get _shouldUseValueExpression(){return this._layerAndFieldAllowEdits&&!this._configAllowsEdits&&this.valueExpressionExecutor!=null}get isSubtypeField(){var i;const{layer:e}=this;if(e&&"subtypeField"in e){const{subtypeField:a,fieldsIndex:s}=e;return(((i=s.get(a))==null?void 0:i.name)??a)===this.name}return!1}get valueIsOutOfDomain(){const{domain:e,value:i,field:a}=this;return!(!e||i==null)&&Ui(a,i,e)!==null}get dataType(){const{field:e}=this;return Zt(e)?se.Number:si(e)?se.Text:sa(e)||Ni(e)?se.Date:se.Unsupported}get dateDataType(){if(this.dataType===se.Date)return this.field.type!=="date"?"string":"number"}get domain(){const{layer:e,feature:i,name:a,element:s}=this,n=s==null?void 0:s.domain;return n!=null&&this._isDomainCompatible(n)?n:e.getFieldDomain(a,{feature:i})}get editable(){return!!this._layerAndFieldAllowEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get evaluatedRequiredExpression(){const{requiredExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get evaluatedValueExpression(){const{valueExpressionExecutor:e}=this;return e!=null?e.lastEvaluatedValue:null}get hint(){var e;return(e=this.element)==null?void 0:e.hint}get includeDate(){return!(this.dataType!==se.Date||this.field.type==="time-only")}get includeTime(){var s;const{element:e,field:i}=this;if(this.dataType!==se.Date)return!1;if(i.type==="time-only")return!0;if(i.type==="date-only")return!1;const a=((s=e==null?void 0:e.input)==null?void 0:s.type)==="datetime-picker"?e.input.includeTime:void 0;return a===void 0||a}get includeTimeOffset(){var i;if(this.field.type!=="timestamp-offset")return!1;const e=(i=this.element)==null?void 0:i.input;return!e||e.type==="datetimeoffset-picker"&&e.includeTimeOffset}set initialFeature(e){this._set("initialFeature",e),this.notifyChange("valid")}get inputType(){var e,i;return(i=(e=this.element)==null?void 0:e.input)==null?void 0:i.type}get hasInvalidSwitchValue(){const{element:e}=this,i=oi(e,"switch")?e.input:null;return!i||gn(this.value,i)}get isRelationshipKeyField(){var a;const{field:e,layer:i}=this;return Mi(i)&&!!((a=i.relationships)!=null&&a.some(s=>s.keyField===e.name))}get label(){var i;const{field:e}=this;return this.getFormattedLabel((i=this.element)==null?void 0:i.label)??e.alias??e.name}get maxLength(){if(this.dataType===se.Date)return-1;const{field:i,element:a}=this,s=(i==null?void 0:i.length)??-1,n=Xi(a)?a.input.maxLength:NaN;return n!=null&&!isNaN(n)&&n>=-1&&(s===-1||n<=s)?n:s}get minLength(){if(this.dataType===se.Date)return-1;const{field:i,element:a}=this,s=(i==null?void 0:i.length)??-1,n=Xi(a)?a.input.minLength:NaN;return n!=null&&!isNaN(n)&&n>=-1&&(s===-1||n<=s)?n:-1}get name(){var e;return(e=this.field)==null?void 0:e.name}get range(){const{domain:e,element:i,field:a}=this;if(this.dataType==="date")return this._dateRange;const s=kt(a,e)||ds(a,e),n=(s==null?void 0:s.max)===Number.MAX_VALUE?null:(s==null?void 0:s.max)??null,o=(s==null?void 0:s.min)===-Number.MAX_VALUE?null:(s==null?void 0:s.min)??null;if(!(i!=null&&i.domain)||i.domain.type!=="range")return{max:n,min:o};const{max:d,min:u}=kt(a)||{};return{max:d!=null&&(n===null||n!=null&&d<n)?d:n,min:u!=null&&(o===null||o!=null&&u>o)?u:o}}get required(){var o;const{editable:e,evaluatedRequiredExpression:i,field:a,visible:s,isSubtypeField:n}=this;return e?(a==null?void 0:a.nullable)===!1||n?!0:!(!s||((o=this.group)==null?void 0:o.visible)===!1||i==null)&&i:!1}set required(e){this._overrideIfSome("required",e)}get showNoValueOptionEnabled(){const{element:e}=this;return!this.required&&(!ea(e)||e.input.showNoValueOption)}get showNoValueLabel(){const{element:e}=this;return ea(e)?e.input.noValueOptionLabel:null}get submittable(){const{field:e,required:i,valid:a,value:s}=this;return(!i||s!=null)&&(!!a||this.initialFeature.getAttribute(e.name)===s)}get timeResolution(){var i;const e=(i=this.element)==null?void 0:i.input;if(e&&(e.type==="datetimeoffset-picker"||e.type==="time-picker"))return e.timeResolution??"minutes"}get timeStep(){return this.timeResolution!=null?us.get(this.timeResolution):void 0}get updating(){const{editableExpressionExecutor:e,valueExpressionExecutor:i,visibilityExpressionExecutor:a,preservesValueWhenHidden:s}=this;return i!=null&&i.updating||e!=null&&e.updating||s===!1&&a!=null&&a.updating}get valid(){const e=this.editable?this._validate():null;return this._set("error",e),e===null}get value(){var e,i,a,s;if(this._fieldInputWasVisibleDuringLifetime=this._fieldInputWasVisibleDuringLifetime||this.visible&&((e=this.group)==null?void 0:e.visible)!==!1,this.preservesValueWhenHidden===!1&&this._fieldInputWasVisibleDuringLifetime&&(((i=this.visibilityExpressionExecutor)==null?void 0:i.lastEvaluatedValue)===!1||((s=(a=this.group)==null?void 0:a.visibilityExpressionExecutor)==null?void 0:s.lastEvaluatedValue)===!1))return this._storedValue!==null&&this.set("_storedValue",null),null;if(this._shouldUseValueExpression){const n=this.evaluatedValueExpression;return this.dataType===se.Date?this._arcadeOutputToDateFieldValue(n):n!=null&&typeof n=="object"?n.toString():n}return this._storedValue}set value(e){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",e)}get visible(){var e;return!this._isEditTrackingField&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null&&((e=this.field)==null?void 0:e.visible)!==!1||this._isVisibleByDefault)}_arcadeOutputToDateFieldValue(e){const i=this.field.type;try{if(typeof e=="object"){if(e===null)throw new P("feature-form:invalid-date-value");if(ps(e))return cs(e,i);if("getTime"in e&&typeof e.getTime=="function"&&i==="date")return parseInt(e.getTime(),10);if(i==="date-only"||i==="time-only"||i==="timestamp-offset")return e.toString()}else{if(typeof e=="string")return i==="date"?parseInt(e,10):e;if(typeof e=="number"&&i==="date")return e}throw new P("feature-form:invalid-date-value")}catch{return i==="date"?NaN:""}}_isDomainCompatible(e){const{field:i}=this;if((e==null?void 0:e.type)==="coded-value"){const a=typeof e.codedValues[0].code;if(a==="string"&&si(i)||a==="number"&&Zt(i))return!0}return!!((e==null?void 0:e.type)==="range"&&Zt(i)||sa(i)||Ni(i))}_validate(){const{dataType:e,domain:i,field:a,initialFeature:s,minLength:n,range:o,required:d,valid:u,value:p,maxLength:h}=this,c=d&&p==null,m=u!==void 0;if(!c&&s.getAttribute(a.name)===p&&m)return null;if(c)return hs.INVALID_TYPE;if(e==="text"&&typeof p=="string"){if(n>-1&&p.length<n)return ta.TOO_SHORT;if(h>-1&&p.length>h)return ta.TOO_LONG}return e!=="date"||p==null||ys({type:a.type,range:o,value:p})?i?p!==null||d?Ui(a,p,i):null:ms(a,p):fs.OUT_OF_RANGE}};r([l()],F.prototype,"_dateFormRange",null),r([l()],F.prototype,"_dateRange",null),r([l()],F.prototype,"_storedValue",void 0),r([l()],F.prototype,"_configAllowsEdits",null),r([l()],F.prototype,"_layerAndFieldAllowEdits",null),r([l()],F.prototype,"_isVisibleByDefault",null),r([l()],F.prototype,"_isEditTrackingField",null),r([l()],F.prototype,"_shouldUseValueExpression",null),r([l()],F.prototype,"isSubtypeField",null),r([l()],F.prototype,"valueIsOutOfDomain",null),r([l()],F.prototype,"dataType",null),r([l()],F.prototype,"dateDataType",null),r([l()],F.prototype,"domain",null),r([l()],F.prototype,"editable",null),r([l({readOnly:!0})],F.prototype,"error",void 0),r([l({constructOnly:!0})],F.prototype,"preservesValueWhenHidden",void 0),r([l()],F.prototype,"evaluatedRequiredExpression",null),r([l()],F.prototype,"evaluatedValueExpression",null),r([l()],F.prototype,"field",void 0),r([l()],F.prototype,"group",void 0),r([l({readOnly:!0})],F.prototype,"hint",null),r([l()],F.prototype,"includeDate",null),r([l()],F.prototype,"includeTime",null),r([l()],F.prototype,"includeTimeOffset",null),r([l()],F.prototype,"initialFeature",null),r([l({readOnly:!0})],F.prototype,"inputType",null),r([l()],F.prototype,"hasInvalidSwitchValue",null),r([l()],F.prototype,"isRelationshipKeyField",null),r([l()],F.prototype,"label",null),r([l()],F.prototype,"maxLength",null),r([l()],F.prototype,"minLength",null),r([l({readOnly:!0})],F.prototype,"name",null),r([l()],F.prototype,"range",null),r([l()],F.prototype,"required",null),r([l()],F.prototype,"requiredExpressionExecutor",void 0),r([l()],F.prototype,"showNoValueOptionEnabled",null),r([l()],F.prototype,"submittable",null),r([l()],F.prototype,"timeResolution",null),r([l()],F.prototype,"timeStep",null),r([l({readOnly:!0})],F.prototype,"type",void 0),r([l()],F.prototype,"updating",null),r([l()],F.prototype,"valid",null),r([l({value:null})],F.prototype,"value",null),r([l()],F.prototype,"valueExpressionExecutor",void 0),r([l()],F.prototype,"visible",null),F=r([x("esri.widgets.FeatureForm.FieldInput")],F);const da=t=>t&&!Number.isNaN(t.valueOf()),ua=F;var Pa;const nr=Symbol("FormExpressionArcadeExecutor");let z=class extends G{constructor(e){super(e),this[Pa]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new at,this._executeAsyncDebounced=_t(async(i,a,s)=>{const n=await this.executor.executeAsync(i,{...a,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=n,this._stale=!1,n)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,i){this._abortController=new AbortController;const a=this.executor.execute(e,{...i,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=a,a}async executeAsync(e,i){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,i??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};Pa=nr,r([l()],z.prototype,"_lastEvaluatedValue",void 0),r([l()],z.prototype,"_stale",void 0),r([l()],z.prototype,"_updatingTracking",void 0),r([l({constructOnly:!0})],z.prototype,"executor",void 0),r([l()],z.prototype,"isAsync",null),r([l()],z.prototype,"fieldsUsed",null),r([l()],z.prototype,"syntaxTree",null),r([l()],z.prototype,"updating",null),r([l()],z.prototype,"stale",null),r([l()],z.prototype,"geometryUsed",null),r([l()],z.prototype,"variablesUsed",null),r([l()],z.prototype,"lastEvaluatedValue",null),z=r([x("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],z);const rr=async(t,e)=>{const i=Pn("form-calculation"),a=await Dn(t,i,{});return e!=null&&e.fieldsIndex&&(a.fieldsUsed=wi(e.fieldsIndex,a.fieldsUsed)),new z({executor:a})},ei="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let le=class extends G{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:i,map:a,originalFeature:s,spatialReference:n,timeZone:o}=this.arcadeContextInfo,d=(i==null?void 0:i.type)==="scene"&&i.associatedLayer!=null?i.associatedLayer:i;return[{$originalfeature:s,$editcontext:{editType:e},$layer:d,$featureset:d,$datastore:i==null?void 0:i.url,$map:a},{rawOutput:!0,spatialReference:n??void 0,timeZone:o}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:i,_latestFieldValues:a,feature:s}=this,n=new Set;for(const o of e)if(a[o]=s.getAttribute(o),i.has(o))for(const d of i.get(o))n.add(d);return this._evaluate([...n])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(ei))return this._evaluate([...this._fieldReferencesLookup.get(ei)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var u;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:i,executors:a,preserveFieldValuesWhenHidden:s}=this,n=new Map(this.fieldInputs.map(p=>[p.name,p])),o=s===!1,d=new Map(a.map(p=>[p,new Array]));for(const p of a){for(const h of p.fieldsUsed){qt(e,h,()=>new Set).add(p);const c=n.get(h);[c==null?void 0:c.valueExpressionExecutor,c==null?void 0:c.editableExpressionExecutor,o?(u=c==null?void 0:c.group)==null?void 0:u.visibilityExpressionExecutor:null,o?c==null?void 0:c.visibilityExpressionExecutor:null].filter(m=>m!=null&&m!==p).forEach(m=>{d.get(m).push(p),qt(i,m,()=>new Set).add(c)})}p.geometryUsed&&qt(e,ei,()=>new Set).add(p)}return d}async _evaluate(e){const i=new Map,{_dependencyGraph:a,_fieldsAffectedLookup:s,_latestFieldValues:n}=this;for(const d of e)Da(d,i,a);for(const[d,{resolver:u,dependencyPromises:p}]of i)Promise.all(p).then(async()=>{const[h,c]=this._makeContext(n);return d.executeAsync(h,c)}).then(()=>{if(s.has(d))for(const h of s.get(d))this._latestFieldValues[h.name]=h.value;u.resolve()},h=>{!h||Hi(h)||pa(h)||d.markStale(),u.reject(h)});const o=(await Promise.allSettled(Array.from(i.values(),({resolver:d})=>d.promise))).filter(d=>d.status==="rejected"&&!(Hi(d.reason)||pa(d.reason)));if(o.length>0){const d=new AggregateError(o,`One or more expression executions failed. First error message: ${o[0].reason}`);throw q.getLogger(this).error(d),d}}_makeContext(e){const[i,a]=this._baseContext,s=this.feature.clone();return s.attributes=e,[{...i,$feature:s},a]}get test(){}};r([l()],le.prototype,"_asyncExecutors",null),r([l()],le.prototype,"_baseContext",null),r([l()],le.prototype,"feature",null),r([l({constructOnly:!0})],le.prototype,"preserveFieldValuesWhenHidden",void 0),r([l()],le.prototype,"executors",void 0),r([l()],le.prototype,"fieldInputs",void 0),r([l()],le.prototype,"arcadeContextInfo",void 0),le=r([x("esri.widgets.FeatureForm.FormExpressionsManager")],le);const Da=(t,e,i)=>{if(e.has(t))return;const a=st();e.set(t,{resolver:a,dependencyPromises:[]}),t.abort();const s=i.get(t);for(const n of s)Da(n,e,i),e.get(n).dependencyPromises.push(a.promise)},pa=t=>t&&typeof t=="object"&&"message"in t&&t.message==="Cancelled";let ye=class extends $i{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=Ia().toString(),this.type="group"}initialize(){this.addHandles([C(()=>[this.visible,this.inputs],([e])=>{const{inputs:i}=this,a=!!e&&void 0;for(const s of i)ut(s)&&(s.required=a)},{initial:!0,equals:(e,i)=>i[0]===e[0]&&i[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(i=>C(()=>i.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};r([l()],ye.prototype,"id",void 0),r([l()],ye.prototype,"initialState",null),r([l()],ye.prototype,"inputs",null),r([l()],ye.prototype,"open",null),r([l()],ye.prototype,"type",void 0),r([l()],ye.prototype,"visible",null),ye=r([x("esri.widgets.FeatureForm.GroupInput")],ye);const or=ye,lr=3;let O=class extends Ra{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([C(()=>({feature:this.feature,element:this.element,layer:this.layer}),i=>this._createRelationshipVM(i),he),ce(()=>this.relatedLayer,"edits",()=>{var i;return(i=this._relationshipVM)==null?void 0:i.refresh()})])}destroy(){var e;(e=this._relationshipVM)==null||e.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:i,relationship:a}=this;if(!a||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:n}=a;return!(s==="one-to-one"&&i>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&n==="destination"&&i>0)&&e}get displayCount(){return this.element.displayCount??lr}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var e;return((e=this._relationshipVM)==null?void 0:e.featureCount)??0}get loaded(){var e;return((e=this._relationshipVM)==null?void 0:e.state)!=="loading"}get map(){return this._get("map")}set map(e){var i;e&&((i=this._relationshipVM)==null||i.set("map",e)),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return(e=this._relationshipVM)==null?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var d;const{_relationshipVM:e,timeZone:i}=this;if(!((d=e==null?void 0:e.relatedFeatures)!=null&&d.length)||!(e!=null&&e.relatedLayer))return[];const{itemDescriptionFieldName:a,relatedFeatures:s,relatedLayer:n}=e,o=n&&"formTemplate"in n&&n.formTemplate?n.formTemplate.title:void 0;return s.map(u=>{let p;if(a){const h=u.getAttribute(a),c=n.fieldsIndex.get(a);if(c){const m=vn({values:[h],fields:[c],timeZone:i??void 0})[a];m!=null&&(p=m.toString())}}return{feature:u,description:p,title:o?Ut({label:o,attributes:u.attributes,fieldsIndex:n.fieldsIndex,timeZone:i}):void 0}}).toArray()}get relatedLayer(){var e;return(e=this._relationshipVM)==null?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!!((e=this.relatedLayer)!=null&&e.isTable)}get relatedLayerAllowsAdds(){var a;const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const i=ht(e);return!!((a=i==null?void 0:i.operations)!=null&&a.supportsAdd)}get relatedLayerAllowsEdits(){var a;const{relatedLayer:e}=this;if(!e)return!1;const i=ht(e);return!!((a=i==null?void 0:i.operations)!=null&&a.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var i;(i=this._relationshipVM)==null||i.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:i}=e;return i!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var e,i;return((e=this._relationshipVM)==null?void 0:e.state)==="loading"||((i=this._relationshipVM)==null?void 0:i.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var i;return(i=this._relationshipVM)==null?void 0:i.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var h;const{feature:i,element:a,layer:s}=e;if((h=this._relationshipVM)==null||h.destroy(),!i||!a||!s)return;const{displayCount:n,map:o,orderByFields:d,relationshipId:u,showAllEnabled:p}=this;Mi(s)&&(this._relationshipVM=new _n({graphic:i,displayCount:n,layer:s,map:o,orderByFields:d,relationshipId:u,showAllEnabled:p}))}};r([l()],O.prototype,"_relationshipVM",void 0),r([l()],O.prototype,"canAddRelatedFeature",null),r([l()],O.prototype,"displayCount",null),r([l()],O.prototype,"displayType",null),r([l()],O.prototype,"editable",null),r([l()],O.prototype,"featureCount",null),r([l()],O.prototype,"group",void 0),r([l()],O.prototype,"loaded",null),r([l()],O.prototype,"map",null),r([l()],O.prototype,"orderByFields",null),r([l()],O.prototype,"originHasValidKey",null),r([l()],O.prototype,"relationship",null),r([l()],O.prototype,"relationshipId",null),r([l()],O.prototype,"relatedFeatureInfos",null),r([l()],O.prototype,"relatedLayer",null),r([l()],O.prototype,"relatedLayerIsTable",null),r([l()],O.prototype,"relatedLayerAllowsAdds",null),r([l()],O.prototype,"relatedLayerAllowsEdits",null),r([l()],O.prototype,"showAllEnabled",null),r([l()],O.prototype,"showAllActionVisible",null),r([l({readOnly:!0})],O.prototype,"type",void 0),r([l()],O.prototype,"visible",null),r([l()],O.prototype,"updating",null),O=r([x("esri.widgets.FeatureForm.RelationshipInput")],O);const dr=O;let pi;const ur=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function pr(t){return pi||await cr(),pi.parse(t)}async function cr(){const{Marked:t}=await b(()=>import("./marked.esm-BGCHI5NM.js"),[],import.meta.url),e=function({text:n}){return`<span style="text-decoration:line-through;">${n}</span>`},i=function({href:n,text:o,title:d}){return`<a${n!=null?` href="${n}"`:""}${d!=null?` title="${d}"`:""} target="_blank">${o??""}</a>`},a=()=>"",s={};for(const n of ur)s[n]=a;pi=new t({renderer:{del:e,link:i,...s}})}let X=class extends $i{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${Ia()}`,this.type="text",this._expressionReferences=new Ta,this._expressionsUsed=new Gi,this._fieldsUsed=new Gi,this._literalParts=new Qe,this._templateParts=new Qe,this._updatingHandles=new at}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(pr(e).then(i=>this._initializeTextParts(i))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(i=>{var a;return`${((a=this._expressionReferences.get(i))==null?void 0:a.lastEvaluatedValue)??""}`});return gs.sanitize(mr(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e==null?void 0:e.updating)}setExpressionExecutor(e,i){this._expressionReferences.set(ia(e),i)}setFieldExecutor(e,i){this._expressionReferences.set(aa(e),i)}_initializeTextParts(e){const{fieldsIndex:i}=this,{literals:a,templates:s}=hr(e),n=[],o=[];for(let d=0;d<s.length;d++){const u=a[d],p=vs(s[d])[0];if(wn(p))this._expressionsUsed.add(bn(p)),this._expressionReferences.set(p,null),n.push(u),o.push(p);else if(kn(p)){this._expressionsUsed.add(p);const h=ia(p);this._expressionReferences.set(h,null),n.push(u),o.push(h)}else if(i!=null&&i.has(p)){const h=i.normalizeFieldName(p);this._fieldsUsed.add(h);const c=aa(h);this._expressionReferences.set(c,null),n.push(u),o.push(c)}else a[d+1]=u.concat(p,a[d+1])}n.push(a.at(-1)),this._literalParts.addMany(n),this._templateParts.addMany(o)}};function hr(t){const e=/{[^{]+?}/g,i=[...t.matchAll(e)];let a=0;const s=[],n=[];for(const o of i){const d=o[0];s.push(t.slice(a,o.index)),n.push(d),a=o.index+d.length}return s.push(t.slice(a)),{literals:s,templates:n}}function mr(t,e){return e.reduce((i,a,s)=>i.concat(t.at(s),a),"").concat(t.at(-1))}r([l()],X.prototype,"expressionsUsed",null),r([l()],X.prototype,"fieldsIndex",null),r([l()],X.prototype,"fieldsUsed",null),r([l()],X.prototype,"group",void 0),r([l()],X.prototype,"id",void 0),r([l()],X.prototype,"rawText",null),r([l()],X.prototype,"text",null),r([l()],X.prototype,"textFormat",null),r([l()],X.prototype,"type",void 0),r([l()],X.prototype,"updating",null),X=r([x("esri.widgets.FeatureForm.TextElementInput")],X);const ti=new nt({attributes:{}}),fr={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},yr="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Ge="#JSAPI_CONTINGENT_VALUE_ANY_HASH",gr="#JSAPI_CONTINGENT_VALUE_NULL_HASH",Wa="esri.widgets.FeatureForm.FeatureFormViewModel",Ua=()=>q.getLogger(Wa);let E=class extends _s(jt.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=ti.clone(),this._initialFeature=ti.clone(),this._timeZone=null,this._updatingHandles=new at,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=C(()=>{var s;return[this.layer,!!((s=this.layer)!=null&&s.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([s,n])=>{s!=null&&(n?this._updatingHandles.addPromise(this._updateInputs()):s.load().catch(()=>{}))},{equals:([s,n,o,d,u,p],[h,c,m,g,y,_])=>s===h&&n===c&&o===m&&d===g&&u===y&&p===_,initial:!0}),i=C(()=>this._arcadeContextInfo,s=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=s,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),a=C(()=>this.layer,s=>{const n=(s==null?void 0:s.type)==="subtype-sublayer"?s.parent:(s==null?void 0:s.type)==="feature"?s:null;n&&this.addResolvingPromise(ar.createLoadedLayerContingentValuesCache(n).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,i,a])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=ft(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,i;return new Map((i=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:i.map(a=>[a.name,a]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:i,layer:a,map:s,spatialReference:n,timeZone:o}=this;return{layer:Nt(a)?a:null,originalFeature:e,editType:i,map:s,spatialReference:n,timeZone:o}}get allFieldInputs(){return Fn(this.inputs)}get allGroupInputs(){return this.inputs.filter(Je)}get allRelationshipInputs(){return Cn(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(i=>[i.name,i]))}get feature(){return this._get("feature")}set feature(e){const i=this._get("feature");this._featureClone=e?e.clone():ti.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(a=>a.feature=e)):(this.inputs.forEach(a=>a.destroy()),this.inputs.length=0),i!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(i=>i.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:i}=this;return e!=null&&e.description&&i?Ut({label:e.description,attributes:this.getValues(),fieldsIndex:i.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:i}=this;return e!=null&&e.title&&i?Ut({label:e.title,attributes:this.getValues(),fieldsIndex:i.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:i,formTitle:a}=this;return!(e||!i&&!a)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const i=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||i.forEach(a=>a.showAllEnabled=!1),e!=null){const a=i.find(s=>s.relationshipId===e);a&&(a.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return ji;const i=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===bs?i||ji:this._timeZone||ws}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:i})=>i)}findField(e){return this.allFieldInputs.find(i=>i.name===e)}getFieldValueOptionsForField(e,i){var d;const a=this.findField(e);if(!a)return[[],[],[]];const s=((d=a.domain)==null?void 0:d.type)==="coded-value"?a.domain.codedValues.map(({name:u,code:p})=>({name:u,value:p})):[],n=a.value==null||s.some(u=>u.value===a.value)?[]:[{name:`${a.value}`,value:a.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,i):[];if(o.length>0){const u=new Set(o.map(p=>p.value));return[o,s.filter(p=>!u.has(p.value)),n]}return[s,[],n]}getValue(e){var a;const i=(a=this.layer)==null?void 0:a.getField(e);if(i!=null)return this._featureClone.getAttribute(i.name)??null}setValue(e,i){const{_featureClone:a,strict:s}=this,n=this.findField(e);i=i===""?null:i,n&&a.getAttribute(e)!==i&&(n.value=i,s&&!n.valid||(this._afterValueChange(n),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([n.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,i=new Set(e.filter(n=>n.valid).map(({name:n})=>n)),a=e.filter(n=>!n.valid).map(({name:n})=>n),s=this.getValues();if(this.validateContingencyConstraints(s,{includeIncompleteViolations:!0}).length>0)for(const[n,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(i.delete(n),a.push(n));this.emit("submit",{valid:[...i],invalid:a,values:s})}validateContingencyConstraints(e,i){const{_contingentValuesCache:a}=this,s=new Map;if(this.contingencyConstraintViolations=s,a==null)return[];const{invalid:n,incomplete:o}=a.validateContingencyConstraints(e),d=[...n,...i!=null&&i.includeIncompleteViolations?o:[]];for(const u of d)for(const p of u.fieldGroup.fields)s.set(p,u);return d}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:i,_featureClone:a}=this;i&&(a.geometry=i.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated())))}applySubtypeDefaults(e){const{defaultValues:i}=e,{allFieldInputs:a}=this;for(const{name:s}of a){const n=i[s];n!=null&&this.setValue(s,n)}}_emitChangeEvent({name:e,valid:i,value:a}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:a,valid:i})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:i,arcadeEditType:a,formTemplate:s,inputs:n,layer:o,timeZone:d}=this;if(!o)return;const u={arcadeEditType:a,feature:e,initialFeature:i,layer:o,timeZone:d},p=n.slice(),h=s!=null&&s.elements&&s.elements.length>0?await this._updateInputsUsingFormElements(p,s.elements,u):this._updateInputsUsingLayerFields(p,o==null?void 0:o.fields,u);this.inputs=h,await this._startExpressions()}async _updateInputsUsingFormElements(e,i,a){const s=new Map;for(const d of e)if(Je(d)){s.set(d.element,d);for(const u of d.inputs)u.element&&s.set(u.element,u)}else d.element&&s.set(d.element,d);const n=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:s,updatedElements:i.filter(ca),sharedInitializationProperties:a,group:null,newExpressionExecutorPromises:n});for(const[d,u]of s.entries())s.delete(d),u.destroy();return await Promise.all(Array.from(n.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:i,updatedElements:a,sharedInitializationProperties:s,group:n,newExpressionExecutorPromises:o}=e,d=[];for(const u of a){const p=i.has(u),h=p?i.get(u):this._makeInputFromElement(u,s,n);if(h){if(d.push(h),await B(()=>!h.updating),this._assignExpressionExecutors(h,u,o),p)if(i.delete(u),Je(h)){const{feature:c,timeZone:m}=s;h.set({feature:c,timeZone:m})}else if(li(h)){const c=this.relationshipId===u.relationshipId;h.set(s),h.set({map:this.map,showAllEnabled:c})}else h.set(s);if(Bi(u)){const c=u.elements.filter(m=>ca(m));h.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:c,sharedInitializationProperties:s,group:h,newExpressionExecutorPromises:o})}}}return d}_updateInputsUsingLayerFields(e,i,a){var o,d;if(!Array.isArray(i))return Ua().warn(this.declaredClass,"No attribute fields found."),[];const s=new Map;for(const u of e)if(Je(u)){for(const p of u.inputs)p.destroy();u.inputs.length=0,u.destroy()}else li(u)?u.destroy():ut(u)&&(u.element!==null?u.destroy():s.set(u.field,u));const n=[];for(const u of i){const p=((o=a.feature)==null?void 0:o.getAttribute(u.name))??null,h=s.get(u)??new ua({field:u,preservesValueWhenHidden:(d=this.formTemplate)==null?void 0:d.preserveFieldValuesWhenHidden});n.push(h.set({...a,value:p})),s.delete(u)}for(const[u,p]of s.entries())s.delete(u),p.destroy();return n}_resetFieldInputValues(e){for(const i of this.allFieldInputs)i.value=e.getAttribute(i.name)}_makeInputFromElement(e,i,a){return Bi(e)?vr(e,i):Fs(e)?this._makeFieldInputFromElement(e,i,a):Cs(e)?this._makeRelationshipInputFromElement(e,i,a):Is(e)?_r(e,i):ks()}_makeFieldInputFromElement(e,i,a){var c;const{arcadeEditType:s,feature:n,initialFeature:o,layer:d,timeZone:u}=i,{fieldName:p}=e,h=p&&this._layerFieldsByName.get(p);return h?new ua({arcadeEditType:s,element:e,field:h,value:(n==null?void 0:n.getAttribute(e.fieldName))??null,feature:n,initialFeature:o,layer:d,group:a,preservesValueWhenHidden:(c=this.formTemplate)==null?void 0:c.preserveFieldValuesWhenHidden,timeZone:u}):null}_makeRelationshipInputFromElement(e,i,a=null){const{map:s}=this,{feature:n,layer:o,timeZone:d}=i,u=new dr({element:e,feature:n,group:a,layer:o,map:s,timeZone:d});return u.addHandles(ce(()=>u.relatedLayer,"edits",()=>{var p;return(p=this._expressionsManager)==null?void 0:p.evaluateAsyncExpressions()})),u}_assignExpressionExecutors(e,i,a){var o;const s=fr[i.type],n=[];for(const d of s){const u=`${d}Executor`;if(e[u]){this._useExecutor(e[u]);continue}const p=i[d];if(p!=null&&p!==""){const h=((o=this._expressionInfosLookup.get(p))==null?void 0:o.expression)??p;n.push(this._getOrCreateExecutorForExpression(h,a).then(c=>{e[u]=this._useExecutor(c)}))}}return $a(e)&&n.push(...this._assignTextElementExpressionExecutors(e,a)),n}_assignTextElementExpressionExecutors(e,i){const{_expressionInfosLookup:a}=this,s=[];for(const n of e.expressionsUsed){const o=a.get(n);o!=null?s.push(this._getOrCreateExecutorForExpression(o.expression,i).then(d=>e.setExpressionExecutor(n,this._useExecutor(d)))):q.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${n}'`)}for(const n of e.fieldsUsed){const o=`return $feature['${n}'];`;s.push(this._getOrCreateExecutorForExpression(o,i).then(d=>e.setFieldExecutor(n,this._useExecutor(d))))}return s}async _getOrCreateExecutorForExpression(e,i){const{_expressionExecutorLookup:a}=this;if(a.has(e))return a.get(e);if(i.has(e))return i.get(e);const s=rr(e,this.layer);i.set(e,s);const n=await s;return a.set(e,n),n}_createExpressionsManager(e){const{_arcadeContextInfo:i,_featureClone:a,allFieldInputs:s,formTemplate:n}=this;this._expressionsManager=new le({executors:e,feature:a,arcadeContextInfo:i,fieldInputs:s,preserveFieldValuesWhenHidden:(n==null?void 0:n.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=ft(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var h;const{name:i,value:a}=e,{_featureClone:s,formTemplate:n,layer:o}=this;if(!o)return;const d=s.getAttribute(i);s.setAttribute(i,a);const{typeFieldName:u,types:p}=ri(o);if((e.isSubtypeField||i===u)&&a!==d){if(o.type==="subtype-sublayer"){const m=(h=o.parent)==null?void 0:h.findSublayerForFeature(s);this.feature&&(this.feature.sourceLayer=m),s.sourceLayer=m}const c=new Set;for(const m of p)if(m.domains&&typeof m.domains=="object")for(const g of Object.keys(m.domains))c.add(g);for(const m of c){const g=this.findField(m);g&&g.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(n!=null){const{description:c,title:m}=n;m&&zi(m,i)&&this.notifyChange("formTitle"),c&&zi(c,i)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const i of this.allFieldInputs)i.value!==e.getAttribute(i.name)&&this._afterValueChange(i)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:i}=ri(this.layer),a=i?this.getValue(i):null,s=[];for(const d of e.fieldGroups){const{contingencies:u,fields:p,name:h}=d,c=[];for(const m of u)m.isRetired||m.subtype!=null&&m.subtype.code!==a||c.push({values:m.values});c.length>0&&s.push({name:h,fields:p,contingencies:c})}const[n,o]=this._generateJoinPlan(s);return[...n.flatMap(d=>this._joinFieldGroupContingencies(d)),...o.flatMap(d=>d.contingencies)]}_generateJoinPlan(e){const i=new Map,a=[],s=new Set;for(const p of e)for(const h of p.fields)if(i.has(h)){const c=i.get(h),m=p,g=[c.name,m.name].sort().join("|");if(s.has(g))continue;a.push([c,m]),s.add(g),i.set(h,m)}else i.set(h,p);const n=new Set(a.flat()),o=new Set(e);for(const p of n)o.delete(p);const d=new Map,u=new Map;for(const p of new Set(a.flat())){const h=Symbol(p.name);d.set(h,new Set([p])),u.set(p,h)}for(const[p,h]of a){const c=u.get(p),m=u.get(h);if(c===m)continue;const g=d.get(c),y=d.get(m);for(const _ of y)g.add(_),u.set(_,c);d.delete(m)}return[[...d.values()].map(p=>[...p]),[...o]]}_joinFieldGroupContingencies(e){var p,h;const i=e.slice(),a=i.shift();let s=i.shift(),n=this._generateJoinKey(a.fields,s.fields),o=new Set([...a.fields,...s.fields]),d=new Map;for(const c of a.contingencies){const[m]=this._hashContingency(c,n.codedValueFields,!0);d.has(m)?(p=d.get(m))==null||p.push(c):d.set(m,[c])}for(;i.length>0;){const c=new Map,m=i.shift(),g=this._generateJoinKey(o,m.fields);for(const y of s.contingencies){const[_,v]=this._hashContingency(y,n.codedValueFields),w=v?this._findMatchingContingenciesWithAnyHashMask(d,_):d.get(_);if(d.has(Ge)&&(w==null||w.push(...this._findMatchingContingenciesContainingAny(y,d.get(Ge),n.codedValueFields))),w!=null)for(const k of w){const V=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(k,y,n.rangeFields):this._joinContingencies(k,y);if(V==null)break;const[$]=this._hashContingency(V,g.codedValueFields,!0);c.has($)?(h=c.get($))==null||h.push(V):c.set($,[V])}}d=c,s=m,n=g,o=new Set([...o,...s.fields])}const u=[];for(const c of s.contingencies){const[m,g]=this._hashContingency(c,n.codedValueFields),y=g?this._findMatchingContingenciesWithAnyHashMask(d,m):d.get(m);if(d.has(Ge)&&y.push(...this._findMatchingContingenciesContainingAny(c,d.get(Ge),n.codedValueFields)),y!=null)for(const _ of y){const v=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(_,c,n.rangeFields):this._joinContingencies(_,c);v!=null&&u.push(v)}}return u}_joinContingencies(e,i){const a={values:{...e.values,...i.values}};for(const[s,n]of Object.entries(a.values))n.objectType==="any"&&e.values[s]!=null&&(a.values[s]=e.values[s]);return a}_joinContingenciesWithRangeDomains(e,i,a){const s=this._joinContingencies(e,i);for(const n of a){const o=e.values[n],d=i.values[n],{leftIsNull:u,rightIsNull:p,bothAreNull:h,leftIsAny:c,rightIsAny:m,bothAreAny:g,leftIsRange:y,rightIsRange:_}=this._compareObjectTypes(o.objectType,d.objectType);if(h||g)continue;if(u&&m||p&&c){s.values[n]=new H({objectType:"null"});continue}if(u&&_||p&&y)return null;c?(o.minValue=-1/0,o.maxValue=1/0):m&&(d.minValue=-1/0,d.maxValue=1/0);const v=Math.max(o.minValue,d.minValue),w=Math.min(o.maxValue,d.maxValue);if(v>w)return null;s.values[n]=new H({objectType:"range",minValue:v,maxValue:w})}return s}_findMatchingContingenciesContainingAny(e,i,a){return i.filter(s=>a.every(n=>{var u,p;const o=s.values[n],d=e.values[n];return o.objectType==="any"||d.objectType==="any"||((u=o.codedValue)==null?void 0:u.code)===((p=d.codedValue)==null?void 0:p.code)}))}_findMatchingContingenciesWithAnyHashMask(e,i){const a=RegExp(`${i}$`),s=[];for(const[n,o]of e){if(n===Ge)break;a.test(n)&&s.push(...o)}return s}_generateJoinKey(e,i){var h;const a=Array.isArray(e)?new Set(e):e,s=Array.isArray(i)?new Set(i):i,n=a.size<s.size?a:s,o=n===a?s:a,{feature:d}=this,u=new Set,p=new Set;for(const c of n)if(o.has(c)){const m=(h=this.layer)==null?void 0:h.getFieldDomain(c,{feature:d??void 0,excludeImpliedDomains:!0});if(m==null)continue;switch(m.type){case"coded-value":u.add(c);break;case"range":p.add(c)}}return{codedValueFields:[...u],rangeFields:[...p]}}_contingencyIsValid(e,i){const a={};for(const{name:s,value:n}of this.allFieldInputs)this.fieldsWithContingentValues.has(s)&&n!=null&&s!==e&&(a[s]=n);return Object.entries(a).every(([s,n])=>!i.values.hasOwnProperty(s)||In(n,i.values[s]))}_getContingentValueOptionsForField(e,i){const a=this.joinedContingentValues.slice(),s=new Map,n={code:"",name:i??"No value"};for(const o of a){const d=o.values[e];if((d==null?void 0:d.objectType)==="code"||(d==null?void 0:d.objectType)==="null"){const{code:u,name:p}=d.codedValue&&d.objectType!=="null"?d.codedValue:n;!s.has(u)&&this._contingencyIsValid(e,o)&&s.set(u,{name:p,value:u})}}return[...s.values()]}_hashContingency(e,i,a=!1){var o;if(i.length<1)return[yr,!1];const s=[];let n=!1;for(const d of i){const u=e.values[d];if(u.objectType==="any"){if(a)return[Ge,!0];n=!0,s.push(`${d}:.*`)}else u.objectType==="null"?s.push(`${d}:${gr}`):s.push(`${d}:${(o=u.codedValue)==null?void 0:o.code}`)}return[s.sort().join("&"),n]}_compareObjectTypes(e,i){return{leftIsNull:e==="null",rightIsNull:i==="null",bothAreNull:e==="null"&&i==="null",leftIsAny:e==="any",rightIsAny:i==="any",bothAreAny:e==="any"&&i==="any",leftIsRange:e==="range",rightIsRange:i==="range"}}get test(){return{featureClone:this._featureClone}}};function ca(t){return t.type==="field"||t.type==="group"||t.type==="relationship"||t.type==="text"||(Ua().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${t.label} has unsupported type '${t.type}'`),!1)}function vr(t,e){const{feature:i,layer:a}=e;return new or({element:t,inputs:[],feature:i,layer:a})}function _r(t,e,i=null){const{feature:a,layer:s,timeZone:n}=e;return new X({element:t,feature:a,group:i,layer:s,timeZone:n})}r([l()],E.prototype,"_expressionInfosLookup",null),r([l()],E.prototype,"_featureClone",void 0),r([l()],E.prototype,"_timeZone",void 0),r([l()],E.prototype,"activeRelationshipInput",null),r([l()],E.prototype,"_arcadeContextInfo",null),r([l()],E.prototype,"allFieldInputs",null),r([l()],E.prototype,"allGroupInputs",null),r([l()],E.prototype,"allRelationshipInputs",null),r([l()],E.prototype,"_layerFieldsByName",null),r([l()],E.prototype,"arcadeEditType",void 0),r([l()],E.prototype,"contingencyConstraintViolations",void 0),r([l()],E.prototype,"disabled",void 0),r([l()],E.prototype,"feature",null),r([l()],E.prototype,"fieldsWithContingentValues",null),r([l({type:Es})],E.prototype,"formTemplate",null),r([l()],E.prototype,"formDescription",null),r([l()],E.prototype,"formTitle",null),r([l()],E.prototype,"formHeaderVisible",null),r([l()],E.prototype,"highlightHelper",void 0),r([l()],E.prototype,"inputs",void 0),r([l()],E.prototype,"joinedContingentValues",null),r([l()],E.prototype,"layer",null),r([l()],E.prototype,"map",void 0),r([l()],E.prototype,"relatedRecordCallbacks",void 0),r([l()],E.prototype,"relationshipId",null),r([l()],E.prototype,"spatialReference",null),r([l()],E.prototype,"state",null),r([l()],E.prototype,"strict",void 0),r([l()],E.prototype,"submittable",null),r([l()],E.prototype,"timeZone",null),r([l()],E.prototype,"updating",null),r([l()],E.prototype,"valid",null),r([l()],E.prototype,"hasPendingSubtypeChoice",void 0),r([l()],E.prototype,"getValues",null),r([l()],E.prototype,"submit",null),r([l()],E.prototype,"test",null),E=r([x(Wa)],E);const Ti=E,Me="data-field-name";let T=class extends bi{constructor(e,i){super(e,i),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(a=>{a.length&&a[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new Ti,this._onShowAllRelatedRecordsClick=a=>{const{feature:s,relatedRecordCallbacks:n}=this;s&&(n!=null&&n.showAllRelatedRecords)&&n.showAllRelatedRecords({parentFeature:s,relationshipId:a})},this._onAddRelatedRecordsClick=(a,s)=>{const{feature:n,relatedRecordCallbacks:o}=this;n&&(o!=null&&o.addRelatedRecord)&&o.addRelatedRecord({parentFeature:n,relatedLayer:s,relationshipId:a})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([C(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),B(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),C(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[i]=e.invalid;e.invalid.forEach(a=>this._inputsWithChanges.add(a)),this._focusedFieldName=i,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),C(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return fe({block:()=>b(()=>import("./calcite-block-D8R8Hoik.js"),__vite__mapDeps([10,1,2,11]),import.meta.url),button:()=>b(()=>import("./calcite-button-Dn1EUE6k.js"),__vite__mapDeps([0,1,2]),import.meta.url),combobox:()=>b(()=>import("./calcite-combobox-Dx1DfZri.js"),__vite__mapDeps([12,13,1,2,14,15,8,16,17,9]),import.meta.url),"combobox-item":()=>b(()=>import("./calcite-combobox-item-wqobC9HP.js"),__vite__mapDeps([18,17,1,2,16]),import.meta.url),"combobox-item-group":()=>b(()=>import("./calcite-combobox-item-group-B5AHvFjX.js"),__vite__mapDeps([19,20,1,2,16]),import.meta.url),icon:()=>b(()=>import("./calcite-icon-CG93KzbT.js"),__vite__mapDeps([3,1,2]),import.meta.url),input:()=>b(()=>import("./calcite-input-BJbMR36K.js"),__vite__mapDeps([21,22,1,2,8,23,9,24]),import.meta.url),"input-date-picker":()=>b(()=>import("./calcite-input-date-picker-BtxZvBQc.js"),__vite__mapDeps([25,1,2,8,23,9,26,24]),import.meta.url),"input-message":()=>b(()=>import("./calcite-input-message-CU5EsQ98.js"),__vite__mapDeps([27,9,1,2]),import.meta.url),"input-number":()=>b(()=>import("./calcite-input-number-C9hWOfZ7.js"),__vite__mapDeps([28,29,1,2,8,23,9,24]),import.meta.url),"input-time-picker":()=>b(()=>import("./calcite-input-time-picker-CV6WZwfD.js"),__vite__mapDeps([30,1,2,8,23,9,26,24]),import.meta.url),"input-time-zone":()=>b(()=>import("./calcite-input-time-zone-joixbaE6.js"),__vite__mapDeps([31,1,2,13,14,15,8,16,17,9,20]),import.meta.url),label:()=>b(()=>import("./calcite-label-0SkcO5DK.js"),__vite__mapDeps([5,1,2]),import.meta.url),list:()=>b(()=>import("./calcite-list-CSiFAJ9a.js"),__vite__mapDeps([32,1,2,33,34,15,22,8,23,9,24]),import.meta.url),"list-item":()=>b(()=>import("./calcite-list-item-DtqS7ygw.js"),__vite__mapDeps([35,1,2,34,33,11]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-Bt4CsKoC.js"),__vite__mapDeps([36,1,2]),import.meta.url),notice:()=>b(()=>import("./calcite-notice-Bt_0bixh.js"),__vite__mapDeps([37,1,2]),import.meta.url),"radio-button":()=>b(()=>import("./calcite-radio-button-DN1jHyRu.js"),__vite__mapDeps([6,1,2]),import.meta.url),"radio-button-group":()=>b(()=>import("./calcite-radio-button-group-CJGiqTEW.js"),__vite__mapDeps([7,1,2,8,9]),import.meta.url),switch:()=>b(()=>import("./calcite-switch-BhcXTaI0.js"),__vite__mapDeps([38,1,2]),import.meta.url),"text-area":()=>b(()=>import("./calcite-text-area-BnIDUYgC.js"),__vite__mapDeps([39,1,2,8,23,9,40]),import.meta.url)})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _subtypes(){return Vs(this.layer)}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var i,a;(a=(i=this._prompt)==null?void 0:i.cancel)==null||a.call(i),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return f("div",{class:this.classes(A.base,yt.widget,yt.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return f("div",null,f("form",{class:A.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?f(La,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const i=e.formTitle!=null&&f(et,{key:"title",level:this.headingLevel},e.formTitle),a=e.formDescription!=null&&f("p",{class:A.description,key:"description"},e.formDescription);return f("div",{class:A.formHeader},i,a)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(Xe).filter(i=>i.visible).map(i=>this._renderInput(i))}_renderInput(e){return Je(e)?this._renderGroup(e):ut(e)?this._renderLabeledField(e):li(e)?this._renderRelationshipInput(e):$a(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,i){return e==null?null:f("div",{class:this.classes(A.description),id:i},e)}_renderGroup(e){const{disabled:i,formTemplate:a,headingLevel:s}=this,{description:n,id:o,inputs:d,label:u,open:p}=e,h=d.filter(y=>y.visible),c=this.viewModel.findField(this._focusedFieldName),m=(c==null?void 0:c.group)===e,g=this.groupDisplay==="sequential";return f("calcite-block",{class:this.classes(A.group,g?A.groupSequential:null,m?A.groupActive:null,i?A.inputDisabled:null),collapsible:!0,"data-group":e,description:n||void 0,disabled:i,heading:`${u}`,headingLevel:a!=null&&a.title?pt(s):s,id:o,key:o,open:p,onCalciteBlockToggle:({target:y})=>this._onGroupToggle(y,e)},h.map(y=>this._renderInput(y)))}_getFocusableInput(e,i){const a=En(this.viewModel.inputs);let s;if(e==="backward"&&a.reverse(),i)if(Je(i)){const n=i.inputs.find(o=>o.visible);s=n?a.indexOf(n):0}else{let n;if(Qt(i)&&!i.group.open){const o=i.group.inputs.filter(ut);n=e==="forward"?o[o.length-1]:o[0]}else n=i;s=a.indexOf(n)+1}else s=0;for(let n=s;n<a.length;n++){const o=a[n];if(o.visible&&ut(o))return o}return null}_renderLabeledField(e){var p;const{dataType:i,feature:a,label:s,layer:n,required:o}=e,d={"aria-label":o?Ce(this.messages.requiredFieldLabel,{name:s}):s,class:A.label,key:`${n.id}-${a.uid}-${e.name}`},u=[f("div",{class:A.labelTextContent,key:"labelTextContainer"},s,o?f("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),i!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return i==="date"&&((p=e.domain)==null?void 0:p.type)!=="coded-value"?f("label",{...d},u):f("calcite-label",{...d},u)}_renderFieldInput(e){const{dataType:i,domain:a,inputType:s,name:n}=e,o=this.getCommonInputProps(e);if((a==null?void 0:a.type)==="coded-value"){const d=this.viewModel.getFieldValueOptionsForField(n,this.messages.empty);return s!=="switch"||e.hasInvalidSwitchValue?s==="radio-buttons"?this._renderRadioButtonComponents(e,d.flat(),o):this._renderComboBoxComponent(e,d,o):this._renderSwitchComponent(e,o)}return s==="datetime-picker"||i==="date"?this._renderDateComponents(e,o):i==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,i){return e.inputType==="text-area"?i.readOnly?f("calcite-input",{...i,loading:e.updating,type:"textarea",onCalciteInputInput:a=>this._saveValueFromComponent(a.target)}):f("calcite-text-area",{...i,resize:"vertical",onCalciteTextAreaInput:a=>this._saveValueFromComponent(a.target)}):f("calcite-input",{...i,loading:e.updating,type:"text",onCalciteInputInput:a=>this._saveValueFromComponent(a.target)})}_renderNumberComponent(e,i){return f("calcite-input-number",{...i,integer:xs(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:a=>this._saveValueFromComponent(a.target)})}_renderDateComponents(e,i){const{field:a}=e;switch(a.type){case"date":return this._renderDateFieldComponents(e,i);case"date-only":return this._renderDateOnlyFieldComponent(e,i);case"time-only":return this._renderTimeOnlyFieldComponent(e,i);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,i);default:return this._renderReadOnlyComponent(e,Ms(a,i.value,{timeZone:this.timeZone,...$s(a)}))}}_renderDateOnlyFieldComponent(e,i){const{range:a,valid:s,value:n}=e,{class:o,key:d,readOnly:u}=i,{rawMax:p,rawMin:h}=a;return f("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:o,"data-date-part":"date","data-field-name":i[Me],key:`${d}-date-input`,max:Zi(p)?p:void 0,min:Zi(h)?h:void 0,numberingSystem:Ft,onblur:c=>{this._focusedFieldName=null,this._saveValueFromDateComponent(c.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:u,value:n!=null?`${n}`:void 0,onCalciteInputDatePickerChange:c=>this._saveValueFromDateComponent(c.target)})}_renderTimeOnlyFieldComponent(e,i){const{valid:a,value:s}=e,{class:n,key:o,readOnly:d}=i;return f("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!a,class:n,"data-date-part":"time","data-field-name":i[Me],key:`${o}-time-input`,numberingSystem:Ft,onblur:u=>{this._focusedFieldName=null,this._saveValueFromDateComponent(u.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:d,step:e.timeStep,value:s!=null?`${s}`:void 0,onCalciteInputTimePickerChange:u=>this._saveValueFromDateComponent(u.target)})}_renderTimestampOffsetFieldComponents(e,i){const{name:a,range:s,timeZone:n,valid:o,value:d}=e,{class:u,key:p,readOnly:h}=i,{rawMax:c,rawMin:m}=s,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:Ft,overlayPositioning:"fixed",readOnly:h,[Me]:a,onfocus:this._onComponentFocus},y=Ct(c,n),_=Ct(m,n),v=Ct(d,n);return f("div",{class:A.dateInputContainer,key:`${p}-date-time-container`},f("calcite-input-date-picker",{...g,class:u,"data-date-part":"date",key:`${p}-date-input`,max:(y==null?void 0:y.date)??void 0,min:(_==null?void 0:_.date)??void 0,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:v.date??void 0,onCalciteInputDatePickerChange:w=>this._saveValueFromDateComponent(w.target)}),f("calcite-input-time-picker",{...g,class:u,"data-date-part":"time",key:`${p}-time-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},step:e.timeStep,value:v.time??void 0,onCalciteInputTimePickerChange:w=>this._saveValueFromDateComponent(w.target)}),e.includeTimeOffset?f("calcite-input-time-zone",{...g,class:u,"data-date-part":"timeZone",disabled:h,key:`${p}-timezone-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:v.timeZoneOffset??"0",onCalciteInputTimeZoneChange:w=>this._saveValueFromDateComponent(w.target)}):null)}_renderDateFieldComponents(e,i){const{includeTime:a,name:s,valid:n,value:o}=e,{class:d,key:u,max:p,min:h,readOnly:c}=i,{timeZone:m}=this,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,numberingSystem:Ft,overlayPositioning:"fixed",readOnly:c,[Me]:s,onfocus:this._onComponentFocus},y=It(o,m),_=It(p,m),v=It(h,m);return f("div",{class:A.dateInputContainer,key:`${u}-date-time-container`},f("calcite-input-date-picker",{...g,class:d,"data-date-part":"date",key:`${u}-date-input`,max:(_==null?void 0:_.date)??void 0,min:(v==null?void 0:v.date)??void 0,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:y.date??void 0,onCalciteInputDatePickerChange:w=>this._saveValueFromDateComponent(w.target)}),a?f("calcite-input-time-picker",{...g,class:d,"data-date-part":"time",key:`${u}-time-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},step:1,value:y.time??void 0,onCalciteInputTimePickerChange:w=>this._saveValueFromDateComponent(w.target)}):null)}_renderReadOnlyComponent(e,i){const a=this.getCommonInputProps(e);return f("calcite-input",{...a,class:this.classes(A.fieldInput,A.inputDisabled),readOnly:!0,type:"text",value:i!=null?`${i}`:a.value})}_renderComboBoxComponent(e,i,a){const{value:s,name:n}=e,{viewModel:o,_inputsWithChanges:d}=this,u=o.arcadeEditType==="INSERT",p=d.has(n),h=s==null&&(!u||p),c=u&&e.showNoValueOptionEnabled&&!p?()=>{}:a.onblur;return f("calcite-combobox",{...a,allowCustomValues:!1,clearDisabled:!0,disabled:a.readOnly,onblur:c,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:m})=>{h&&m.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(m):e.isSubtypeField&&m.selectedItems.length===0?m.value=`${e.value}`:this._saveValueFromComponent(m)}},this.renderComboboxOptionsList(e,i))}renderComboboxOptionsList(e,i){const{value:a,name:s}=e,{messages:n,messagesTemplates:o,viewModel:d,_inputsWithChanges:u}=this,[p,h,c]=i.map(v=>v.map(({name:w,value:k})=>f("calcite-combobox-item",{key:`#${k}`,selected:a===k,textLabel:w,value:`${k}`}))),m=[];h.length>0&&m.push(f("calcite-combobox-item-group",{key:"other",label:o.other},h)),c.length>0&&m.push(f("calcite-combobox-item-group",{key:"unsupported",label:n.subtypes.unsupportedDomainGroupTitle},c)),m.length>0?m.unshift(f("calcite-combobox-item-group",{key:"recommended",label:n.recommended},p)):m.push(...p);const g=d.arcadeEditType==="INSERT",y=u.has(s),_=a==null&&(!g||y);return e.showNoValueOptionEnabled&&m.unshift(f("calcite-combobox-item",{key:"empty-option",selected:_,textLabel:e.showNoValueLabel||n.empty,value:""})),m}_renderRadioButtonComponents(e,i,a){const{name:s,value:n}=e,o=i.map(({name:d,value:u})=>this._renderRadioButtonComponent({key:d,label:d,name:s,value:u,selected:u===n,props:a}));if(e.showNoValueOptionEnabled){const d="",u=e.showNoValueLabel||this.messages.empty,p=n===d||n===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:u,name:s,value:d,selected:p,props:a}))}return f("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:A.inputRadioGroup,"data-field-name":a[Me],key:`${a.key}-radio-group`,layout:"vertical",name:a.key,required:a.required},o)}_renderSwitchComponent(e,i){const{value:a}=e,s=!!oi(e.element,"switch")&&a===e.element.input.onValue;return f("calcite-switch",{...i,checked:s,class:A.inputSwitch,disabled:i.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:n=>this._saveValueFromComponent(n.target)})}_renderRadioButtonComponent({key:e,name:i,value:a,selected:s,label:n,props:o}){return f("calcite-label",{class:A.inputRadioLabel,key:e,layout:"inline"},f("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:s,class:A.inputRadio,disabled:o.readOnly,name:i,onblur:()=>{this._focusedFieldName=null},value:a,onCalciteRadioButtonChange:({target:d})=>{d.checked&&this._saveValueFromComponent(d)}}),n)}_renderAuxiliaryText(e){const i=e.name,a=this._inputsWithChanges.has(i)&&!e.valid?Vn(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(i)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return a!=null?f("calcite-input-message",{icon:!0,status:"invalid"},a):this._inputsWithChanges.has(i)&&e.valueIsOutOfDomain?f("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:i,relationshipId:a,showAllActionVisible:s}=e,{relatedRecordCallbacks:n}=this;if(!s||!(n!=null&&n.showAllRelatedRecords))return;const o=this.messages;return f("calcite-list-item",{description:Ce(o.totalCount,{count:i}),label:o.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(a)},f("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:i,relationshipId:a,relatedLayer:s}=e,{messages:n,relatedRecordCallbacks:o}=this;if(i&&(o!=null&&o.addRelatedRecord)&&s)return f("calcite-button",{alignment:"center",appearance:"outline-fill",class:A.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${a}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(a,s)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?n.addRecord:n.addFeature)}_renderRelatedRecordListItem(e,i){const{feature:a,description:s,title:n}=e,{feature:o,relatedRecordCallbacks:d}=this,{highlightHelper:u}=this.viewModel,p=()=>{u==null||u.removeAll(),d!=null&&d.editRelatedRecord&&o&&d.editRelatedRecord({parentFeature:o,relationshipId:i,relatedFeature:a})},h=u?()=>u.add(a):void 0,c=u?()=>u.remove(a):void 0;return f("calcite-list-item",{bind:this,description:s,key:`${i}-${a.uid}`,label:n,onclick:p,onmouseenter:h,onmouseleave:c,value:n},f("calcite-icon",{icon:xn(a),slot:"content-start"}),f("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:i,relationshipId:a,showAllEnabled:s}=e,n=s?null:this._renderDescriptionOrEmpty(e.description),o=i>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return f("calcite-label",{class:this.classes(A.label,A.relatedRecordsLabel),key:`relationship-${a}-container`},f("div",null,this._renderRelatedRecordsHeaderContainer(e),n,o),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var a;const i=e.updating||!e.loaded;return f("div",{class:A.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},f("span",null,e.label),i?f("calcite-loader",{inline:!0,key:"loader",label:(a=this.messagesCommon)==null?void 0:a.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:i}=e;return f("calcite-list",{class:A.relatedRecordsList},e.relatedFeatureInfos.map(a=>this._renderRelatedRecordListItem(a,i)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var p,h,c;const{messages:i}=this,a=e.relatedLayerIsTable?i.noOriginKeyRecord:i.noOriginKeyFeature,s=(p=e.relationship)==null?void 0:p.keyField,n=this.viewModel.findField(s),o=(h=e.layer)==null?void 0:h.fieldsIndex.get(s),d=(n==null?void 0:n.label)||(o==null?void 0:o.alias)||s,u=Ce(a,{relatedLayerName:(c=e.relatedLayer)==null?void 0:c.title,originKeyField:d});return f("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},f("div",{slot:"message"},u))}_renderNoRelatedRecordsNotice(){return f("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},f("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return f("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:A.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return f("div",{class:A.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:i}=this,{editable:a,hint:s,label:n,maxLength:o,minLength:d,name:u,range:{max:p,min:h},required:c,valid:m,value:g}=e,y=this._inputsWithChanges.has(u),_=!a||i;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":m?"false":"true",class:this.classes(A.fieldInput,_?A.inputDisabled:null),status:y&&!m?"invalid":"idle",key:u,label:n,max:p??void 0,min:h??void 0,maxLength:o>-1?o:void 0,minLength:d>-1?d:void 0,placeholder:s??void 0,readOnly:_,required:c,value:g==null?"":`${g}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[Me]:u}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(Me))}_afterDateComponentCreate(e){const i=this._getFieldInputFromHTMLElement(e),a=e.dataset.datePart,s=this._dateComponentMap.get(i.name);if("valueAsDate"in e&&e.value!=null&&i.value!=null){const n=new ResizeObserver(()=>{switch(e.value=void 0,i.field.type){case"date":e.value=It(i.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=Ct(i.value,this.timeZone).date??"";break;default:e.value=`${i.value}`}n.unobserve(e)});n.observe(e)}if(s!=null)switch(a){case"date":s.date=e;break;case"time":s.time=e;break;case"timeZone":s.timeZone=e}else this._dateComponentMap.set(i.name,{[a]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const i=this._getFieldInputFromHTMLElement(e);Mn(i)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const i=e.selectedItem,a=e.querySelector("calcite-radio-button"),s=i||a;s&&this._afterComponentCreateOrUpdate(s)}_afterComponentCreateOrUpdate(e){const{viewModel:i}=this,a=this._getFieldInputFromHTMLElement(e),s=i.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&s===a&&(this._attemptFocusOnNextRender=!1,Qt(a)&&(a.group.open=!0),Ca(e))}_onComponentFocus(e){const i=e.target,a=this._getFieldInputFromHTMLElement(i);this._focusedFieldName=a.name}_onComponentBlur(e){const i=e.target;this._focusedFieldName=null,this._saveValueFromComponent(i)}_saveValueFromDateComponent(e){const{timeZone:i}=this,a=this._getFieldInputFromHTMLElement(e),s=a.field.type,{name:n,range:o}=a,d=this._dateComponentMap.get(n);if(!d)return;let u=this.viewModel.getValue(n),p=null;s==="date-only"?p=Array.isArray(e.value)?e.value[0]:e.value:s==="time-only"?(u=qi(u),p=qi(e.value)):p=s==="timestamp-offset"?e.value!=null?Ts({dateComponent:d.date,timeComponent:d.time,timeZoneComponent:d.timeZone,oldValue:u,defaultTimeZone:i}):null:e.value!=null?As({oldValue:u,dateComponent:d.date,timeComponent:d.time,timeZone:i,max:o.max,min:o.min}):null,p!==null&&e.value?u!==p&&this._updateFieldValue(n,p):this._updateFieldValue(n,null)}_saveValueFromComponent(e){const i=this._getFieldInputFromHTMLElement(e),a=this._parseValue(e),s=i.value;i.isSubtypeField&&$n(this.layer,s,a)?this._pendingSubtypeChoice||a===s||(this._pendingSubtypeChoice=this._handleSubtypeChoice(i,a)):this._updateFieldValue(i.name,a)}async _handleSubtypeChoice(e,i){var _;const{value:a,name:s}=e,{messages:n,viewModel:o,messagesCommon:d,_subtypes:u}=this;if(this._updateFieldValue(s,i),!(u!=null&&u.length))return;const p=u.find(v=>v.code===i),h=((_=u.find(v=>v.code===a))==null?void 0:_.name)??`${a}`;if(!p)return;o.hasPendingSubtypeChoice=!0;const c=st();let m="update-fields";const g=[{label:n.subtypes.useDefaultValuesOption,value:"update-fields"},{label:n.subtypes.keepCurrentValuesOption,value:"keep-existing"}],y={context:"info",title:n.subtypes.changeWarningTitle,message:Ce(n.subtypes.changeWarning,{originalType:h,newType:p.name}),radios:g,defaultRadioSelection:"update-fields",onRadioSelection:v=>m=v,actions:{primary:{label:d.apply,action:()=>c.resolve(m),type:"positive"},secondary:{label:d.cancel,type:"neutral",action:()=>c.resolve("undo")}},cancel:()=>c.reject()};try{switch(this.showPrompt(y),await c.promise){case"update-fields":o.applySubtypeDefaults(p),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,a)}}finally{o.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:i}){const a=this._getFieldInputFromHTMLElement(i);e==="Enter"&&Qt(a)&&!a.group.open&&(a.group.open=!0)}_updateFieldValue(e,i){const a=this.viewModel.getValue(e);this.viewModel.setValue(e,i),this._inputsWithChanges.add(e),a!==i&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([i,a])=>a!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const i=this._getFieldInputFromHTMLElement(e),a=e.value;return oi(i.element,"switch")?e.checked?i.element.input.onValue:i.element.input.offValue:a==null||a===""?null:i.dataType==="number"?a==="-0"||a==="-0."||a==="-0,"?a:parseFloat(a):i.field.type==="date"?parseFloat(a):a}_ignoreDeselectionOfNoValueOption(e){const{firstChild:i,selectedItems:a}=e;a.length===0&&i&&"selected"in i?i.selected=!0:q.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,i){var a;e.open?(i.open=!0,this._focusedFieldName=((a=this._getFocusableInput("forward",i))==null?void 0:a.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(s=>{s!==i&&(s.open=!1)})):i.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const i=e.filter(a=>a.open);i.length===0?e[0].open=!0:i.length>1&&i.slice(1).forEach(a=>a.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};r([l()],T.prototype,"_listObserverNode",void 0),r([l()],T.prototype,"_relatedRecordsEnabled",null),r([l()],T.prototype,"_prompt",void 0),r([l()],T.prototype,"_subtypes",null),r([l()],T.prototype,"disabled",null),r([l()],T.prototype,"feature",null),r([l()],T.prototype,"formTemplate",null),r([l()],T.prototype,"groupDisplay",void 0),r([l()],T.prototype,"headingLevel",void 0),r([l()],T.prototype,"icon",null),r([l()],T.prototype,"label",null),r([l()],T.prototype,"layer",null),r([l()],T.prototype,"map",null),r([l(),ge("esri/widgets/FeatureForm/t9n/FeatureForm")],T.prototype,"messages",void 0),r([l(),ge("esri/t9n/common")],T.prototype,"messagesCommon",void 0),r([l(),ge("esri/widgets/Feature/t9n/Feature")],T.prototype,"messagesFeature",void 0),r([l(),ge("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],T.prototype,"messagesTemplates",void 0),r([l()],T.prototype,"relatedRecordCallbacks",null),r([l()],T.prototype,"relationshipId",null),r([l()],T.prototype,"spatialReference",null),r([l()],T.prototype,"strict",null),r([l()],T.prototype,"timeZone",null),r([l()],T.prototype,"showPrompt",null),r([l()],T.prototype,"clearPrompt",null),r([l(),ki(["value-change","submit"])],T.prototype,"viewModel",void 0),r([l()],T.prototype,"test",null),T=r([x("esri.widgets.FeatureForm")],T);const wr=T;async function br(t,e){var i;return t.type==="subtype-sublayer"?await((i=t.parent)==null?void 0:i.load(e)):await t.load(e),t}function kr(t){const e=new Map,i=[];for(const a of t)if(De(a)){i.push(a);for(const s of a.items)e.set(s.template,s)}else e.set(a.template,a);return[e,i]}const De=t=>"items"in t;var ci;let te=ci=class extends G{constructor(t){super(t),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(C(()=>{const{layer:t}=this;return[t&&"renderer"in t?t.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},he))}get description(){var t;return(t=this.template)==null?void 0:t.description}set description(t){this.template&&(this.template.description=t)}get disabled(){var t;return((t=this.disabledFunction)==null?void 0:t.call(this,this))??!1}get label(){var t;return(t=this.template)==null?void 0:t.name}set label(t){this.template&&(this.template.name=t)}get id(){var t;return`${this.label??""}–${(t=this.layer)==null?void 0:t.id}`}get supportsUpload(){var t;return((t=this.layer)==null?void 0:t.type)==="scene"}clone(){const t=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,e=new ci({layer:this.layer,template:this.template});return e._set("thumbnail",t),e}static async fetchThumbnail(t,e){var s;const i=await Fr(t,e);if(i==null)return null;const a={maxSize:36};return((s=t.renderer)==null?void 0:s.type)==="dictionary"&&(a.fieldMap=t.renderer.fieldMap??void 0,a.feature={attributes:e.prototype.attributes??{}}),await Wn(i,a)}};r([l()],te.prototype,"description",null),r([l()],te.prototype,"disabled",null),r([l()],te.prototype,"disabledFunction",void 0),r([l()],te.prototype,"label",null),r([l()],te.prototype,"layer",void 0),r([l()],te.prototype,"template",void 0),r([l()],te.prototype,"thumbnail",void 0),r([l()],te.prototype,"id",null),r([l()],te.prototype,"supportsUpload",null),te=ci=r([x("esri.widgets.FeatureTemplates.TemplateItem")],te);const Na=te;async function Fr(t,e){const{renderer:i}=t;if(i){const a=new nt({attributes:e.prototype.attributes}),s=await i.getSymbolAsync(a);if(s)return s}return Cr(t)}async function Cr(t){const{geometryType:e}=t,i=e==="point"||e==="multipoint"?await b(()=>import("./index-iReJxP8N.js").then(a=>a.y4),__vite__mapDeps([1,2]),import.meta.url):e==="polyline"?await b(()=>import("./index-iReJxP8N.js").then(a=>a.y2),__vite__mapDeps([1,2]),import.meta.url):e==="polygon"||e==="mesh"||e==="multipatch"?await b(()=>import("./index-iReJxP8N.js").then(a=>a.y3),__vite__mapDeps([1,2]),import.meta.url):null;return i?new i.default:null}let Fe=class extends Os(G){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return e==null||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find(i=>i.template===e)}};r([l()],Fe.prototype,"allItems",void 0),r([l()],Fe.prototype,"filterFunction",void 0),r([l()],Fe.prototype,"items",null),r([l()],Fe.prototype,"label",void 0),r([l()],Fe.prototype,"id",null),Fe=r([x("esri.widgets.FeatureTemplates.TemplateItemGroup")],Fe);const Ir=Fe,Ht=t=>t==null||typeof t!="object"?[]:[..."templates"in t&&Array.isArray(t.templates)?t.templates:[],..."types"in t&&Array.isArray(t.types)?t.types.flatMap(e=>e.templates):[]];var Tt;const Er=({layer:t})=>({key:t,label:t.title??""}),Vr=({layer:t})=>({key:t.geometryType,label:t.geometryType??""});let W=Tt=class extends jt.EventedAccessor{constructor(t){super(t),this._allItems=[],this._updatingHandles=new at,this._updateAllItemsTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([C(()=>[this._featureTemplatesByLayer,this._groupByFunction],()=>{this._updateAllItemsTask=Dt(this._updateAllItemsTask);const t=Fi(e=>this._updateAllItems(e));this._updateAllItemsTask=t,this._updatingHandles.addPromise(t.promise)},Le),C(()=>this.filterFunction,t=>{for(const e of this._allItems)De(e)&&(e.filterFunction=t)},mt)])}get _featureTemplatesByLayer(){const t=new Map;if(!this.layers)return t;for(const e of this.layers)if(e.type==="subtype-group")for(const i of e.sublayers)t.set(i,Ht(i));else t.set(e,Ht(e));return t}set groupBy(t){if(this._set("groupBy",t),typeof t!="function")switch(t){case"layer":this._groupByFunction=Er;break;case"geometry":this._groupByFunction=Vr;break;default:this._groupByFunction=null}else this._groupByFunction=e=>this._ensureGroupByObject(t(e))}get layers(){return this._get("layers")}set layers(t){const e="layers";if(this.removeHandles(e),t){const i=()=>this.notifyChange("state");this.addHandles(t.map(a=>Re(()=>a.loadStatus,i)),e)}this._set("layers",t)}get state(){return this.updating?"loading":this.layers.length===0?"disabled":"ready"}get numberOfFeatureTemplates(){return Array.from(this._featureTemplatesByLayer.values()).reduce((t,e)=>t+e.length,0)}get items(){const{filterFunction:t}=this;return t==null?this._allItems:this._allItems.filter(e=>De(e)?e.items.length>0:t(e))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const t of this._allItems)De(t)&&t.reapplyFilter()}select(t,{emit:e=!0}={}){const i=this.selectedItem,a=(t==null?void 0:t.clone())||null;this._set("selectedItem",a),e&&this.emit("select",{item:a,oldItem:i,template:(a==null?void 0:a.template)??null})}_createItem(t,e){return new Na({disabledFunction:this.disabledItemFunction,layer:e,template:t})}_ensureGroupByObject(t){return typeof t=="string"?{key:t,label:t}:t}async _updateAllItems(t){var h,c;const e=this._allItems;if(this.numberOfFeatureTemplates===0)return xr(e),void(this._allItems=[]);const[i,a]=kr(e),s={signal:t},n=this._featureTemplatesByLayer,o=[];for(const[m,g]of n){await br(m,s),Ee(t);const y=(h=ht(m))==null?void 0:h.operations;if(y!=null&&y.supportsEditing&&(y!=null&&y.supportsAdd))for(const _ of g)i.has(_)?(o.push(i.get(_)),i.delete(_)):o.push(this._createItem(_,m))}for(const m of[...i.values(),...a])m.destroy();if(this._groupByFunction==null)return Ee(t),void(this._allItems=o);const d=new Map;for(const m of o){const g=this._groupByFunction(m),{key:y,label:_}=g.key!=null?g:Tt.nullGroupBy;d.has(y)||d.set(y,{label:_,items:[]}),(c=d.get(y))==null||c.items.push(m)}const{filterFunction:u}=this,p=Array.from(d.values()).map(({label:m,items:g})=>new Ir({allItems:g,filterFunction:u,label:m}));Ee(t),p.length===1&&p[0].label===Tt.nullGroupBy.label?this._allItems=p[0].allItems:this._allItems=p}};function xr(t){for(const e of t){if(De(e))for(const i of e.items)i.destroy();e.destroy()}}W.nullGroupBy={key:Symbol(),label:"Other​"},r([l()],W.prototype,"_allItems",void 0),r([l()],W.prototype,"_featureTemplatesByLayer",null),r([l()],W.prototype,"_groupByFunction",void 0),r([l()],W.prototype,"_updatingHandles",void 0),r([l()],W.prototype,"disabled",void 0),r([l()],W.prototype,"disabledItemFunction",void 0),r([l({value:null})],W.prototype,"filterFunction",void 0),r([l()],W.prototype,"groupBy",null),r([l({value:[]})],W.prototype,"layers",null),r([l()],W.prototype,"state",null),r([l({readOnly:!0})],W.prototype,"numberOfFeatureTemplates",null),r([l({readOnly:!0})],W.prototype,"items",null),r([l({readOnly:!0})],W.prototype,"selectedItem",void 0),r([l()],W.prototype,"updating",null),W=Tt=r([x("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],W);const hi=W,Se="esri-item-list",Et=`${Se}__list-item`,me={filterContainerSticky:`${Se}__filter-container--sticky`,group:`${Se}__group`,groupHeader:`${Se}__group__header`,item:Et,itemDisabled:`${Et}--disabled`,itemIcon:`${Et}-icon`,itemContentEnd:`${Et}-content-end`,noMatchesMessage:`${Se}__no-matches-message`,scroller:`${Se}__scroller`,scrollerEnabled:`${Se}__scroller--enabled`},Mr=4;function Ha(t){const{disabled:e,filterText:i="",id:a,messages:s,onFilterChange:n,...o}=t;return f("div",{key:a},t.filterEnabled??1?Ar({disabled:e,filterText:i,id:a,messages:s,onFilterChange:n}):null,Tr({...o,disabled:e,enableListScroll:t.enableListScroll??!0,filterText:i,messages:s}))}function $r(t){return!!t.items}function Tr(t){const{headingLevel:e,items:i,...a}=t;return i.length===0?f("div",{class:me.noMatchesMessage,key:"no-matches"},t.messages.noMatches):f("div",{class:gt({[me.scroller]:!0,[me.scrollerEnabled]:!!t.enableListScroll}),key:"item-container"},i.map(s=>$r(s)?Or({...a,group:s,headingLevel:e}):Ai({...a,grouped:!0,item:s})))}function Ar(t){const{disabled:e,messages:i,filterText:a,enableListScroll:s}=t;return f("div",{class:s?void 0:me.filterContainerSticky,key:"filter"},f("calcite-input",{disabled:e,placeholder:i.filterPlaceholder,type:"search",value:a,onCalciteInputInput:n=>{const o=n.currentTarget;t.onFilterChange&&t.onFilterChange(o.value)}}))}function Ai(t){const{disabled:e,grouped:i,identify:a,item:s,onItemMouseEnter:n,onItemMouseLeave:o,onItemSelect:d,renderIcon:u,renderCustomItem:p,renderItemContent:h,renderItemContentEnd:c,renderItemLabel:m,renderItemDescription:g,selectedItem:y}=t,_=ha(s,a),v=_===ha(y,a),w=p==null?void 0:p(t);if(w)return w;const k=h==null?void 0:h(s),V=c==null?void 0:c(s),$=!(!s.disabled&&!e);return f("calcite-list-item",{afterUpdate:S=>{S.selected=v},"aria-level":i?"2":"",class:gt({[me.item]:!0,[me.itemDisabled]:$}),"data-item":s,description:k?void 0:(g==null?void 0:g(s))??void 0,disabled:$,key:_,label:k?void 0:(m==null?void 0:m(s))??s.label??void 0,onmouseenter:S=>n==null?void 0:n(ii(S)),onmouseleave:S=>o==null?void 0:o(ii(S)),selected:v,tabIndex:$?-1:0,onCalciteListItemSelect:S=>{S.preventDefault(),d==null||d(ii(S))}},f("div",{class:me.itemIcon,key:"content-start",slot:"content-start"},u==null?void 0:u(s)),k?f("div",{key:"content",slot:"content"},k):null,V?f("div",{class:me.itemContentEnd,key:"content-end",slot:"content-end"},V):null)}function ha(t,e){return t?`${(e==null?void 0:e(t))||t.id}__${t.label}`:""}function ii(t){return t.currentTarget["data-item"]}function Or(t){const{disabled:e,group:i,headingLevel:a=Mr,selectionMode:s="none",renderCustomGroupContent:n,...o}=t,d=n==null?void 0:n(t);return f("div",{class:me.group,key:i.label??void 0},f(et,{class:me.groupHeader,level:a},i.label),d||f("calcite-list",{disabled:e,selectionAppearance:"border",selectionMode:s},i.items.map(u=>Ai({...o,disabled:e,item:u,grouped:!0}))))}let At=class extends G{constructor(e){super(e),this.filter=!0}};r([l({type:Boolean,nonNullable:!0})],At.prototype,"filter",void 0),At=r([x("esri.widgets.FeatureTemplates.VisibleElements")],At);const Ga=At,Sr={base:"esri-feature-templates"};function Lr(t){return t.length>0&&De(t[0])}function Rr(t){return t.id}let L=class extends bi{constructor(e,i){super(e,i),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new hi,this.visibleElements=new Ga,this.renderCustomItem=a=>null,this.renderCustomGroupContent=a=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=a=>null,this.renderItemContentEnd=a=>null,this._iconIntersectionObserver=new IntersectionObserver((a,s)=>{a.forEach(async n=>{if(n.isIntersecting){const o=n.target;if(Dr(o))return void s.unobserve(o);const d=Pr(o),{layer:u,template:p}=d;ma(o,!0);const h=await Na.fetchThumbnail(u,p).catch(()=>(ma(o,!1),null));if(h==null)return;o.appendChild(h)}})}),this._renderItemIcon=a=>Pe(a.layer)?f("span",{"data-has-icon":!0,"data-item":a,key:"icon"},f("calcite-icon",{icon:"table"})):f("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":a,key:"icon"}),this._afterItemCreateOrUpdate=a=>{var s;(s=this._iconIntersectionObserver)==null||s.observe(a)},this._afterItemRemoved=a=>{var s;(s=this._iconIntersectionObserver)==null||s.unobserve(a)}}initialize(){const e=({label:i})=>!this.filterText||!!(i!=null&&i.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(C(()=>this.viewModel,(i,a)=>{i&&!i.filterFunction&&(this.filterFunction=e),a&&a!==i&&a.filterFunction===e&&(a.filterFunction=null)},he))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return fe({icon:()=>b(()=>import("./calcite-icon-CG93KzbT.js"),__vite__mapDeps([3,1,2]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-Bt4CsKoC.js"),__vite__mapDeps([36,1,2]),import.meta.url),input:()=>b(()=>import("./calcite-input-BJbMR36K.js"),__vite__mapDeps([21,22,1,2,8,23,9,24]),import.meta.url),list:()=>b(()=>import("./calcite-list-CSiFAJ9a.js"),__vite__mapDeps([32,1,2,33,34,15,22,8,23,9,24]),import.meta.url),"list-item":()=>b(()=>import("./calcite-list-item-DtqS7ygw.js"),__vite__mapDeps([35,1,2,34,33,11]),import.meta.url),notice:()=>b(()=>import("./calcite-notice-Bt_0bixh.js"),__vite__mapDeps([37,1,2]),import.meta.url)})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,i){return this.viewModel.select(e,i)}render(){const{disabled:e,enableListScroll:i,filterText:a,headingLevel:s,messages:n,viewModel:{items:o,numberOfFeatureTemplates:d,selectedItem:u,state:p}}=this,h=this.visibleElements.filter&&d>1;if(Lr(o)){const c=o.find(m=>m.label===hi.nullGroupBy.label);c&&(c.label=n.other)}return f("div",{"aria-label":n.widgetLabel,class:this.classes(Sr.base,yt.widget)},p==="loading"?f("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):p==="ready"?f(Ha,{disabled:e,enableListScroll:i,filterEnabled:h,filterText:a,headingLevel:s,id:this.id,identify:Rr,items:o,messages:{filterPlaceholder:n.filterPlaceholder,noItems:n.noItems,noMatches:n.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:u??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:c=>{this.filterText=c},onItemSelect:c=>!De(c)&&this.viewModel.select(c)}):null)}};function Pr(t){return t==null?void 0:t["data-item"]}function Dr(t){return!!(t!=null&&t["data-has-icon"])}function ma(t,e){t&&(t["data-has-icon"]=e)}r([l()],L.prototype,"disabled",null),r([l()],L.prototype,"enableListScroll",void 0),r([l()],L.prototype,"filterFunction",null),r([l()],L.prototype,"filterText",void 0),r([l()],L.prototype,"groupBy",null),r([l()],L.prototype,"headingLevel",void 0),r([l()],L.prototype,"icon",null),r([l()],L.prototype,"label",null),r([l()],L.prototype,"layers",null),r([l(),ge("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],L.prototype,"messages",void 0),r([l(),ge("esri/t9n/common")],L.prototype,"messagesCommon",void 0),r([l({readOnly:!0})],L.prototype,"selectedItem",null),r([l()],L.prototype,"selectionMode",void 0),r([l(),ki("select")],L.prototype,"viewModel",void 0),r([l({type:Ga,nonNullable:!0})],L.prototype,"visibleElements",void 0),r([l()],L.prototype,"renderCustomItem",void 0),r([l()],L.prototype,"renderCustomGroupContent",void 0),r([l()],L.prototype,"renderItemLabel",void 0),r([l()],L.prototype,"renderItemDescription",void 0),r([l()],L.prototype,"renderItemContent",void 0),r([l()],L.prototype,"renderItemContentEnd",void 0),L=r([x("esri.widgets.FeatureTemplates")],L);const Wr=L,je="esri-editor",Be={base:je,helpMessage:`${je}__help-message`,updateActions:`${je}__update-actions`,updateActionsList:`${je}__update-actions-list`,featureTemplatesContainer:`${je}__feature-templates-container`,templateItemContentEnd:`${je}__template-item-content-end`};function Ur(t){return t==null?null:JSON.stringify(t)}let pe=class extends G{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){var e,i;return!Nr((e=this.initialFeature)==null?void 0:e.attributes,(i=this.feature)==null?void 0:i.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(e=this.feature){this.initialFeature=e==null?void 0:e.clone()}updateAttributes(e){const{feature:i}=this;i&&(i.attributes=e,this.notifyChange("attributesModified"))}updateGeometry(e){const{feature:i}=this;i&&(i.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const i=e==null?void 0:e.geometry;return Ur((i==null?void 0:i.type)==="mesh"?{transform:i.transform,vertexSpace:i.vertexSpace}:i)}};function Nr(t,e){const i=t??{},a=e??{},s=new Set(Object.keys(i));Ss(s,Object.keys(a));for(const n of s)if(!Hr(i[n],a[n]))return!1;return!0}function Hr(t,e){return!(!fa(t)||!fa(e))||t===e}function fa(t){return t==null||t===""}r([l()],pe.prototype,"_stagedForDelete",void 0),r([l()],pe.prototype,"attributesModified",null),r([l()],pe.prototype,"feature",void 0),r([l()],pe.prototype,"geometryModified",null),r([l()],pe.prototype,"initialFeature",void 0),r([l()],pe.prototype,"modified",null),pe=r([x("esri.widgets.Editor.Edits")],pe);let oe=class extends G{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.parent=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null,this._pendingEdits=new Ta}get pendingFeatures(){return new Qe([...this._pendingEdits.keys()])}addPendingFeature(e,i=e){const{_pendingEdits:a}=this;if(a.has(e))return a.get(e);const s=new pe({feature:e});return s.trackChanges(i),a.set(e,s),s}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){const{_pendingEdits:i}=this,a=i.get(e);a&&(a.destroy(),i.delete(e))}};r([l()],oe.prototype,"creationInfo",void 0),r([l()],oe.prototype,"editorItem",void 0),r([l()],oe.prototype,"parent",void 0),r([l()],oe.prototype,"pendingFeatures",null),r([l({constructOnly:!0})],oe.prototype,"sketchOptions",void 0),r([l()],oe.prototype,"snappingManager",void 0),r([l()],oe.prototype,"viewModel",void 0),r([l()],oe.prototype,"upload",void 0),oe=r([x("esri.widgets.Editor.CreateFeaturesWorkflowData")],oe);function Gr(t){return t.type==="update"}function Oi(t){const e=t.sourceLayer;if(!e||e.type!=="feature"||!qr(e.renderer))return{rotation:null,size:null};let i=null,a=null;const s=e.renderer.getVisualVariablesForType("rotation").filter(o=>(!o.axis||o.axis==="heading")&&o.field&&!o.valueExpression&&Rs(o,t)!=null);s.length===1&&(i=jr(s[0],e));const n=e.renderer.getVisualVariablesForType("size").filter(o=>o.field&&!o.useSymbolValue&&!o.valueExpression&&Ps(o)===Ds.RealWorldSize&&Ws(o,t)!=null);return n.length===1&&(a=Zr(n[0],e)),{rotation:i,size:a}}function jr(t,e){const i=(t.axis||"heading")==="heading"&&t.rotationType==="arithmetic"?-1:1,a=t.field,s=e.fields&&e.fields.filter(d=>d.name===a),n=s&&s.length===1?s[0].type:"double",o={initial:0,current:0};return{field:a,fieldType:n,getDefault:()=>Promise.resolve(0),getValue:d=>(o.current=o.initial-i*d,mi((o.current+360)%360,n)),setInitialValue:d=>{o.initial=d,o.current=0},isUpdatingInteractively:!1,rotationType:t.rotationType??"geographic"}}function Br(t,e){switch(e){case"width":return t[0];case"depth":return t[1];case"height":return t[2];default:return t[2]||t[1]||t[0]}}async function zr(t,e,i){if(e==null)return 0;const{symbol:a}=Hs(e);if(a==null||a.type==="web-style"||a.type==="cim")return 0;const s=a.symbolLayers.at(0);if(!s)return 0;switch(s.type){case"icon":{const{computeIconLayerResourceSize:n}=await b(()=>import("./symbolLayerUtils-Bt0u6V2_.js"),__vite__mapDeps([41,1,2]),import.meta.url);return s.size||Math.min(we.icon,(await n(s,we.icon))[0])||we.icon}case"text":return s.size||we.text;case"line":return s.size||we.line;case"object":{const{computeObjectLayerResourceSize:n}=await b(()=>import("./symbolLayerUtils-Bt0u6V2_.js"),__vite__mapDeps([41,1,2]),import.meta.url);return Br(await n(s,t.scale/we.viewScaleSizeFactor),i)}case"path":return(s.width!=null?s.width:s.height)||t.scale/we.viewScaleSizeFactor;case"extrude":return s.size||t.scale/we.viewScaleSizeFactor;default:return 0}}function Zr(t,e){const i=t.field,a=t.axis,s=e.fields&&e.fields.filter(p=>p.name===i),n=s&&s.length===1?s[0].type:"double",o={initial:0,current:0},d=Us[t.valueUnit]??1;let u;return u=t.valueRepresentation==="area"?p=>(p*d/2)**2*Math.PI:t.valueRepresentation==="radius"||t.valueRepresentation==="distance"?p=>p*d/2:p=>p*d,{field:i,fieldType:n,getDefault:async(p,h)=>mi(u(await zr(h,p,a)),n),getValue:(p,h)=>(o.initial||(o.initial=h.pixelSizeAt(h.center)),o.current=o.initial*p,mi(o.current,n)),setInitialValue:p=>{o.initial=p,o.current=0},isUpdatingInteractively:!1,displayUnit:uo(t.valueUnit),axis:t.axis}}function mi(t,e){switch(e){case"small-integer":case"integer":case"long":return Math.round(t);case"double":case"single":return t;default:return 0}}function qr(t){switch(t==null?void 0:t.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function _e(t,e,i){const a=await di(t,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:e,scale:i});Ls(t.symbol,a)!=null&&(t.symbol=a)}function Kr(t){if(!t)throw new Error("no geometry type");return t==="multipatch"?"mesh":t}async function Jr(t,e,i){const a=e.layer,s=ja(e);let n=null;const{view:o}=t,d=(o==null?void 0:o.type)==="2d";if(await ya(t,a,s,i,d?o.scale:null),d){const h=_t(c=>ya(t,a,s,i,c));n=C(()=>o.scale,c=>h(c))}const{data:u,editing:p}=a.capabilities;return t.layer.elevationInfo=a.elevationInfo,e.geometryToPlace==null?await t.create(Kr(a.geometryType),{graphicProperties:{attributes:s,sourceLayer:a},hasZ:u.supportsZ,defaultZ:(d?p.zDefault:null)??t.defaultCreateOptions.defaultZ}):await t.place(e.geometryToPlace,{graphicProperties:{attributes:s,sourceLayer:a}}),n??R()}function ja(t){var e;return{...(e=t.template)==null?void 0:e.prototype.attributes,...t.attributeOverrides}}async function ya(t,e,i,a,s){const n=new nt({sourceLayer:e,attributes:i}),{rotation:o,size:d}=Oi(n);let u=await di(n,{useSourceLayer:!0,webStyleCache:a,scale:s}),p=!1;for(const h of[d,o])h!=null&&i[h.field]==null&&(i[h.field]=await h.getDefault(u,t.view),p=!0);switch(p&&(u=await di(n,{useSourceLayer:!0,webStyleCache:a,scale:s})),u==null?void 0:u.type){case"simple-fill":case"polygon-3d":t.polygonSymbol=u;break;case"simple-line":case"line-3d":t.polylineSymbol=u;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":t.pointSymbol=u;break;case"mesh-3d":t.meshSymbol=u}Ba(t.tooltipOptions,d,o)}function Ba(t,e,i){t.visualVariables=e!=null||i!=null?{size:e!=null?{unit:e.displayUnit,axis:e.axis,valueType:e.fieldType}:null,rotation:i!=null?{valueType:i.fieldType,rotationType:i.rotationType??"geographic"}:null}:null}function Qr(t,e){return t==null?void 0:t.find(i=>i.layer===e)}async function Yr(t,e,i,a){switch(e.type){case"3d":return Xr(t,e,i,a);case"2d":return eo(t,e,i,a)}}async function Xr(t,e,i,a){if(t.length===0)return[];const{updatable:s,graphicsByLayer:n}=await i.async(async()=>{const{results:o}=await Wt(Bs(e,i),a),d=new Map,u=h=>{const c=h.layer,m=d.get(c);if(!m){const g=new Array;return d.set(c,g),g}return m};Ea(o).forEach(({graphic:h})=>u(h).push(h));const p=t.filter(({capabilities:h,layer:c})=>h.update.enabled&&d.has(c));return p.length!==0&&i.stopPropagation(),{updatable:p,graphicsByLayer:d}});return Wt(Promise.allSettled(s.map(async({layer:o})=>{const d=n.get(o),u=za(o);if(d.every(c=>zs(u,c)))return d;const p=[];for(const c of d){p.push(c.getObjectId());const m=Object.keys(c.attributes);Zs(u,m)}const h=o.createQuery();return h.returnGeometry=!1,h.objectIds=p,h.outFields=wi(o.fieldsIndex,u),o.queryFeatures(h,{signal:a}).then(({features:c})=>c)})),a)}async function eo(t,e,i,a){if(t.length===0)return[];const{mapPoint:s}=i;if(s==null)return[];let n=null;const o=await i.async(async()=>{const{results:d}=await Wt(e.hitTest(i),a);if(d.length===0)return[];const u=new Set;n=Ea(d),n.forEach(({graphic:h})=>h&&u.add(h.layer));const p=t.filter(h=>u.has(h.layer)&&h.supportsUpdateWorkflow);return p.length>0&&i.stopPropagation(),p});return Wt(Promise.allSettled(o.map(async({layer:d})=>{const u=d.createQuery();u.returnGeometry=!1,u.outFields=za(d);const p="renderer"in d?Gs({renderer:d.renderer,pointerType:i.pointerType}):0;u.geometry=js(s,p,e),u.outSpatialReference=e.spatialReference;const{features:h}=await d.queryFeatures(u,{signal:a});return n==null||n.forEach(({graphic:c})=>{c.layer!==d||h.some(m=>m.getObjectId()===c.getObjectId())||h.push(c)}),h})),a)}function za(t){return wi(t.fieldsIndex,[t.objectIdField,Va({displayField:"displayField"in t?t.displayField:null,fields:t.fields})])}async function to(t,e,i){const{sourceLayer:a}=t,s=a.createQuery();s.objectIds=[t.getAttribute(a.objectIdField)],s.outFields=["*"],s.returnM=a.capabilities.data.supportsM,s.returnZ=a.capabilities.data.supportsZ,a.type==="scene"&&a.infoFor3D!=null||(s.outSpatialReference=e);const n=await a.queryFeatures(s,{signal:i});return Ee(i),n.features[0]}async function Ot(t){var h;const{graphic:e,sketchViewModel:i,sourceLayer:a,visualVariables:s,webStyleCache:n}=t;let o=!1;const{rotation:d,size:u}=s;if([d,u].forEach(async c=>{if(c==null)return;const m=e.getAttribute(c.field);if(m!=null)c.setInitialValue(m);else{const g=await c.getDefault(e.symbol,i.view);c.setInitialValue(g),e.setAttribute(c.field,g),o=!0}}),o){const c=((h=i.view)==null?void 0:h.type)==="2d"?i.view.scale:null;await _e(e,n,c)}const p={multipleSelectionEnabled:!1};return a.geometryType==="point"&&(p.enableRotation=d!=null,p.enableScaling=u!=null),Ba(i.tooltipOptions,u,d),i.layer.elevationInfo=a.elevationInfo,i.update(e,p)}function io(t){return t==null||t.type!=="rotate-start"&&t.type!=="rotate"&&t.type!=="rotate-stop"?null:t}function ao(t){return t==null||t.type!=="scale-start"&&t.type!=="scale"&&t.type!=="scale-stop"?null:t}async function Za(t,e,i,a,s){var p;if(e.geometry==null||((p=e.geometry)==null?void 0:p.type)!=="point")return;const n=a.rotation,o=io(i.toolEventInfo);if(n!=null&&o!=null){const{field:h,getValue:c}=n;o.type==="rotate-stop"?(n.isUpdatingInteractively=!1,n.setInitialValue(e.getAttribute(h))):(n.isUpdatingInteractively=!0,e.setAttribute(h,c(o.angle,t)))}const d=a.size,u=ao(i.toolEventInfo);if(d!=null&&u!=null){const{field:h,getValue:c}=d;u.type==="scale-stop"?(d.isUpdatingInteractively=!1,d.setInitialValue(e.getAttribute(h))):(d.isUpdatingInteractively=!0,e.setAttribute(h,c(u.xScale,t)))}await _e(e,s,t.type==="2d"?t.scale:null)}async function so({feature:t,featureClone:e,visualVariableAttributes:i,sketchViewModel:a,view:s,onUpdate:n,webStyleCache:o,addUpdatingPromise:d,addHandle:u}){var k;await _e(e,o,s.type==="2d"?s.scale:null);let p=null;if(((k=a==null?void 0:a.view)==null?void 0:k.type)==="2d"){const V=_t($=>_e(e,o,$));p=C(()=>{var $;return($=a==null?void 0:a.view)==null?void 0:$.scale},$=>V($))}const h=e.sourceLayer,c=tt(s,h);await Ot({graphic:e,sketchViewModel:a,sourceLayer:h,visualVariables:i,webStyleCache:o});let m=null;c.then(V=>m=V).catch(()=>{});const g=i.size,y=i.rotation,_=C(()=>t.attributes,async V=>{let $=!1;for(const S in V){const re=V[S];re!==e.getAttribute(S)&&(e.setAttribute(S,re),g==null||g.isUpdatingInteractively||g.field!==S||g.setInitialValue(re),y==null||y.isUpdatingInteractively||y.field!==S||y.setInitialValue(re),(m==null||m.requiredFields.includes(S))&&($=!0))}$&&await _e(e,o,s.type==="2d"?s.scale:null)}),v=a.on("update",async V=>{const $=V.graphics[0],S={graphic:$,sketchViewModel:a,sourceLayer:h,visualVariables:i,webStyleCache:o};if(V.state==="complete"){if(s.activeTool===null)return Ot(S);const re=new AbortController,bt=Ci(re);return u(bt),d(B(()=>s.activeTool===null,re.signal).then(()=>(re.abort(),Ot(S))))}await Za(s,$,V,i,o),n(fi($),V)}),w=a.on(["undo","redo"],async V=>{n(fi(V.graphics[0]),V)});return ve([w,v,R(()=>a.cancel()),_,p])}async function no(t,e,i){const a=t.view;t.layer.add(i);const s=e.sourceLayer,n=e.layer,o=e.getAttribute(n.objectIdField);let d=null;function u(p){d==null||d.abort(),d=Fi(async h=>{var m;const c=await tt(a,s);Ee(h),(m=c.setVisibility)==null||m.call(c,o,p)})}return await oo(a,i),u(!1),ve([ro(a,i,p=>u(!p)),R(async()=>{u(!0);try{const p=await tt(a,s);await B(()=>!p.updating)}finally{t.layer.remove(i)}})])}function ro(t,e,i){if(t.type==="3d"){const a=new Aa({graphic:e});return ve([t.trackGraphicState(a),C(()=>a.displaying,i)])}return C(()=>e.visible,i)}async function oo(t,e){if(t.type==="3d"){const i=new Aa({graphic:e}),a=t.trackGraphicState(i);await B(()=>i.displaying||i.error),a.remove()}else await B(()=>e.visible)}const we={icon:Kt(24),text:Kt(12),line:Kt(1),viewScaleSizeFactor:100};function qa(t,e,i){let a=!1;return t.filter(s=>!!a||(a=s===e,a)).map(s=>i[s]())}function lo(t,e){t.viewModel.syncFeatureTemplates();const i=t.creationInfo;if(e[0].id==="awaiting-feature-creation-info"&&i){const a=i.layer,s=Ht(a);s.length===1&&a.type!=="scene"&&(i.template=s[0],e.shift())}return e}function uo(t){return t==="unknown"?null:t}function po(t){t.filesEnabled=!0,t.mode="view",t.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Ka=t=>/-stop/.test(t)||/vertex-/.test(t),tt=(t,e)=>{const i=e.type==="subtype-sublayer"?e.parent:e;return t.whenLayerView(i)};function co(t){return"createInteractiveEditSession"in t}function fi(t){var i;const e=t.geometry;if((e==null?void 0:e.type)==="mesh"){const a=t.cloneShallow();return a.attributes=Ns(t.attributes),a.geometry=e.cloneShallow(),a.geometry.transform=((i=e.transform)==null?void 0:i.clone())??null,a}return t.clone()}function yi(t){const e=t.cursor;return t.cursor="progress",R(()=>t.cursor=e)}async function ho({view:t,data:e,signal:i,next:a,cancel:s}){const{creationInfo:n}=e;if(!n)return R();if(!ct(n))return R();const{layer:o}=n,d=n.geometryToPlace!=null;if(n.geometryToPlace=null,d)return s(),R();const{Upload:u}=await b(()=>import("./Upload-zMPX__2f.js"),__vite__mapDeps([42,1,2,43,44]),import.meta.url);Ee(i);const p=new u;e.upload=p;let h=null;const c=()=>h==null?void 0:h.remove(),m=ve([C(()=>p.state,g=>{switch(g){case"default":case"error":c();break;case"pending":c(),h=yi(t);break;case"success":{n.maxFeatures=1;const{result:y}=p;(y==null?void 0:y.type)==="georeferenced"||(y==null?void 0:y.type)==="georeferenced-reprojected"?(n.geometryToPlace=y.mesh,n.initialFeature=new nt({attributes:ja(n),geometry:y.mesh,sourceLayer:o}),t.goTo(n.initialFeature,{animate:!1}).catch(qs)):n.geometryToPlace=y==null?void 0:y.mesh,c(),a();break}}}),R(()=>{p.cancel(),c()})]);return p.uploadTo(o),m}function ct(t){const e=t==null?void 0:t.layer;return(e==null?void 0:e.type)==="scene"}let D=class extends jt.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new at,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter(i=>!i.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,i=e&&e[this._stepIndex];return i&&i.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(e=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(e={force:!0}){return e.force!==!1?this._cancel(e):new Promise((i,a)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(i)},deny:()=>a(new P("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:i}=this,a=i.findIndex(s=>s.id===e);this._indexHistory.push(this._stepIndex),await this._go(a)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(e={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=this._stepIndex===-1?0:this._stepIndex;await this._go(e)}async _cancel({emitCancelEvent:e=!0,error:i}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var a;return(a=this.steps[this._stepIndex])==null?void 0:a.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:i})}_go(e=-1,i=!1){return this._transaction(async()=>{const{steps:a}=this;if(!(e<=-1||e>=a.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await a[this._lastStepIndex].tearDown({canceled:i});try{await a[e].setUp()}catch(s){Ks(s)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}})}async _transaction(e){const i=this._pendingOperation,a=st(),s=(i??Promise.resolve()).then(()=>a.promise);this._pendingOperation=s,this._updatingHandles.addPromise(s);try{i&&await i,await e()}finally{a.resolve(),s===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(e=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};r([l()],D.prototype,"data",void 0),r([l()],D.prototype,"hasNextStep",null),r([l()],D.prototype,"hasPreviousStep",null),r([l()],D.prototype,"onCommit",void 0),r([l()],D.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],D.prototype,"hasInvalidFormTemplate",null),r([l()],D.prototype,"shouldShowAttachments",null),r([l()],D.prototype,"shouldAllowAttachmentEditing",null),r([l()],D.prototype,"started",void 0),r([l({readOnly:!0})],D.prototype,"stepId",null),r([l()],D.prototype,"steps",void 0),r([l({readOnly:!0})],D.prototype,"type",void 0),r([l()],D.prototype,"helpMessage",null),r([l()],D.prototype,"hasPendingEdits",null),r([l()],D.prototype,"keyboardCancellationEnabled",null),r([l()],D.prototype,"updating",null),D=r([x("esri.widgets.Editor.Workflow")],D);const Si=D;var St;const ai=Symbol(),ze=Symbol(),Vt=Symbol(),ga=Symbol();let U=St=class extends Si{constructor(t){super(t),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Ti,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=_t((e,i,a)=>_e(e,i,a))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var n,o;if(this.pendingFeatures.some(d=>{var u;return!!((u=this.data.getEditsForPendingFeature(d))!=null&&u.modified)}))return!0;const{creationInfo:t,upload:e}=this.data,i=this._sketchViewModel,{activeComponent:a}=i,s=(o=(n=i.createGraphic)==null?void 0:n.geometry)==null?void 0:o.type;return!(s!=="polyline"&&s!=="polygon"&&s!=="multipoint"||(a==null?void 0:a.type)!=="draw-2d"&&(a==null?void 0:a.type)!=="draw-3d")&&a.drawOperation.committedVertices.length>0||!(!e||e.state!=="pending"&&e.state!=="success")||!!(t!=null&&t.geometryToPlace)}get helpMessage(){var s;const{creationInfo:t,viewModel:e}=this.data;if(this.stepId!=="creating-features"||!t)return;const i=t.layer.geometryType,a=this._sketchViewModel.createGraphic;if(i==="mesh"){this._getDrawMeshHelpMessage||b(()=>import("./helpMessageUtils3d-C2BWg4G5.js"),__vite__mapDeps([45,1,2]),import.meta.url).then(o=>{this._getDrawMeshHelpMessage=o.getDrawMeshHelpMessage});const{view:n}=e;return(n==null?void 0:n.type)==="3d"?(s=this._getDrawMeshHelpMessage)==null?void 0:s.call(this,a,n):void 0}return Un(i,a==null?void 0:a.geometry)}get layer(){var t;return(t=this.data.creationInfo)==null?void 0:t.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var t;return(t=this.parent)==null?void 0:t.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var t;return((t=this.data.editorItem)==null?void 0:t.capabilities.create.reliesOnOwnerAdminPrivileges)??!1}get shouldShowAttachments(){var t;return((t=this.data.editorItem)==null?void 0:t.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}async enter(){this._isActive=!0,this.stepId!=="awaiting-feature-creation-info"&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([Vt])}async updatePendingFeature(t,e){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),Ki(this._lastActiveGraphics,t),this._startUpdating({feature:t,webStyleCache:e})}async start(){var t;return await super.start(),Pe((t=this.data.creationInfo)==null?void 0:t.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(t){const{addAttachmentsCallback:e,applyEditsCallback:i,isNested:a,creationInfo:s,parent:n,snappingManager:o,startAt:d,viewModel:u}=t,p=t.sketchOptions??new Bt,h=s==null?void 0:s.layer,c=h?u.findEditorItemForLayer(h):void 0,m=new St({data:new oe({creationInfo:s,editorItem:c,parent:n,sketchOptions:p,snappingManager:o,viewModel:u}),isNested:a,onCommit:async g=>{var $;const{creationInfo:y}=g;if(!y)return;const _=g.pendingFeatures.toArray(),{layer:v}=y,w=(($=v.capabilities)==null?void 0:$.editing.supportsGlobalId)&&"globalIdField"in v,k=m._attachmentFileInfos;if(w){const S=yo(_,v,k);return void await i(v,S,{globalIdUsed:!0})}const V=await i(v,{addFeatures:_});if(k.size>0){const S=(V==null?void 0:V.addFeatureResults)??[];await e(v,fo(_,S,v,k))}}});return m._set("steps",this._createWorkflowSteps(m,d)),m}_fadeExistingFeatures(t){if("effect"in t){const i=t.effect;return t.effect="saturate(0.6) opacity(0.8)",R(()=>t.effect=i)}const e=t.opacity;return t.opacity=.7,R(()=>t.opacity=e)}_highlight(t){const e=this.data.viewModel.view;(e==null?void 0:e.type)==="3d"&&this._highlightHandles.set(t,e.highlight(t))}_removeHighlight(t){Mt(this._highlightHandles.get(t)),this._highlightHandles.delete(t)}async _startCreating(t){this.removeHandles(ze);const{creationInfo:e}=this.data;if(!e)return;this.createFeatureState="create-new";const i=await Jr(this._sketchViewModel,e,t);this.addHandles(i,ze)}async _startUpdating({feature:t,webStyleCache:e,initialFeature:i=t}){var w;const{data:a,pendingFeatures:s}=this;s.includes(t)||a.addPendingFeature(t,i);const{_featureFormViewModel:n,_sketchViewModel:o}=this,{creationInfo:d,viewModel:u}=a,{attachmentsViewModel:p,layerInfos:h,view:c}=u;if(!c||!d)return;const m=d.layer,g=Qr(h,m),y=g==null?void 0:g.formTemplate,_=c.spatialReference;if(n.set({arcadeEditType:"INSERT",feature:t,formTemplate:y,spatialReference:_,map:c.map}),p.mode!=="add"&&p.mode!=="edit"||((w=u.activeWorkflow)==null||w.previous()),p.graphic=t,p.fileInfos.removeAll(),p.mode="view",(this._attachmentFileInfos.get(t)||[]).forEach(({file:k,form:V})=>p.addFile(k,V)),this._removeHighlight(t),await _e(t,e,c.type==="2d"?c.scale:null),this.removeHandles(ze),Mt(this._featureFormHandle),c.type==="2d"){const k=C(()=>c.scale,V=>this._updateGraphicDebounced(t,e,V));this.addHandles(k,ze)}const v=a.getEditsForPendingFeature(t);return this._featureFormHandle=ve([n.on("value-change",async()=>{v==null||v.updateAttributes(n.getValues()),await _e(t,e,c.type==="2d"?c.scale:null)}),o.on(["update","undo","redo"],k=>{(k.type==="undo"||k.type==="redo"||k.type==="update"&&k.toolEventInfo!=null&&Ka(k.toolEventInfo.type))&&n.notifyFeatureGeometryChanged()}),C(()=>{var k;return(k=n.feature)==null?void 0:k.sourceLayer},k=>t.sourceLayer=k)]),this.createFeatureState="update-pending",this._visualVariableAttributes=Oi(t),Pe(m)?void 0:Ot({graphic:t,sketchViewModel:o,sourceLayer:m,visualVariables:this._visualVariableAttributes,webStyleCache:e})}static _createWorkflowSteps(t,e="awaiting-feature-creation-info"){const{data:i}=t,a=qa(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],e,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:s,viewModel:n}=i,{view:o}=n;o&&(ct(s)?t.addHandles(await ho({view:o,data:i,next:()=>t.next(),cancel:()=>n.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(i.parent&&s&&(t.addHandles(n.lockFeatureTemplatesViewModel(),this.id),n.featureTemplatesViewModel.layers=[s.layer]),t.addHandles(n.featureTemplatesViewModel.on("select",({item:d})=>{d&&(i.creationInfo={...i.creationInfo,layer:d.layer,template:d.template},t.next())}),this.id)))},async tearDown(){t.removeHandles([this.id,ze])}}),"creating-features":()=>({id:"creating-features",async setUp(){t._isActive&&await t._setUpCreatingFeaturesStep()},async tearDown(s){const{viewModel:n}=i;s.canceled&&(t.removeHandles([Vt,ai,ze,ga]),n.attachmentsViewModel.fileInfos.removeAll(),t._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=i.viewModel,{graphic:n,fileInfos:o}=s;t._attachmentFileInfos.set(n,o.toArray()),s.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=i.viewModel,{graphic:n,fileInfos:o}=s;t._attachmentFileInfos.set(n,o.toArray()),s.mode="view"}})});return lo(i,a)}static _configureSketchViewModel(t,e){const{data:i}=t,{creationInfo:a,viewModel:s}=i,{view:n}=s,o=t._sketchViewModel;let d=null;const u=[];if(!n)return R();n.type==="2d"&&a&&u.push(t._fadeExistingFeatures(a.layer));const p=async y=>{if(y.state==="cancel"){if(t._preventDefaultActionOnCancel)return void(t._preventDefaultActionOnCancel=!1);if(n.activeTool==null){if(t._lastActiveGraphics.length<1)return t._startCreating(e);const _=t._lastActiveGraphics.pop();return t._startUpdating({feature:_,webStyleCache:e})}return t._waitForActiveToolCleared().then(()=>t._startCreating(e))}if(y.state==="complete"&&y.graphic){const _=y.graphic.clone();return _.geometry=null,t._startUpdating({feature:y.graphic,webStyleCache:e,initialFeature:_})}},h=async y=>{var re,bt,Pi;const{attachmentsViewModel:_}=s,{_featureFormViewModel:v}=t,w=y.graphics[0];if(y.state==="complete"){w!==d&&(t._lastActiveGraphics.push(w),t._highlight(w)),d=null;const{hasPendingSubtypeChoice:Ve,submittable:Di}=v;if(t.numPendingFeatures===(a==null?void 0:a.maxFeatures)||Ve||!Di){!Di&&v.submit();const xe=t._lastActiveGraphics.pop();return((re=s.view)==null?void 0:re.activeTool)===null?t._startUpdating({feature:xe,webStyleCache:e}):t._waitForActiveToolCleared().then(()=>t._startUpdating({feature:xe,webStyleCache:e}))}if(_.mode!=="add"&&_.mode!=="edit"||((bt=s.activeWorkflow)==null||bt.previous()),y.aborted&&t._preventDefaultActionOnCancel)return void(t._preventDefaultActionOnCancel=!1);if(t.addHandles([yi(n),n.on("click",xe=>xe.preventDefault())],ai),await B(()=>!v.updating),t.removeHandles(ai),((Pi=s.view)==null?void 0:Pi.activeTool)!=null)return t._waitForActiveToolCleared().then(()=>{const xe=t._lastActiveGraphics.pop();if(xe)return t._startUpdating({feature:xe,webStyleCache:e})});t._startCreating(e)}y.state==="start"&&t._removeHighlight(w);const k=t._visualVariableAttributes;await Za(n,w,y,k,e);const V=w.attributes,{rotation:$,size:S}=k;if($!=null){const{field:Ve}=$;v.setValue(Ve,V[Ve])}if(S!=null){const{field:Ve}=S;v.setValue(Ve,V[Ve])}},c=y=>{const _=y.graphics[0];i.removePendingFeature(_),Ki(t._lastActiveGraphics,_),d=_},m=async y=>{if(ct(a))return;const{results:_}=await n.hitTest(y,{include:o.layer}),v=_.find(k=>k.type==="graphic"&&k.graphic.sourceLayer===(a==null?void 0:a.layer));if(!v)return;const w=v.graphic;if(o.activeTool==="transform"||o.activeTool==="reshape"){if(o.updateGraphics.at(0)===w)return;const{submittable:k,hasPendingSubtypeChoice:V}=t._featureFormViewModel;if(!k||V)return;await t.updatePendingFeature(w,e)}};u.push(o.on("create",y=>t._updatingHandles.addPromise(p(y))),o.on("update",y=>t._updatingHandles.addPromise(h(y))),o.on("delete",y=>c(y)),n.on("immediate-click",y=>t._updatingHandles.addPromise(m(y)),xa.TOOL),R(()=>{t._preventDefaultActionOnCancel=!0,o.cancel()}),mo(o,i));const g=ve(u);return o.addHandles(g),g}_initializeSketchViewModel(){var s;const{data:t}=this,{view:e}=t.viewModel,i=new Ii({elevationInfo:(s=t.creationInfo)==null?void 0:s.layer.elevationInfo,internal:!0,listMode:"hide"}),a=new Ei({layer:i,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:e});this._sketchViewModel=a,e==null||e.map.add(i),this.addHandles(R(()=>{e!=null&&e.destroyed||(e==null||e.map.remove(i)),i.destroy()}))}async _setUpCreatingFeaturesStep(){var _;if(this.hasHandles(Vt))return;const{data:t}=this,{creationInfo:e,viewModel:i}=t,{attachmentsViewModel:a,view:s}=i;if(!s||!(e!=null&&e.layer))throw new P("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");this._preventDefaultActionOnCancel=!1;const{initialFeature:n,layer:o}=e,d=this._sketchViewModel,u=new Map,p=[];this._lastActiveGraphics=[],this._featureFormHandle=Mt(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=i.findEditorItemForLayer(e.layer),po(a),p.push(C(()=>a.mode,v=>{switch(v){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const h=yi(s);p.push(h);const c=Pe(e.layer);try{if(c){const v=n??new nt({attributes:{...(_=e.template)==null?void 0:_.prototype.attributes,...e.attributeOverrides},sourceLayer:o});await this._startUpdating({feature:v,webStyleCache:u})}else p.push(St._configureSketchViewModel(this,u)),n?(d.layer.add(n),await this._startUpdating({feature:n,webStyleCache:u})):await this._startCreating(u)}finally{h.remove()}const m=R(()=>{for(const v of t.pendingFeatures)d.layer.remove(v),t.removePendingFeature(v)}),g=C(()=>s==null?void 0:s.timeZone,v=>this._featureFormViewModel.timeZone=v,he),y=R(()=>{ct(e)&&i.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&p.push(this._featureFormHandle),this.addHandles(p,this._handleKeys.beforeCommit),this.addHandles([R(()=>a.fileInfos.removeAll()),ve(p),y,m,g],Vt)}async _waitForActiveToolCleared(){const t=this.data.viewModel.view;if((t==null?void 0:t.activeTool)==null)return;const e=new AbortController;this.addHandles(Ci(e),ga),await B(()=>(t==null?void 0:t.activeTool)==null,e.signal),e.abort()}};function mo(t,e){let i=null;const a=()=>t.snappingOptions.featureSources,s=()=>(i=new Js({layer:t.layer}),a().add(i),i),n=()=>{i!=null&&(a().remove(i),i=ft(i))};return ve([C(()=>{var u;const o=(u=e.creationInfo)==null?void 0:u.layer,d=a().find(p=>p.layer===o);return{hasFeatureLayerSource:!!d,enabled:(d==null?void 0:d.enabled)??!1}},({hasFeatureLayerSource:o,enabled:d})=>{if(!o)return n();i??(i=s()),i.enabled=d},Le),R(n)])}function fo(t,e,i,a){const s=[];return e.forEach((n,o)=>{if(!n.error){const d=t[o],u=a.get(d)||[];d.attributes[i.objectIdField]=n.objectId,u.forEach(({form:p})=>s.push({feature:d,attachment:p}))}}),s}function yo(t,e,i){const a=[],s=e.globalIdField;return t.forEach((n,o)=>{var d;(d=t[o].attributes)[s]??(d[s]=Ji()),((i==null?void 0:i.get(n))||[]).forEach(({file:u})=>a.push({feature:n,attachment:{globalId:Ji(),data:u}}))}),a.length?{addFeatures:t,addAttachments:a}:{addFeatures:t}}r([l()],U.prototype,"createFeatureState",void 0),r([l()],U.prototype,"data",void 0),r([l({constructOnly:!0})],U.prototype,"isNested",void 0),r([l()],U.prototype,"featureFormViewModel",null),r([l()],U.prototype,"hasPendingEdits",null),r([l()],U.prototype,"_getDrawMeshHelpMessage",void 0),r([l()],U.prototype,"helpMessage",null),r([l()],U.prototype,"layer",null),r([l()],U.prototype,"parent",null),r([l()],U.prototype,"parentLayer",null),r([l()],U.prototype,"keyboardCancellationEnabled",null),r([l()],U.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],U.prototype,"shouldShowAttachments",null),r([l()],U.prototype,"shouldAllowAttachmentEditing",null),r([l()],U.prototype,"sketchViewModel",null),U=St=r([x("esri.widgets.Editor.CreateFeaturesWorkflow")],U);const Ja=U;var Lt;let de=Lt=class extends G{constructor(t){super(t),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const t=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:t,update:t,delete:t}}}get formTemplate(){return this.editorItem.formTemplate}static async create(t){const e=Lt._makeConstructorProps(t);return new Lt(e)}static _makeConstructorProps(t){const{feature:e,parent:i,relatedRecordCallbacks:a,viewModel:s}=t,n=s.editorItems.find(o=>o.layer===e.layer);if(!n)throw new P("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:n,edits:new pe({feature:e}),parent:i,relatedRecordCallbacks:a,viewModel:s}}};r([l()],de.prototype,"attachmentsCapabilities",null),r([l({constructOnly:!0})],de.prototype,"editorItem",void 0),r([l()],de.prototype,"edits",void 0),r([l()],de.prototype,"formTemplate",null),r([l()],de.prototype,"parent",void 0),r([l()],de.prototype,"relatedRecordCallbacks",void 0),r([l()],de.prototype,"viewModel",void 0),de=Lt=r([x("esri.widgets.Editor.UpdateRecordWorkflowData")],de);const Qa=de;var Rt;let qe=Rt=class extends Qa{constructor(t){super(t),this.sketchOptions=null,this.snappingManager=null}static async create(t){const{feature:e,snappingManager:i,viewModel:a}=t,s=t.sketchOptions??new Bt,{view:n}=a;if(!n)throw new P("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const o=await tt(n,e.layer);return new Rt({...Rt._makeConstructorProps(t),layerView:o,sketchOptions:s,snappingManager:i})}};r([l()],qe.prototype,"layerView",void 0),r([l({constructOnly:!0})],qe.prototype,"sketchOptions",void 0),r([l()],qe.prototype,"snappingManager",void 0),qe=Rt=r([x("esri.widgets.Editor.UpdateFeatureWorkflowData")],qe);const go=qe;var gi;const va={exit:Symbol()};let Z=gi=class extends Si{constructor(t){super(t),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:t}=this,{edits:e}=t,{view:i}=t.viewModel,a=e.feature,s=new AbortController;this.addHandles(Ci(s)),this._updatingHandles.addPromise(to(a,t.viewModel.view.spatialReference,s.signal).then(n=>{Qs(s)||(this._onFullFeatureLoaded(n),this._initializeFeatureFormViewModel())},n=>this.cancel({force:!0,error:new P("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:n}})}))),i&&(this._highlightHelper=new Oa({view:i}),this.addHandles(R(()=>{var n;return(n=this._highlightHelper)==null?void 0:n.removeAll()})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var t;return(t=this.parent)==null?void 0:t.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const t=this.editorItem.capabilities;return t.update.reliesOnOwnerAdminPrivileges||t.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(t){this.removeHandles(va.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:t,fullFeature:e}=this,{attachmentsCapabilities:i,viewModel:a}=t,{attachmentsViewModel:s}=a;s.set({capabilities:i,graphic:e,filesEnabled:!1,mode:"view"}),this.addHandles([R(()=>s.fileInfos.removeAll()),C(()=>s.mode,n=>{switch(n){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],va.exit)}_initializeFeatureFormViewModel(){const{edits:t,formTemplate:e,viewModel:{view:i}}=this.data,a=this._featureFormViewModel=new Ti({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:e,highlightHelper:this._highlightHelper,map:i==null?void 0:i.map,spatialReference:i.spatialReference,timeZone:i==null?void 0:i.timeZone});a.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:n=>a.relationshipId=n.relationshipId};const{initialFeature:s}=t;s&&a.overrideInitialFeature(s),this.addHandles([a.on("value-change",()=>{t.updateAttributes(a.getValues()),this.fullFeature.attributes=t.feature.attributes}),C(()=>i==null?void 0:i.timeZone,n=>a.timeZone=n)])}_onFullFeatureLoaded(t){this.fullFeature=t;const{edits:e}=this.data;e.updateAttributes(t.attributes),e.trackChanges()}static async create(t){const e=new gi({data:await Qa.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}static _createWorkflowSteps(t){const{attachmentsViewModel:e}=t.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){e.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){e.mode="view"}}]}};Z._onCommitFactory=t=>async e=>{var d;const{edits:i}=e,{feature:a}=i;if(!a)return;const s=a.sourceLayer,n=a.clone();if(!i.attributesModified||i.stagedForDelete){const u=s.objectIdField;if(n.attributes={[u]:a.getAttribute(u)},s.type==="scene"&&s.infoFor3D!=null){const p=(d=s.associatedLayer)==null?void 0:d.globalIdField;p!=null&&n.setAttribute(p,a.getAttribute(p))}}i.geometryModified&&!i.stagedForDelete||(n.geometry=null);const o=i.stagedForDelete?"deleteFeatures":"updateFeatures";await t(s,{[o]:[n]})},r([l()],Z.prototype,"editorItem",null),r([l()],Z.prototype,"featureFormViewModel",null),r([l()],Z.prototype,"fullFeature",void 0),r([l()],Z.prototype,"hasPendingEdits",null),r([l()],Z.prototype,"layer",null),r([l()],Z.prototype,"parent",null),r([l()],Z.prototype,"parentLayer",null),r([l()],Z.prototype,"shouldShowAttachments",null),r([l()],Z.prototype,"shouldAllowAttachmentEditing",null),r([l()],Z.prototype,"reliesOnOwnerAdminPrivileges",null),Z=gi=r([x("esri.widgets.Editor.UpdateRecordWorkflow")],Z);var vi;const Y={highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol(),waitingForTool:Symbol()};let Ke=vi=class extends Z{constructor(t){super(t),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var t;(t=this._layerViewEditSession)==null||t.rollback()}async commit(){this.removeHandles(Y.sketchGraphics);try{const t=this.data.edits.stagedForDelete;await super.commit();const e=this._layerViewEditSession;t?e==null||e.rollback():e==null||e.commit()}catch(t){throw await this._configureSketchViewModel(),new P("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:t})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",t=>{var e;(e=this._layerViewEditSession)==null||e.setAttribute(t.fieldName,t.value)}),C(()=>{var t;return(t=this._featureFormViewModel.feature)==null?void 0:t.sourceLayer},t=>this._sketchGraphicClone.sourceLayer=t)])}_configureHighlight(){const{edits:t,layerView:e}=this.data;Ys(e)&&this.addHandles(e.highlight(t.feature),Y.highlights)}async _configureSketchViewModel(){const t=this._sketchViewModel;if(!t)return;const{data:e,_featureFormViewModel:i,_sketchGraphicClone:a}=this,{edits:s,viewModel:n}=e,o=s.feature,{view:d}=n,u=Oi(o),p=await so({feature:o,featureClone:a,visualVariableAttributes:u,sketchViewModel:t,view:d,onUpdate:({geometry:h,attributes:c},m)=>{if(s.updateAttributes(c),s.updateGeometry(h),i.feature&&(i.feature.geometry=h),u.rotation!=null){const{field:g}=u.rotation;i.setValue(g,c[g])}if(u.size!=null){const{field:g}=u.size;i.setValue(g,c[g])}(m.type==="undo"||m.type==="redo"||m.type==="update"&&m.toolEventInfo!=null&&Ka(m.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},addUpdatingPromise:h=>{this._updatingHandles.addPromise(h)},addHandle:h=>{this.addHandles(h,Y.waitingForTool)},webStyleCache:this._webStyleCache});this.addHandles(p,Y.sketchGraphics),t.addHandles(p)}async _initializeSketchViewModel(){const{data:t,_sketchGraphicClone:e}=this,i=t.edits.feature,{capabilities:a,layer:s}=t.editorItem,{view:n}=t.viewModel;if(this.removeHandles([Y.highlights,Y.sketchGraphics,Y.sketchViewModel,Y.waitingForTool]),!a.update.geometry||(n==null?void 0:n.type)==="3d"&&Xs(s.elevationInfo))return{enter:async()=>{this.hasHandles(Y.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([Y.highlights])};const o=new Ii({elevationInfo:s.elevationInfo,internal:!0,listMode:"hide"}),d=new Ei({allowDeleteKey:!1,layer:o,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:n});return this._sketchViewModel=d,n==null||n.map.add(o),this.addHandles(R(()=>{n!=null&&n.destroyed||(n==null||n.map.remove(o)),o.destroy(),this._sketchViewModel=ft(d)}),Y.sketchViewModel),await _e(e,this._webStyleCache,(n==null?void 0:n.type)==="2d"?n.scale:null),this.addHandles([await no(d,i,e)]),{enter:async()=>{this.hasHandles(Y.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([Y.sketchGraphics]),viewModel:d}}_onFullFeatureLoaded(t){super._onFullFeatureLoaded(t);const e=this._sketchGraphicClone=fi(t),{edits:i,layerView:a}=this.data;i.updateGeometry(t.geometry),i.trackChanges(),co(a)&&(this._layerViewEditSession=a.createInteractiveEditSession(e))}static async create(t){const e=new vi({data:await go.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}get test(){}};r([l()],Ke.prototype,"_layerViewEditSession",void 0),r([l()],Ke.prototype,"_sketchGraphicClone",void 0),r([l()],Ke.prototype,"_sketchViewModel",void 0),Ke=vi=r([x("esri.widgets.Editor.UpdateFeatureWorkflow")],Ke);let ue=class extends G{constructor(e){super(e),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};r([l()],ue.prototype,"addAttachmentsCallback",void 0),r([l()],ue.prototype,"applyEditsCallback",void 0),r([l()],ue.prototype,"candidates",void 0),r([l()],ue.prototype,"rootFeature",void 0),r([l({constructOnly:!0})],ue.prototype,"sketchOptions",void 0),r([l()],ue.prototype,"snappingManager",void 0),r([l()],ue.prototype,"viewModel",void 0),ue=r([x("esri.widgets.Editor.UpdateWorkflowData")],ue);const vo=ue;var _i;const Ya="esri.widgets.Editor.UpdateWorkflow",_o=()=>q.getLogger(Ya);let N=_i=class extends Si{constructor(t){super(t),this._workflowStack=new Qi(Yi),this._sketchStack=new Qi(Yi),this.data=void 0,this.type="update"}get activeEditorItem(){var t;return((t=this.activeWorkflow)==null?void 0:t.data.editorItem)??void 0}get activeFeatureFormViewModel(){var t;return(t=this.activeWorkflow)==null?void 0:t.featureFormViewModel}get activeSketchViewModel(){var t;return(t=this._sketchStack.peek())==null?void 0:t.viewModel}get activeWorkflow(){return this._workflowStack.last()}get updating(){var t;return this._updatingHandles.updating||!!((t=this.activeWorkflow)!=null&&t.updating)}get hasPreviousStep(){var t;return this._stepIndex>0||this.nestedWorkflowCount>1||((t=this.activeWorkflow)==null?void 0:t.featureFormViewModel.relationshipId)!=null||this.data.viewModel.attachmentsViewModel.mode!=="view"}get hasUpdatableCandidates(){const{candidates:t,viewModel:e}=this.data;return t.some(({layer:i})=>{var a;return(a=e.findEditorItemForLayer(i))==null?void 0:a.supportsUpdateWorkflow})}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var t;return!!((t=this.activeEditorItem)!=null&&t.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var t;return!!((t=this.activeEditorItem)!=null&&t.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some(t=>t.hasPendingEdits)}get helpMessage(){var t;return(t=this.activeWorkflow)!=null&&t.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var t;return((t=this.activeWorkflow)==null?void 0:t.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var t;return!!((t=this.activeEditorItem)!=null&&t.hasInvalidFormTemplate)}async back(t=()=>Promise.resolve(!0)){const{activeWorkflow:e}=this;if((e==null?void 0:e.featureFormViewModel.relationshipId)==null)if(e){if(e.hasPendingEdits&&!await t())return;e.hasPreviousStep?await e.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else e.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(t){var e;await((e=this.activeWorkflow)==null?void 0:e.cancel(t)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(t=>t.commit()),await super.commit()}static create(t){const{viewModel:e,snappingManager:i,startAt:a,addAttachmentsCallback:s,applyEditsCallback:n}=t,o=t.sketchOptions??new Bt,d=new _i({data:new vo({addAttachmentsCallback:s,applyEditsCallback:n,sketchOptions:o,snappingManager:i,viewModel:e}),onCommit:async()=>{}});return d._set("steps",this._createWorkflowSteps(d,a)),d}async save(){var t;this.nestedWorkflowCount>1?(await((t=this.activeWorkflow)==null?void 0:t.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(t){try{const e=await this._createNestedCreateFeaturesWorkflow(t);await this._pushWorkflow(e)}catch(e){throw new P("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:e})}}async startUpdating(t){try{const e=await this._createNestedUpdateWorkflow(t);await this._pushWorkflow(e)}catch(e){throw new P("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:e})}}async deleteActiveFeature(){const{activeWorkflow:t}=this;if(!t)throw new P("editor:nothing-to-delete","There is no feature to delete");wo(t)?await t.deleteAndCommit():await t.cancel(),this.nestedWorkflowCount===1?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack(t=>t.cancel({force:!0}))}async _createNestedCreateFeaturesWorkflow(t){var h;const{relatedLayer:e}=t,{addAttachmentsCallback:i,applyEditsCallback:a,sketchOptions:s,snappingManager:n,viewModel:o}=this.data;if(!Nt(e))throw new P("editor:unsupported-layer","Editing is not supported on the provided layer");const d=this._getCreationInfoForNestedCreateFeaturesWorkflow(t),u=d.template||d.initialFeature?"creating-features":"awaiting-feature-creation-info",p=((h=this.activeWorkflow)==null?void 0:h.type)!=="create-features"?this.activeWorkflow:void 0;return Ja.create({addAttachmentsCallback:i,applyEditsCallback:a,creationInfo:d,isNested:!0,parent:p,sketchOptions:s,snappingManager:n,startAt:u,viewModel:o})}_getCreationInfoForNestedCreateFeaturesWorkflow(t){const{relatedLayer:e}=t;if(!Nt(e)||en(e))throw new P("editor:unsupported-layer","Editing is not supported on the provided layer");const i={layer:e,maxFeatures:1},a=this._makeRelatedRecordAttributes(t),s=Ht(e);return(s==null?void 0:s.length)>0?(i.attributeOverrides=a,s.length===1&&(i.template=s[0])):i.initialFeature=new nt({sourceLayer:e,attributes:a}),i}async _createNestedUpdateWorkflow(t){var u;const e=Pe(t.sourceLayer)?Z:Ke,{applyEditsCallback:i,sketchOptions:a,snappingManager:s,viewModel:n}=this.data,o=((u=this.activeWorkflow)==null?void 0:u.type)!=="create-features"?this.activeWorkflow:void 0,d=await e.create({feature:t,parent:o,sketchOptions:a,snappingManager:s,viewModel:n,applyEdits:i,relatedRecordCallbacks:{addRelatedRecord:async p=>await this.startCreatingRelatedRecord(p),editRelatedRecord:async({relatedFeature:p})=>await this.startUpdating(p)}});return await B(()=>!d.updating),d}async _drainWorkflowStack(t){const e=this._workflowStack,i=[];for(;e.length>0;){const a=e.pop();this._sketchStack.pop();const s=t(a).then(()=>a.destroy());this._updatingHandles.addPromise(s),i.push(s)}await Promise.all(i)}_makeRelatedRecordAttributes(t){var h,c;const{parentFeature:e,relatedLayer:i,relationshipId:a}=t;if(!Rn(e))return;const s=(h=i.relationships)==null?void 0:h.find(m=>m.id===a);if(!s)return void rt("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(s.role==="origin")return void rt("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const n=e.sourceLayer;s.relatedTableId!==n.layerId&&rt("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const o=(c=n.relationships)==null?void 0:c.find(m=>m.id===a);if(!o)return void rt("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=_a(n,o),u=e.getAttribute(d);return u||rt("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[_a(i,s)]:u}}async _popWorkflow(){var e;(e=this._workflowStack.pop())==null||e.destroy(),this._sketchStack.pop();const t=await this._reconcileWorkflowStack();if(t.failureCount>0)throw new P("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",t)}async _pushWorkflow(t){var o;const e=this._workflowRequiresSketchViewModel(t);(o=this.activeWorkflow)==null||o.exit({removeSketchHandles:e});const i=this._sketchStack,a=await(t==null?void 0:t.start()),s=i.peek();a?(s==null||s.exit(),i.push(a)):i.push(this._cloneSketchController(s)),this._workflowStack.push(t);const n=await this._reconcileWorkflowStack();if(n.failureCount>0)throw new P("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",n)}async _reconcileWorkflowStack(){var i;const t=this._workflowStack,e=this._sketchStack;try{const a=t.peek();return await(a==null?void 0:a.enter()),await((i=e.peek())==null?void 0:i.enter()),{activeWorkflow:a,failureCount:0}}catch{t.pop().destroy(),e.pop();const{activeWorkflow:s,failureCount:n}=await this._reconcileWorkflowStack();return{activeWorkflow:s,failureCount:n+1}}}_cloneSketchController(t){return{enter:(t==null?void 0:t.enter)??(async()=>{}),exit:(t==null?void 0:t.exit)??(async()=>{}),viewModel:t==null?void 0:t.viewModel}}_workflowRequiresSketchViewModel(t){var i;const{type:e}=t;return e==="update-feature"||e==="create-features"&&!Pe((i=t.data.creationInfo)==null?void 0:i.layer)}static _createWorkflowSteps(t,e="awaiting-feature-to-update"){const{data:i}=t;return qa(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],e,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:a}=i.viewModel,s=i.viewModel.view;s.activeTool=null;let n=null;t.addHandles(R(()=>{n=Dt(n)}),this.id),i.rootFeature=null,i.candidates=[];const o=s.on("immediate-click",async u=>{const p=st();t._updatingHandles.addPromise(p.promise);try{a.location=u.mapPoint,a.visible=!0,n==null||n.abort();const{editorItems:h}=i.viewModel;n=new AbortController;const c=await u.async(()=>new Promise((m,g)=>{tn(n==null?void 0:n.signal,()=>g(an())),m(Yr(h,s,u,n==null?void 0:n.signal))}));if(Ee(n),i.candidates=c.filter(m=>m.status==="fulfilled").flatMap(m=>m.value).filter(m=>!m.isAggregate),a.visible=i.candidates.length===1,i.candidates.length===0)return;u.stopPropagation(),i.candidates.length===1?(i.rootFeature=i.candidates[0],t.go("editing-existing-feature").catch(()=>{}).then(()=>a.visible=!1)):t.next()}finally{p.resolve()}},xa.TOOL),d=Re(()=>s.activeTool!=null,()=>t.cancel({force:!0}),{once:!0});s.focus(),t.addHandles([o,d],this.id)},async tearDown(){i.candidates.length===0&&(i.viewModel.spinnerViewModel.visible=!1),t.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:a}=i.viewModel;if(!a)return;const s=new Oa({view:a});t.addHandles([C(()=>i.rootFeature,(n,o)=>{s.remove(o),s.add(n)},mt),R(()=>s.removeAll())],this.id)},async tearDown(){t.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:a,viewModel:s}=t.data;if(!a)throw new P("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await t.startUpdating(a),s.spinnerViewModel.visible=!1;const n=_t(async()=>{await B(()=>!t.updating),t.previous()});t.addHandles([C(()=>t.nestedWorkflowCount,(o,d)=>{o===0&&d!==0&&n()},mt)],this.id)},async tearDown(){await t.cancelAll(),t.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};function _a(t,{keyField:e}){var i;return((i=t.getField(e))==null?void 0:i.name)??e}r([l()],N.prototype,"activeEditorItem",null),r([l()],N.prototype,"activeFeatureFormViewModel",null),r([l()],N.prototype,"activeSketchViewModel",null),r([l()],N.prototype,"activeWorkflow",null),r([l()],N.prototype,"updating",null),r([l()],N.prototype,"data",void 0),r([l()],N.prototype,"hasPreviousStep",null),r([l()],N.prototype,"hasUpdatableCandidates",null),r([l()],N.prototype,"nestedWorkflowCount",null),r([l()],N.prototype,"shouldShowAttachments",null),r([l()],N.prototype,"shouldAllowAttachmentEditing",null),r([l()],N.prototype,"hasPendingEdits",null),r([l()],N.prototype,"helpMessage",null),r([l()],N.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],N.prototype,"hasInvalidFormTemplate",null),N=_i=r([x(Ya)],N);const rt=(t,e)=>_o().warn(`editor:${t}`,e,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),wo=t=>!!t&&/update-/.test(t.type),bo=N;let Q=class extends G{constructor(e){super(e),this.layer=null}get attachments(){var e;return{enabled:this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.data.supportsAttachment)}}get create(){var d;const{_effectiveCapabilities:e,layer:i}=this,a=this._createEnabled,s=a,n=(d=i.capabilities)==null?void 0:d.operations.supportsAdd,o=!!(e!=null&&e.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:s,reliesOnOwnerAdminPrivileges:!n&&o}}get delete(){var n;const{_effectiveCapabilities:e,layer:i}=this,a=(n=i.capabilities)==null?void 0:n.operations.supportsDelete,s=!!(e!=null&&e.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!!(e!=null&&e.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&s}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var p;const{_effectiveCapabilities:e,layer:i}=this,a=this._updateEnabled,s=!(!a||!(e!=null&&e.editing.supportsGeometryUpdate)),n=(p=i.capabilities)==null?void 0:p.operations.supportsUpdate,o=!!(e!=null&&e.operations.supportsUpdate),d=this.attachments.enabled,u=d&&this._canCreateOrUpdate;return{attachments:{enabled:d,create:u,update:u},attributes:a,enabled:a,geometry:s,reliesOnOwnerAdminPrivileges:!n&&o}}get _createEnabled(){var e;return this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.operations.supportsAdd)}get _updateEnabled(){var e;return this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return sn(this.layer)}get _effectiveCapabilities(){return ht(this.layer)}};r([l()],Q.prototype,"attachments",null),r([l()],Q.prototype,"create",null),r([l()],Q.prototype,"delete",null),r([l()],Q.prototype,"layer",void 0),r([l()],Q.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],Q.prototype,"update",null),r([l()],Q.prototype,"_createEnabled",null),r([l()],Q.prototype,"_updateEnabled",null),r([l()],Q.prototype,"_canCreateOrUpdate",null),r([l()],Q.prototype,"_effectiveEnabled",null),r([l()],Q.prototype,"_effectiveCapabilities",null),Q=r([x("esri.layers.support.EditingCapabilities")],Q);const wa=Q,Ze="esri.views.layers.support.editableLayerViews";function ko(t,e){const{associatedLayer:i}=t,a=i==null?void 0:i.infoFor3D;if(!a)return!1;const s=Nn(a);if(!(s!=null&&a.queryFormats.includes(s)))return q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because it does not support GLB queries.`),!1;const n=t.spatialReference,o=i.spatialReference;if(!Jt(n,o))return q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because its spatial reference (wkid:${n.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${o.wkid}).`),!1;const d=i.sourceJSON.sourceSpatialReference;if(!(d==null||Jt(d,o)))return q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${o.wkid}) is different from its source spatial reference (wkid:${d.wkid}).`),!1;const{view:u}=e;if(e.destroyed||u==null)return!1;const p=u.spatialReference,{viewingMode:h}=u.state,c=nn(n),m=h===rn.Global;return c&&!m?(q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${n.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!c&&m?(q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${n.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(Jt(n,p)||m&&on(p)&&ln(n))||(q.getLogger(Ze).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because its spatial reference (wkid:${n.wkid}) does not match the view spatial reference (wkid:${p.wkid}).`),!1)}let ie=class extends wa{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,i=this.layerInfo;return{enabled:e&&(i==null?void 0:i.enabled)!==!1}}get create(){const{attachments:e,defaults:i,layerInfo:a,layer:s,layerView:n}=this,o=i.create,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.addEnabled)!==!1,u=o.enabled&&d;return{attributes:u&&o.attributes,enabled:u,geometry:u&&o.geometry&&ba(s,n),attachments:{enabled:e.enabled&&u&&(a==null?void 0:a.attachmentsOnCreateEnabled)!==!1},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}get defaults(){return new wa({layer:this.layer})}get delete(){const{defaults:e,layerInfo:i}=this,a=e.delete,s=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.deleteEnabled)!==!1;return{enabled:a.enabled&&s,reliesOnOwnerAdminPrivileges:a.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:i}=this;return i!=null&&i.formTemplate?i.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){var s,n,o;const{layer:e}=this,i=!(!Mi(e)||!((s=e.relationships)!=null&&s.length)),a=!!((o=(n=this.formTemplate)==null?void 0:n.elements)!=null&&o.some(d=>d.type==="relationship"));return{enabled:i&&a}}get update(){const{attachments:e,defaults:i,layerInfo:a,layer:s,layerView:n}=this,o=i.update,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.updateEnabled)!==!1,u=o.enabled&&d,p=u&&o.attributes&&(a==null?void 0:a.attributeUpdatesEnabled)!==!1,h=u&&o.geometry&&(a==null?void 0:a.geometryUpdatesEnabled)!==!1&&ba(s,n),c=e.enabled&&(a==null?void 0:a.attachmentsOnUpdateEnabled)!==!1;return{attributes:p,enabled:u,geometry:h,attachments:{enabled:c,create:c&&o.attachments.create,update:c&&o.attachments.update},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}};function ba(t,e){return t.type!=="scene"||e!=null&&"type"in e&&e.type==="scene-layer-3d"&&ko(t,e)}r([l()],ie.prototype,"attachments",null),r([l()],ie.prototype,"create",null),r([l()],ie.prototype,"defaults",null),r([l()],ie.prototype,"delete",null),r([l()],ie.prototype,"formTemplate",null),r([l()],ie.prototype,"layerInfo",void 0),r([l()],ie.prototype,"layerView",void 0),r([l()],ie.prototype,"relationship",null),r([l()],ie.prototype,"update",null),ie=r([x("esri.widgets.Editor.support.EditorEditingCapabilities")],ie);const Fo=ie;let j=class extends G{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var e;return!!((e=this.layerView)!=null&&e.suspended)}get capabilities(){return new Fo({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:i,update:a,delete:{enabled:s}}=this.capabilities,n=e.attachments.enabled||a.attachments.enabled;return!this.disabled&&(e.enabled||a.enabled||n||s||i.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return Tn(this.layer,this.formTemplate)}get isTable(){return Pe(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:e,geometry:i}=this.capabilities.create;return this.isTable?e:e&&i}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,i=e.parent;return!this._suspended&&e.visible&&(!i||!("visible"in i)||i.visible)}};r([l()],j.prototype,"_suspended",null),r([l()],j.prototype,"capabilities",null),r([l()],j.prototype,"disabled",void 0),r([l()],j.prototype,"editable",null),r([l()],j.prototype,"formTemplate",null),r([l()],j.prototype,"hasInvalidFormTemplate",null),r([l()],j.prototype,"isTable",null),r([l()],j.prototype,"layer",void 0),r([l()],j.prototype,"layerInfo",void 0),r([l()],j.prototype,"layerView",void 0),r([l()],j.prototype,"supportsCreateFeaturesWorkflow",null),r([l()],j.prototype,"supportsUpdateWorkflow",null),r([l()],j.prototype,"visible",null),j=r([x("esri.widgets.Editor.support.EditorItem")],j);const Co=j,Xa="esri.widgets.Editor.EditorViewModel",Io=()=>q.getLogger(Xa),es=["create-features","update"];function $e(t,e,i){Io().error(new P(t,e,i))}function Eo(t,e){return t==null?void 0:t.find(i=>i.layer===e)}let I=class extends jt.EventedAccessor{constructor(t){super(t),this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new Ii({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new at,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new Qe,this.editorItems=new Qe,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new An({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new hi({disabledItemFunction:({layer:e})=>this._itemIsSuspended(e)}),this.layerInfos=null,this.ownSketchViewModel=new Ei({layer:this._sketchGraphicsLayer}),this.sketchOptions=new Bt,this.snappingOptions=new Ma({attributeRulesEnabled:!0}),this.spinnerViewModel=new On,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var e;this.canGoBack&&((e=this.activeWorkflow)!=null&&e.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var i;const{featureFormViewModel:e}=this;if(e){if(e.submit(),!e.submittable||e.hasPendingSubtypeChoice)return;const a=e.getValues();if(e.validateContingencyConstraints(a,{includeIncompleteViolations:!0}).length>0)return}await((i=this.activeWorkflow)==null?void 0:i.save())},this.selectFeature=(e,i=!1)=>{const a=this.activeWorkflow;this._candidateCommitted||(a==null?void 0:a.type)!=="update"||(a.data.rootFeature=e,i&&(a.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([C(()=>{var s;const t=this.view,e=(s=t==null?void 0:t.map)==null?void 0:s.editableLayers,i=t==null?void 0:t.allLayerViews,a=i==null?void 0:i.filter(n=>!!(e!=null&&e.includes(n.layer)));return[e,a,this.layerInfos,this.allowedWorkflows]},()=>this._updateEditorItems(),Le),C(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),ce(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),ce(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),ce(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),Re(()=>{var t;return(t=this.view)==null?void 0:t.map},t=>t.add(this._sketchGraphicsLayer),he),ce(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),C(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),C(()=>this.page,(t,e)=>{const i=[...this.pageStack];if(i.indexOf(t)===-1)i.push(t);else for(;i.length&&i.at(-1)!==t;)i.pop();this.pageStack=i},Le),Re(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),ce(()=>this.featureTemplatesViewModel,"select",async({item:t,oldItem:e})=>{var s;const{activeWorkflow:i}=this;if(i){if(i.type==="update"&&((s=i.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(e,{emit:!1})}}if(!t)return;const a={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(e,{emit:!1}),this.startCreateFeaturesWorkflow(a);this.startCreateFeaturesWorkflowAtFeatureCreation(a)}),ce(()=>this.view,"key-down",t=>{var e;t.key==="Escape"&&((e=this.activeWorkflow)!=null&&e.keyboardCancellationEnabled)&&(t.stopPropagation(),this.back())}),ce(()=>this.sketchViewModel,["create","delete","update"],t=>{var o,d;const{activeWorkflow:e}=this,i=(e==null?void 0:e.type)==="update",a=i?(o=e.activeWorkflow)==null?void 0:o.layer:e==null?void 0:e.layer,s=i?(d=e==null?void 0:e.activeWorkflow)==null?void 0:d.parentLayer:void 0,n=`sketch-${t.type}`;this.emit(n,{type:n,detail:t,layer:a,parentLayer:s})},mt),C(()=>this.view,t=>{if(this._snappingManager=ft(this._snappingManager),!t)return;const e=this.snappingOptions;this._snappingManager=new dn({view:t,options:e}),this.ownSketchViewModel.snappingManager=this._snappingManager},Le),C(()=>this.snappingOptions,t=>{this._snappingManager&&(this._snappingManager.options=t)},Le)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var t,e;(e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=Dt(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=Mt(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(t){ni(q.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),t&&t.length!==0||(t=[...es]),this._set("allowedWorkflows",t)}get canCreate(){return this.editorItems.some(t=>t.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(t=>t.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(t=>t.supportsUpdateWorkflow&&t.visible)}get featureTemplatesLayers(){const t=new Qe;for(const e of this.editorItems){const i=e.supportsCreateFeaturesWorkflow&&!e.isTable,a=this.hideTemplatesForInactiveLayers&&!e.visible;i&&!a&&t.push(e.layer)}return t}get editableItems(){return ni(q.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map(t=>{const{capabilities:e,disabled:i,hasInvalidFormTemplate:a,layer:s}=t,n=[],o=e.create,d=e.update,u=e.delete;return o.enabled&&n.push("create"),d.enabled&&n.push("update"),u.enabled&&n.push("delete"),{layer:s,supports:n,suspended:i,attributeUpdatesEnabled:d.attributes,geometryUpdatesEnabled:d.geometry,attachmentsOnCreateEnabled:o.attachments.enabled,attachmentsOnUpdateEnabled:d.attachments.enabled,hasInvalidFormTemplate:a,hasAttachments:e.attachments.enabled}})}get featureFormViewModel(){const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"?t.activeFeatureFormViewModel:(t==null?void 0:t.type)==="create-features"?t.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get sketchViewModel(){const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"?t.activeSketchViewModel:(t==null?void 0:t.type)==="create-features"?t.sketchViewModel:this.ownSketchViewModel}get state(){var i,a;if(!((i=this.view)!=null&&i.ready))return"disabled";const t=this.attachmentsViewModel.mode;if(t==="add")return"adding-attachment";if(t==="edit")return"editing-attachment";const{activeWorkflow:e}=this;return e!=null&&e.stepId?e.type==="update"&&((a=e.activeWorkflow)!=null&&a.stepId)?e.activeWorkflow.stepId:e.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var t;return this._updatingHandles.updating||((t=this.activeWorkflow)==null?void 0:t.updating)===!0}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}set view(t){this.ownSketchViewModel.view=t,this.spinnerViewModel.view=t,this._set("view",t)}get page(){const{activeWorkflow:t,state:e}=this;if((t==null?void 0:t.type)==="update"&&t.stepId==="awaiting-feature-to-update")return"ready";if((t==null?void 0:t.type)==="create-features"&&t.numPendingFeatures===0){const i=t.data.upload;if(i)return i.state==="default"?"ready":"creating-features-upload-details"}return e??"disabled"}get featureFormDisabled(){var e;const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"&&((e=t.activeEditorItem)==null?void 0:e.capabilities.update.attributes)===!1}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var e;const{activeWorkflow:t}=this;return!!t&&t.type==="update"&&!!((e=t.activeEditorItem)!=null&&e.capabilities.delete.enabled)}get hasPendingEdits(){var t;return((t=this.activeWorkflow)==null?void 0:t.hasPendingEdits)??!1}get snappingManager(){return this._snappingManager}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(t){return this.startCreateFeaturesWorkflow(t,"creating-features")}async startCreateFeaturesWorkflow(t,e="awaiting-feature-creation-info"){if(await B(()=>!this.updating),!this.canCreate)throw new P("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(t,e);this._set("activeWorkflow",a),await a.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(t){await B(()=>!this.updating);const e=this._createUpdatingResolver();try{const{initialFeature:i}=t,a=i.sourceLayer=i.layer,s=a?this.findEditorItemForLayer(a):void 0;if(!(s!=null&&s.supportsCreateFeaturesWorkflow))throw new P("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const n=this._createCreateFeaturesWorkflow({initialFeature:i,layer:s.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",n),await n.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await B(()=>!this.updating),!this.canUpdate)return void $e("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{t.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(t){if(await B(()=>!this.updating),!this.canUpdate)return void $e("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("awaiting-update-feature-candidate");i.data.candidates=t,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async startUpdateWorkflowAtFeatureEdit(t){if(await B(()=>!this.updating),!this.canUpdate)return void $e("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("editing-existing-feature");i.data.rootFeature=t,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:t}=this;t&&t.type==="update"?await t.deleteActiveFeature():$e("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(t){return this._cancelWorkflow({warnIfNoWorkflow:!0,...t})}findEditorItemForLayer(t){return this.editorItems.find(e=>e.layer===t)}itemHasInvalidFormTemplate(t){var e;return t!=null&&((e=this.findEditorItemForLayer(t.layer))==null?void 0:e.hasInvalidFormTemplate)===!0}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,R(()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()})}async _getEditorItemCandidates(t){const{view:e}=this;if(!(e!=null&&e.map))return[];const{map:i}=e,a=i.editableLayers.toArray()??[],s=i.allTables.toArray().filter(un)??[];return await Promise.allSettled([...a.map(n=>n.type==="subtype-group"?n.loadAll():Promise.resolve()),...s.map(n=>n.load())]),Ee(t),[...a.reverse(),...s.reverse()].filter(n=>Nt(n)&&(n.geometryType!=="mesh"||e.type==="3d")).flatMap(n=>n.type==="subtype-group"?n.sublayers.toArray():n)}_drainEditorItems(){this.editorItems.drain(t=>t.destroy())}async _updateEditorItems(){Dt(this._updateItemsTask);const{view:t}=this,e=Fi(async i=>{if(!(t!=null&&t.map)||!(t!=null&&t.allLayerViews))return;const a=await this._getEditorItemCandidates(i);if(!a.length)return void this._drainEditorItems();const s=[],n=[],o=[],{layerInfos:d}=this;for(const p of a){const h=Eo(d,p),c=await tt(t,p).catch(()=>null);(h?s:c?n:o).push(new Co({layer:p,layerInfo:h,layerView:c}))}d!=null&&d.length&&s.sort((p,h)=>d.findIndex(({layer:c})=>c===p.layer)-d.findIndex(({layer:c})=>c===h.layer));const u=[...s,...n,...o];i.aborted||(this._drainEditorItems(),this.editorItems.addMany(u))});this._updatingHandles.addPromise(e.promise),this._updateItemsTask=e}_afterEditorItemsChange(){const{activeWorkflow:t}=this;if(this.syncFeatureTemplates(),!t)return;const{stepId:e}=t;t.type!=="create-features"?t.type==="update"&&(e==="awaiting-feature-to-update"&&!this.canUpdateVisible||e==="awaiting-update-feature-candidate"&&!t.hasUpdatableCandidates)&&this._cancelWorkflow():e!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(t){const e=this.activeWorkflow;if(!e)return void((t==null?void 0:t.warnIfNoWorkflow)&&$e("editing:no-active-workflow","There is no active workflow to cancel."));if(!t||t.force!==!1)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await e.cancel(t);await e.cancel(t),this._set("activeWorkflow",null)}_createCreateFeaturesWorkflow(t,e){return Ja.create({viewModel:this,creationInfo:t,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(i,a,s)=>this._applyEdits(i,a,s),addAttachmentsCallback:(i,a)=>this._addAttachments(i,a)})}_createUpdateWorkflow(t){return bo.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,i,a)=>this._applyEdits(e,i,a),addAttachmentsCallback:(e,i)=>this._addAttachments(e,i)})}_addAttachments(t,e){const i=e.map(a=>this._addAttachment(t,a.feature,a.attachment))??[];return Promise.all(i)}async _addAttachment(t,e,i){var s;let a=null;if(!("addAttachment"in t)||((s=t.capabilities)==null?void 0:s.attachment)==null)throw new P("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var n;return a=await((n=t.addAttachment)==null?void 0:n.call(t,e,i).catch(o=>{throw(o==null?void 0:o.error)||o}))??null,a}),a}async _applyEdits(t,e,i){let a=null;const s=t.url?await pn(t.url):null,n={returnServiceEditsOption:(!s||!cn(s))&&!RegExp("/hosted/","i").test(t.url)?"original-and-current-features":void 0,...i};return await this._queueOperation(async()=>{const{view:o}=this;if(!o)return null;const d=await tt(o,t).catch(()=>null);return a=await t.applyEdits(e,n),d&&await B(()=>!d.updating),a}),a}_queueOperation(t){this._activityQueue.push(t);const e=(i,a)=>{const s=a.indexOf(i);s>-1&&a.splice(s,1)};return t().then(i=>{if(i!=null&&"error"in i&&i.error!=null)throw i.error;if(i!=null&&"addFeatureResults"in i){const{addFeatureResults:a,deleteFeatureResults:s,updateFeatureResults:n}=i,o=a.find(d=>!!d.error)||n.find(d=>!!d.error)||s.find(d=>!!d.error);if(o)throw o.error}return i}).catch(i=>{$e("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(e(a,this.failures),this._queueOperation(t)),cancel:()=>{e(a,this.failures)}};this._set("failures",[...this.failures,a])}).then(()=>{e(t,this._activityQueue)})}_createUpdatingResolver(){const t=st();return this._updatingHandles.addPromise(t.promise),t}_logErrorAndCancelWorkflow(t){const{name:e,message:i,details:a}=t;$e(e??"editing:workflow-start-failed",i??void 0,a??t),this._cancelWorkflow({force:!0})}_itemIsSuspended(t){const e=this.findEditorItemForLayer(t);return e!=null&&(!e.visible||e.disabled)}};r([l()],I.prototype,"_snappingManager",void 0),r([l({readOnly:!0})],I.prototype,"activeWorkflow",void 0),r([l({readOnly:!0})],I.prototype,"_activityQueue",void 0),r([l({value:[...es]})],I.prototype,"allowedWorkflows",null),r([l({readOnly:!0})],I.prototype,"canCreate",null),r([l()],I.prototype,"canCreateVisible",null),r([l({readOnly:!0})],I.prototype,"canUpdate",null),r([l()],I.prototype,"canUpdateVisible",null),r([l()],I.prototype,"featureTemplatesLayers",null),r([l()],I.prototype,"editableItems",null),r([l()],I.prototype,"editorItems",void 0),r([l({readOnly:!0})],I.prototype,"failures",void 0),r([l()],I.prototype,"hideTemplatesForInactiveLayers",void 0),r([l()],I.prototype,"attachmentsViewModel",void 0),r([l()],I.prototype,"featureFormViewModel",null),r([l()],I.prototype,"featureTemplatesViewModel",void 0),r([l()],I.prototype,"labelOptions",null),r([l()],I.prototype,"layerInfos",void 0),r([l()],I.prototype,"ownSketchViewModel",void 0),r([l()],I.prototype,"sketchOptions",void 0),r([l()],I.prototype,"sketchViewModel",null),r([l({type:Ma,nonNullable:!0})],I.prototype,"snappingOptions",void 0),r([l()],I.prototype,"spinnerViewModel",void 0),r([l()],I.prototype,"state",null),r([l({readOnly:!0})],I.prototype,"syncing",null),r([l()],I.prototype,"updating",null),r([l()],I.prototype,"tooltipOptions",null),r([l()],I.prototype,"valueOptions",null),r([l()],I.prototype,"view",null),r([l()],I.prototype,"pageStack",void 0),r([l()],I.prototype,"showDiscardEditsPrompt",void 0),r([l()],I.prototype,"_candidateCommitted",void 0),r([l()],I.prototype,"page",null),r([l()],I.prototype,"featureFormDisabled",null),r([l()],I.prototype,"canGoBack",null),r([l()],I.prototype,"shouldShowDeleteButton",null),r([l()],I.prototype,"hasPendingEdits",null),r([l()],I.prototype,"snappingManager",null),I=r([x(Xa)],I);const Vo=I;let ae=class extends G{constructor(e){super(e),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new Vi,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};r([l({type:Boolean,nonNullable:!0})],ae.prototype,"createFeaturesSection",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"directionModePicker",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"editFeaturesSection",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"labelsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"settingsMenu",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"snappingControls",void 0),r([l({type:Vi,nonNullable:!0})],ae.prototype,"snappingControlsElements",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"tooltipsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"undoRedoButtons",void 0),ae=r([x("esri.widgets.Editor.VisibleElements")],ae);const ts=ae,ot="esri-editor__panel-content",vt={base:ot,message:`${ot}__message`,section:`${ot}__section`,sectionGroup:`${ot}__section__group`,scrimContainer:`${ot}__scrim-container`},wt=()=>fe({scrim:()=>b(()=>import("./calcite-scrim-AMBqcegi.js"),__vite__mapDeps([4,1,2]),import.meta.url)});function Ie(t,...e){return f("div",{class:gt(vt.base,t!=null&&t.showScrimOverlay?vt.scrimContainer:void 0),key:(t==null?void 0:t.key)??"panel-content"},...e,t!=null&&t.showScrimOverlay?f("calcite-scrim",null):void 0)}function Li(t,...e){return f("div",{class:vt.message,"data-testid":"panel-content-message",key:(t==null?void 0:t.key)??"panel-content-message"},...e)}function Ye(t,...e){return f("div",{class:vt.section,key:(t==null?void 0:t.key)??"panel-content-section"},...e)}function xo(t,...e){return f("div",{class:vt.sectionGroup,key:(t==null?void 0:t.key)??"panel-content-section-group"},...e)}const Mo=()=>wt();function $o({helpMessage:t}){return f(Ie,{key:"creating-features-panel-content"},f(Li,{key:"content-message"},t))}const To=()=>wt();function Ao({editorItems:t,filterText:e,id:i,messagesTemplates:a,onFilterTextChange:s,onSelectFeature:n,workflow:o}){const d=new Map,u=o.data.candidates;let p=0;u.map(m=>({label:Oo(m),id:m.attributes[m.layer.objectIdField],data:m})).filter(({label:m,data:g})=>{const y=e.toLowerCase(),{title:_}=g.layer,v=t.find(w=>w.layer===g.sourceLayer);return v?v.supportsUpdateWorkflow&&(!y||(m==null?void 0:m.toLowerCase().includes(y))||(_==null?void 0:_.toLowerCase().includes(y))):null}).filter(Xe).forEach(m=>{var y;p++;const g=m.data.layer;d.has(g)?(y=d.get(g))==null||y.items.push(m):d.set(g,{id:`${g.id}`,label:g.title??"",items:[m]})});const h=t.toArray().map(({layer:m})=>d.get(m)).filter(Xe),c=p>10||e.length>0;return f(Ie,{key:"feature-list"},f(Ye,null,Ha({enableListScroll:!1,filterEnabled:c,filterText:e,id:i,items:h,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},onFilterChange:m=>s(m),onItemMouseEnter:m=>n(m.data),onItemMouseLeave:()=>n(null),onItemSelect:m=>n(m.data,!0)})))}function Oo(t){const e=t.layer;if(!e)return null;const i=e.fieldsIndex.get(e.objectIdField),a=i.alias||i.name,{attributes:s}=t,n=Va(e);return n&&s[n]&&`${s[n]}`||`${a}: ${s[i.name]}`}const So={base:"esri-editor__actions"},Ri=()=>fe({button:()=>b(()=>import("./calcite-button-Dn1EUE6k.js"),__vite__mapDeps([0,1,2]),import.meta.url)});function Gt({buttons:t,key:e}){return f("div",{class:So.base,key:e??"footer-actions",slot:"footer"},t.filter(Xe).map(({disabled:i,onClick:a,label:s,...n},o)=>f("calcite-button",{disabled:i??!1,key:`action-${o}`,onclick:()=>{i||a()},width:"full",...n},s)))}const Lo={notice:"esri-editor__notice"},is=()=>fe({notice:()=>b(()=>import("./calcite-notice-Bt_0bixh.js"),__vite__mapDeps([37,1,2]),import.meta.url)});function Ro({workflow:t,messages:e}){var s,n;const i=[],a="content-start";if(t!=null&&t.reliesOnOwnerAdminPrivileges){const o=e.ownerAdminNotice;i.push(f(Pt,{key:"owner-admin-notice",message:o,slot:a}))}if(t!=null&&t.hasInvalidFormTemplate){const o=e.formFieldUpdateError;i.push(f(Pt,{key:"form-field-error",kind:"warning",message:o,slot:a}))}if((t==null?void 0:t.type)==="create-features"&&((n=(s=t.data.upload)==null?void 0:s.result)==null?void 0:n.type)==="georeferenced-reprojected"){const o=e.helpMessages3d.meshReprojected;i.push(f(Pt,{key:"mesh-reprojected",kind:"warning",message:o,slot:a}))}return f(xi,null,i)}function Pt(t){const e=t.kind??"brand";return f("calcite-notice",{class:Lo.notice,icon:Sa[e],key:t.key,kind:e,open:!0,scale:"s"},t.title?f("div",{slot:"title"},t.title):null,f("div",{slot:"message"},t.message))}const Po={settingsContainer:"esri-editor__settings"},Do=()=>fe({accordion:()=>b(()=>import("./calcite-accordion-Qbg8nNxp.js"),__vite__mapDeps([46,1,2]),import.meta.url),"accordion-item":()=>b(()=>import("./calcite-accordion-item-DZRPxygy.js"),__vite__mapDeps([47,1,2]),import.meta.url)});function Wo({editorViewModel:t,messagesCommon:e,visibleElements:i}){const{snappingOptions:a,sketchOptions:s,view:n,snappingManager:o}=t,d=[],u={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle};return Object.values(u).includes(!0)&&d.push(f(hn,{sketchOptions:s,viewType:n==null?void 0:n.type,visibleElements:u})),i.snappingControls&&d.push(f(mn,{afterCreate:p=>p.layerListOpen=!1,snappingManager:o,snappingOptions:a,view:n,visibleElements:i.snappingControlsElements??new Vi})),d.length===0?null:f("calcite-accordion",{appearance:"transparent",class:Po.settingsContainer,key:"settings"},f("calcite-accordion-item",{"data-testid":"settings",heading:e.settings,iconStart:"gear"},d))}const Uo={base:"esri-editor__panel-toolbar"},No=()=>Promise.all([fe({button:()=>b(()=>import("./calcite-button-Dn1EUE6k.js"),__vite__mapDeps([0,1,2]),import.meta.url)}),Do()]);function Ho({editorViewModel:t,messagesCommon:e,visibleElements:i}){const{sketchViewModel:a}=t;return f("div",{class:Uo.base,key:"panel-toolbar"},f(Wo,{editorViewModel:t,messagesCommon:e,visibleElements:i}),i.undoRedoButtons?[f("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(a!=null&&a.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:e.undo,onclick:()=>a==null?void 0:a.undo(),scale:"l"},e.undo),f("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(a!=null&&a.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:e.redo,onclick:()=>a==null?void 0:a.redo(),scale:"l"},e.redo)]:null)}const Go=()=>Promise.all([Ri(),is(),wt()]);function ka({editorViewModel:t,headingLevel:e,messages:i,messagesCommon:a,onDelete:s,onSave:n,renderAttachments:o,renderFeatureForm:d}){const{activeWorkflow:u,featureFormViewModel:p,syncing:h}=t;if(!u||!p)return null;const c=Gr(u)?u.activeWorkflow??u:u,m=c.type.includes("update"),g=m&&!c.hasPendingEdits||h||p.updating,y=m?a.update:a.create,_=(c==null?void 0:c.type)==="create-features"&&c.createFeatureState==="create-new",v=(c==null?void 0:c.type)==="create-features"?c.numPendingFeatures:0,w=v>1?Ce(i.createFeaturesTemplate,{numFeatures:v}):y,k=u.shouldShowAttachments&&!p.activeRelationshipInput,V=p.inputs.every($=>!$.visible)&&!k?f(Li,{key:"panel-content-message"},Ce(i.clickToFinishTemplate,{button:y})):f(Ye,{key:"panel-content-section"},f(Ro,{messages:i,workflow:u}),f(xo,null,d(),k?f("div",{key:"attachments"},f(et,{level:pt(e)},i.attachments),o()):null));return f(xi,null,f(Ie,{key:"attribute-panel-content",showScrimOverlay:_},V),f(Gt,{buttons:[{onClick:n,disabled:g,label:w},t.shouldShowDeleteButton?{appearance:"outline",onClick:s,disabled:h,kind:"danger",label:a.delete}:void 0]}))}const K="esri-editor__upload-details",ne={base:K,status:`${K}__status`,titleWrapper:`${K}__title-wrapper`,title:`${K}__title`,description:`${K}__description`,loader:`${K}__loader`,iconSuccess:`${K}__icon ${K}__icon--success`,iconError:`${K}__icon ${K}__icon--error`,fileList:`${K}__file-list`,file:`${K}__file`,fileIcon:`${K}__file-icon`,fileName:`${K}__file-name`},jo=()=>Promise.all([fe({icon:()=>b(()=>import("./calcite-icon-CG93KzbT.js"),__vite__mapDeps([3,1,2]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-Bt4CsKoC.js"),__vite__mapDeps([36,1,2]),import.meta.url)}),Ri(),wt()]);function Bo(t){const{messages:e,key:i,upload:a}=t;return f(xi,null,f(Ie,{key:i??"upload-details"},f(Ye,null,zo(t))),a.state==="error"?f(Gt,{buttons:[{onClick:()=>a.retry(),label:e.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function zo(t){const e=Zo(t);return e?f("div",{class:ne.base,"data-testid":"upload-details",key:"upload-details-content"},f("div",{class:ne.status,key:"status"},e.iconContent,f("div",{class:ne.titleWrapper,key:"text"},f("div",{class:ne.title,key:"title"},e.title),f("div",{class:ne.description,key:"description"},e.description))),Ko(t.upload)):null}function Zo({helpMessage:t,messages:e,upload:i}){switch(i.state){case"pending":{const{title:a,description:s}=e.modelUploads.pending;return{title:a,description:s,iconContent:f("calcite-loader",{"aria-hidden":"true",class:ne.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*i.progress),i.progress===1?100:99)})}}case"success":{const{title:a}=e.modelUploads.success;return{title:a,description:t||e.helpMessages3d.mesh,iconContent:f("calcite-icon",{class:gt(ne.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:a}=e.modelUploads.error;return{title:a,description:qo(i.error,e),iconContent:f("calcite-icon",{class:gt(ne.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function qo(t,e){if(!t)return null;const i=e.modelUploads.error.messages;switch(t.constructor){case jn:return i.noModel;case Gn:return i.multipleModels;case Hn:return i.conversionFailed;case P:switch(t.name){case"glt-loader-error":case"gltf-loader-invalid-glb":return i.loadFailed;case"gltf-loader-unsupported-feature":return i.unsupportedFeature;case"glt-loader-request-error":return i.resourceRequestFailed;default:return i.default}default:return i.default}}function Ko(t){return f("div",{class:ne.fileList,key:"file-list"},t.files.map(e=>f("div",{class:ne.file,key:`file-${e.name}`},f("calcite-icon",{class:ne.fileIcon,icon:Qo(e),scale:"s"}),f("span",{class:ne.fileName},Jo(e.name)))))}function Jo(t){var e;return((e=t.split("/").pop())==null?void 0:e.split("\\").pop())??""}function Qo(t){var i;const e=(i=t.name.split(".").pop())==null?void 0:i.toLowerCase();return(e?Xo[e]:null)??Yo}const Yo="file",Fa="file-shape",xt="file-image",Xo={glb:Fa,gltf:Fa,jpeg:xt,jpg:xt,png:xt,svg:xt,zip:"file-zip"};let M=class extends bi{constructor(t,e){super(t,e),this._featureForm=new wr,this._attachments=new Sn({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new Wr({enableListScroll:!1,renderItemContentEnd:i=>i.supportsUpload?f("calcite-icon",{class:Be.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:i=>i.label,renderCustomGroupContent:i=>this._renderCustomTemplateGroupContent(i)}),this._filterText="",this._prompt=null,this._spinner=new Ln,this._loading=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new Vo,this.visibleElements=new ts,this._renderAttachments=()=>this._attachments.render(),this._renderFeatureForm=()=>this._featureForm.render(),this._renderFeatureTemplates=()=>this._featureTemplates.render(),this._renderSelectIcon=()=>f("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:i,key:a},...s)=>{const{visibleElements:n}=this;return f("calcite-flow-item",{closable:!1,heading:i,headingLevel:this.headingLevel,key:a,loading:this._loading,onCalciteFlowItemBack:this._onBack},n.settingsMenu?f(Ho,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:n}):null,...s)},this._showDiscardEditsPrompt=()=>{var s;const{messages:i,activeWorkflow:a}=this;return(a==null?void 0:a.type)==="create-features"&&ct(a.data.creationInfo)?this._showPromptAndWait(((s=a.data.upload)==null?void 0:s.state)==="success"?i.modelUploads.cancelPlacementPrompt:i.modelUploads.cancelUploadPrompt):this._showPromptAndWait({title:i.cancelEditTitle,message:i.cancelEditWarningMessage,yesLabel:i.discardEdits,noLabel:i.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:i,messagesCommon:a}=this;return this._showPromptAndWait({title:i.cancelRequestTitle,message:i.cancelRequestWarningMessage,yesLabel:a.form.yes,noLabel:a.form.no})},this._showPrompt=i=>{var a,s;(s=(a=this._prompt)==null?void 0:a.cancel)==null||s.call(a),this._prompt=i},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteWarningTitle,message:i.deleteWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:i.keepFeature,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=i=>(i==null||i.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var a;const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"||i.type==="update"&&((a=i.activeWorkflow)==null?void 0:a.type)==="create-features"?(this._attachments.addFile(),i.back()):this._attachments.addAttachment().then(()=>i.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?(this._attachments.updateFile(),i.back()):this._attachments.updateAttachment().then(()=>i.back()))},this._onAttachmentDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteAttachmentWarningTitle,message:i.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:i.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const i=this._attachments,{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"?i.deleteFile():(await i.deleteAttachment(i.viewModel.activeAttachmentInfo),this._clearPrompt()),await a.back(),this._clearPrompt())},this._onAttachmentsError=i=>{this._showPrompt({title:this.messages.errorWarningTitle,message:i.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([C(()=>pt(this.headingLevel),t=>{this._featureForm.headingLevel=t,this._featureTemplates.headingLevel=t},he),ce(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:t})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(e=>e?t.allow():t.deny())}),Re(()=>this.viewModel.featureFormViewModel,t=>{this._featureForm.viewModel=t},he),C(()=>this.viewModel,t=>{this._attachments.viewModel=(t==null?void 0:t.attachmentsViewModel)??null,this._featureTemplates.viewModel=(t==null?void 0:t.featureTemplatesViewModel)??null,this._spinner.viewModel=(t==null?void 0:t.spinnerViewModel)??null,t.showDiscardEditsPrompt=this._showDiscardEditsPrompt},he),C(()=>this.view,(t,e)=>{const i=`editor-${this.id}-spinner`;e==null||e.ui.remove(this._spinner,i),t==null||t.ui.add(this._spinner,{key:i,position:"manual"})},he),C(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([t])=>{var e;t&&(this._featureForm.set(t.featureForm),this._attachments.set(t.attachments),this._featureTemplates.set(t.featureTemplates),(e=this.viewModel.sketchViewModel)==null||e.set(t.sketch))},he),Re(()=>{var t;return(t=this._attachments)==null?void 0:t.error},t=>this._onAttachmentsError(t)),Re(()=>{var t;return(t=this.viewModel)==null?void 0:t.failures},t=>{const{messages:e}=this,[{error:i,retry:a,cancel:s}]=t;this._showPrompt({title:e.errorWarningTitle,message:Ce(e.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:e.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:e.ignore,action:()=>{s(),this._clearPrompt()}}}})}),C(()=>{var t;return(t=this.viewModel)==null?void 0:t.state},t=>{switch(t){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),C(()=>this.viewModel.featureFormDisabled,t=>this._featureForm.disabled=t),this._connectDelayedLoading()])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([fe({"flow-item":()=>b(()=>import("./calcite-flow-item-yCDGxbne.js"),__vite__mapDeps([48,1,2]),import.meta.url),flow:()=>b(()=>import("./calcite-flow-DAN3cZ6T.js"),__vite__mapDeps([49,1,2]),import.meta.url),icon:()=>b(()=>import("./calcite-icon-CG93KzbT.js"),__vite__mapDeps([3,1,2]),import.meta.url),list:()=>b(()=>import("./calcite-list-CSiFAJ9a.js"),__vite__mapDeps([32,1,2,33,34,15,22,8,23,9,24]),import.meta.url)}),Mo(),To(),Ri(),is(),wt(),No(),Bn(),Go(),jo()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}_connectDelayedLoading(){let e;return ve([C(()=>{const{viewModel:i}=this;return i.syncing||i.updating||this._attachments.submitting},i=>{clearTimeout(e),e=void 0,i?e=setTimeout(()=>{clearTimeout(e),e=void 0,this._loading=i},250):this._loading=i},Le),R(()=>clearTimeout(e))])}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(t){ni(q.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=t}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(t){this.viewModel.hideTemplatesForInactiveLayers=t}get icon(){return"pencil"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(t){this.viewModel.labelOptions=t}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(t){this.viewModel.layerInfos=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(t){this.viewModel.tooltipOptions=t}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(t){this.viewModel.valueOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(t){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(t)}startCreateFeaturesWorkflowAtFeatureEdit(t){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(t)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(t){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(t)}startUpdateWorkflowAtFeatureEdit(t){return this.viewModel.startUpdateWorkflowAtFeatureEdit(t)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(t){return this.viewModel.cancelWorkflow(t)}render(){const{viewModel:t}=this,e=this.classes(Be.base,yt.widget,yt.panel);return t?f("div",{class:e,key:"base"},f("calcite-flow",{key:"flow"},t.pageStack.map(i=>this._renderPage(i))),this._prompt?f(La,{...this._prompt,headingLevel:this.headingLevel}):void 0):f("div",{class:e,key:"empty"})}_renderPage(t){switch(t){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return f("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:t,messages:e}=this;return f(t,{heading:e.selectTemplate,key:"templates-panel"},f(Ie,{key:"feature-templates"},f(Ye,null,this._renderFeatureTemplates())))}_renderUploadDetails(){const{EditorPanel:t,activeWorkflow:e,messages:i}=this;if((e==null?void 0:e.type)!=="create-features")return null;const a=e.data.upload;return a?f(t,{heading:i.createFeatures,key:"upload-details-panel"},f(Bo,{helpMessage:this._helpMessage,messages:i,upload:a})):null}_renderCreatingFeatures(){var d,u;const{EditorPanel:t,activeWorkflow:e,messages:i,messagesCommon:a,headingLevel:s,viewModel:n}=this;if(!e)return null;const o=e.type==="create-features"&&e.numPendingFeatures>0||e.type==="update"&&((d=e==null?void 0:e.activeWorkflow)==null?void 0:d.type)==="create-features"&&((u=e.activeWorkflow)==null?void 0:u.numPendingFeatures)>0;return f(t,{heading:i.createFeatures,key:"create-features-panel"},o?f(ka,{editorViewModel:n,headingLevel:s,messages:i,messagesCommon:a,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}):f($o,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:t,messages:e,messagesCommon:i,headingLevel:a,viewModel:s}=this;return f(t,{heading:e.editFeature,key:"update-feature-panel"},f(ka,{editorViewModel:s,headingLevel:a,messages:e,messagesCommon:i,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(t){const{messages:e,viewModel:i}=this,a=fn(t.group.items,s=>i.itemHasInvalidFormTemplate(s)?e.formFieldCreateError:void 0);return a?f(Pt,{kind:"warning",message:a}):null}_renderAttachmentAdding(){const{EditorPanel:t,_attachments:e,messages:i,messagesCommon:a}=this;return f(t,{heading:i.addAttachment,key:"attachment-adding-panel"},f(Ie,{key:"attachments"},this._renderAttachments()),f(Gt,{buttons:[{label:e.submitting?a.cancel:a.add,disabled:e.submitting||!e.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:t,_attachments:e,activeWorkflow:i,messages:a,messagesCommon:s}=this;return i?f(t,{heading:a.editAttachment,key:"attachment-editing-panel"},f(Ie,{key:"attachments"},this._renderAttachments()),i.shouldAllowAttachmentEditing?f(Gt,{buttons:[{label:s.update,disabled:e.submitting||!e.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:e.submitting,label:s.delete}]}):void 0):null}_renderReady(){const{EditorPanel:t,messages:e,viewModel:i,visibleElements:a}=this,s=this._helpMessage;return f(t,{heading:e.widgetLabel,key:"landing-panel"},f(Ie,{key:"landing-content"},i.editorItems.length?[a.editFeaturesSection?f(Ye,{key:"edit-actions"},this._renderUpdateActions()):null,a.createFeaturesSection&&i.canCreateVisible?f(Ye,{key:"create-actions"},this._renderCreateActions()):null]:f(Li,{key:"no-content"},e.noEditableLayers)),s?f("div",{class:Be.helpMessage,key:"footer-actions",slot:"footer"},s):void 0)}get _helpMessage(){var s;const{activeWorkflow:t,messages:e,view:i}=this,a=t==null?void 0:t.helpMessage;return a?(s=e[(i==null?void 0:i.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:s[a]:void 0}_renderUpdateActions(){var s;const{messages:t,messagesCommon:e,viewModel:i}=this,a={id:"select",label:e.select};return f("div",{class:Be.updateActions,key:"update-actions"},f(et,{level:pt(this.headingLevel)},t.editFeatures),f("calcite-list",{class:Be.updateActionsList,selectionAppearance:"border",selectionMode:"single"},Ai({disabled:!i.canUpdateVisible,grouped:!1,item:a,selectedItem:((s=i.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-to-update"?a:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return f("div",{key:"create-actions"},f(et,{level:pt(this.headingLevel)},this.messages.createFeatures),f("div",{class:Be.featureTemplatesContainer,key:"templates"},this._renderFeatureTemplates()))}_renderFeatureList(){const{EditorPanel:t,viewModel:e}=this,{activeWorkflow:i}=e;if((i==null?void 0:i.type)!=="update")return null;const a=i.data.candidates,s=Ce(this.messages.multipleFeaturesTemplate,{total:a.length});return f(t,{heading:s,key:"feature-list"},f(Ao,{editorItems:e.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:n=>this._filterText=n,onSelectFeature:(n,o)=>e.selectFeature(n,o)}))}_showPromptAndWait({title:t,message:e,yesLabel:i,noLabel:a}){const s=st(),{view:n}=this,o=n==null?void 0:n.focused;return this._showPrompt({title:t,message:e,context:"danger",actions:{primary:{label:i,action:()=>s.resolve(!0)},secondary:{label:a,action:()=>s.resolve(!1)}}}),s.promise.finally(()=>{this._clearPrompt(),o&&(n==null||n.focus())})}};r([l()],M.prototype,"_featureForm",void 0),r([l()],M.prototype,"_attachments",void 0),r([l()],M.prototype,"_featureTemplates",void 0),r([l()],M.prototype,"_filterText",void 0),r([l()],M.prototype,"_prompt",void 0),r([l()],M.prototype,"_spinner",void 0),r([l()],M.prototype,"_deleteButtonCommonInfo",null),r([l()],M.prototype,"_loading",void 0),r([l({readOnly:!0})],M.prototype,"activeWorkflow",null),r([l()],M.prototype,"allowedWorkflows",null),r([l()],M.prototype,"headingLevel",void 0),r([l()],M.prototype,"hideTemplatesForInactiveLayers",null),r([l()],M.prototype,"icon",null),r([l()],M.prototype,"label",null),r([l()],M.prototype,"labelOptions",null),r([l()],M.prototype,"layerInfos",null),r([l(),ge("esri/widgets/Editor/t9n/Editor")],M.prototype,"messages",void 0),r([l(),ge("esri/t9n/common")],M.prototype,"messagesCommon",void 0),r([l(),ge("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],M.prototype,"messagesTemplates",void 0),r([l()],M.prototype,"snappingOptions",null),r([l()],M.prototype,"tooltipOptions",null),r([l()],M.prototype,"supportingWidgetDefaults",void 0),r([l({type:yn,nonNullable:!0})],M.prototype,"valueOptions",null),r([l()],M.prototype,"view",null),r([l(),ki(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],M.prototype,"viewModel",void 0),r([l({type:ts,nonNullable:!0})],M.prototype,"visibleElements",void 0),r([l()],M.prototype,"_helpMessage",null),M=r([x("esri.widgets.Editor")],M);const Xl=M;export{Xl as default};
