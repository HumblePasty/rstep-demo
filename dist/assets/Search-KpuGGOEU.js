import{dH as bt,a4 as re,r as o,m as n,n as G,s as C,R as D,cr as xt,sb as Mt,Z as xe,aZ as ye,H as ne,fB as Ze,bJ as qe,bM as It,ck as Me,bm as J,M as pe,b1 as Ie,Y as $e,ai as fe,hV as $t,aP as ve,W as Re,c0 as Rt,bZ as Tt,V as Ct,g6 as Lt,by as Ft,g5 as Et,iN as Nt,g as U,kW as kt,gW as ce,fU as ae,gy as At,b$ as jt,h0 as Oe,F as me,iw as Bt,kV as Ot,gk as Ue,ig as Je,bG as p,bI as b,ik as _e,gV as Dt,b0 as Gt,kI as Pt,sc as Kt,pb as ue,kJ as De,v as Vt,dV as Ht,mR as zt}from"./index-CdlB_1jZ.js";import{c as Te,a as Se,n as Ge,r as Wt}from"./geometryUtils-DSJI0N_m.js";import{f as Ce,s as Le,i as Fe}from"./utils-C6_UxkSn.js";import{t as Ee}from"./commonProperties-DHiB1uzW.js";import{p as Zt,n as qt}from"./project-7YK4d_tY.js";import{t as Ut}from"./GoTo-DkJRpr0i.js";import{t as Pe}from"./accessibleHandler-BE7PkFIl.js";import{i as z}from"./legacyIcon-DkTFV6vi.js";import"./scaleUtils-CHbpvxSE.js";import"./utils-BYArndnc.js";const w="esri-search",_={base:w,hasMultipleSources:`${w}--multiple-sources`,isLoading:`${w}--loading`,isSearching:`${w}--searching`,showSuggestions:`${w}--show-suggestions`,showSources:`${w}--sources`,showWarning:`${w}--warning`,container:`${w}__container`,input:`${w}__input`,inputContainer:`${w}__input-container`,form:`${w}__form`,submitButton:`${w}__submit-button`,sourcesButton:`${w}__sources-button`,sourcesButtonDown:`${w}__sources-button--down`,sourcesButtonUp:`${w}__sources-button--up`,clearButton:`${w}__clear-button`,sourceName:`${w}__source-name`,suggestionsMenu:`${w}__suggestions-menu`,suggestionList:`${w}__suggestions-list`,suggestionListCurrentLocation:`${w}__suggestions-list--current-location`,sourcesMenu:`${w}__sources-menu`,source:`${w}__source`,warningMenu:`${w}__warning-menu`,warningMenuBody:`${w}__warning-body`,warningMenuHeader:`${w}__warning-header`,warningMenuText:`${w}__warning-text`,noValueText:`${w}__no-value-text`},Q="esri-search-result-renderer",q={base:Q,showMoreResults:`${Q}__more-results--show-more-results`,moreResults:`${Q}__more-results`,moreResultsList:`${Q}__more-results-list`,moreResultsItem:`${Q}__more-results-item`,moreResultsListHeader:`${Q}__more-results-list-header`};let I=class extends bt(re){constructor(t){super(t),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};o([n()],I.prototype,"autoNavigate",void 0),o([n()],I.prototype,"filter",void 0),o([n()],I.prototype,"getResults",void 0),o([n()],I.prototype,"getSuggestions",void 0),o([n()],I.prototype,"maxResults",void 0),o([n()],I.prototype,"maxSuggestions",void 0),o([n()],I.prototype,"minSuggestCharacters",void 0),o([n()],I.prototype,"outFields",void 0),o([n()],I.prototype,"placeholder",void 0),o([n()],I.prototype,"popupEnabled",void 0),o([n()],I.prototype,"popupTemplate",void 0),o([n()],I.prototype,"prefix",void 0),o([n()],I.prototype,"resultGraphicEnabled",void 0),o([n()],I.prototype,"resultSymbol",void 0),o([n()],I.prototype,"suggestionsEnabled",void 0),o([n()],I.prototype,"suffix",void 0),o([n()],I.prototype,"withinViewEnabled",void 0),o([n()],I.prototype,"zoomScale",void 0),I=o([G("esri.widgets.Search.SearchSource")],I);const Ne=I,Jt=/https?:\/\/services.*\.arcgis\.com/i,Qt=/(?:\{([^}]+)\})/g,se=()=>D.getLogger("esri.widgets.Search.support.layerSearchUtils");function Xt(e,t){const{exactMatch:s=!1,location:r,maxResults:i,spatialReference:l,source:a,sourceIndex:u,suggestResult:c,view:d}=e,{layer:h,filter:S,zoomScale:f}=a,v=d==null?void 0:d.scale,y=Qe(a,d),x=t==null?void 0:t.signal;return Ye(h).then(()=>{const $=h.popupTemplate;return $?$.getRequiredFields(h.fieldsIndex):null}).then($=>{var le,Ae,je,Be;const{objectIdField:k,returnZ:E}=h,P=ot(a);if(!ke(h,P))throw se().error("invalid-field: displayField is invalid."),new C("getResults():invalid-field","displayField is invalid.");const R=$!=null&&$.length?$:[P],N=a.outFields||R,A=Xe(N);if(N.includes(k)||A||N.push(k),(le=h.floorInfo)!=null&&le.floorField&&N.push(h.floorInfo.floorField),!(A||he(h,N)))throw se().error("invalid-field: outField is invalid."),new C("getResults():invalid-field","outField is invalid.");const M=h.createQuery(),{orderByFields:K}=a;if(K&&(M.orderByFields=K),l){M.outSpatialReference=l;const V=1/xt(l);V&&(M.maxAllowableOffset=V)}const j=h.geometryType==="mesh"||h.geometryType==="multipatch",ie=((je=(Ae=h.capabilities)==null?void 0:Ae.data)==null?void 0:je.supportsZ)&&!j;if(M.returnZ=ie&&E!==!1,M.returnGeometry=!0,M.multipatchOption=j?"xyFootprint":null,N&&(M.outFields=N),r)M.geometry=r;else if(c.key)M.objectIds=[c.key];else{const V=a.searchFields||[P];if(!he(h,V))throw se().error("invalid-field: search field is invalid."),new C("getResults():invalid-field","search field is invalid.");if(it(h)&&(M.num=i),y&&(M.geometry=y),!((Be=c.text)==null?void 0:Be.trim()))return[];const ge=c.text,{prefix:vt="",suffix:_t=""}=a,St=nt(`${vt}${ge}${_t}`);rt(h)&&tt(h,V)&&!s&&ge&&(M.fullText=st({text:ge,searchFields:V}));const wt=lt({searchTerm:St,layer:h,searchFields:V,filter:S,exactMatch:s,query:M,type:"search"});if(M.where=wt,!et(M))return[]}return h.queryFeatures(M,{signal:x}).then(V=>ds(V,d,a,u,P,v,f))})}function Yt(e,t){const{source:s,spatialReference:r,view:i,suggestTerm:l,maxSuggestions:a,sourceIndex:u,exactMatch:c}=e,{layer:d,filter:h}=s,S=t==null?void 0:t.signal,f=Qe(s,i);return Ye(d).then(()=>{if(!it(d))return[];const v=ot(s),y=s.searchFields||[v],x=[];s.suggestionTemplate?s.suggestionTemplate.replaceAll(Qt,(ie,le)=>(x.push(le),ie)):x.push(v);const $=Xe(x);x.includes(d.objectIdField)||$||x.push(d.objectIdField);const k=ke(d,v),E=$||he(d,x),P=he(d,y);if(!k)throw se().error("invalid-field: displayField is invalid."),new C("getSuggestions():invalid-field","displayField is invalid.");if(!E)throw se().error("invalid-field: outField is invalid."),new C("getSuggestions():invalid-field","outField is invalid.");if(!P)throw se().error("invalid-field: search field is invalid."),new C("getSuggestions():invalid-field","search field is invalid.");const R=d.createQuery(),{orderByFields:N}=s;if(N&&(R.orderByFields=N),R.outSpatialReference=r,R.returnGeometry=!1,R.num=a,R.outFields=x,f&&(R.geometry=f),!l.trim())return[];const{prefix:A="",suffix:M=""}=s,K=nt(`${A}${l}${M}`);rt(d)&&tt(d,y)&&!c&&l&&(R.fullText=st({text:l,searchFields:y}));const j=lt({searchTerm:K,layer:d,searchFields:y,filter:h,exactMatch:c,query:R,type:"suggest"});return R.where=j,et(R)?d.queryFeatures(R,{signal:S}).then(ie=>as(ie,s,u,v)):[]})}function Qe(e,t){const{filter:s,withinViewEnabled:r}=e,i=t==null?void 0:t.extent;return(s==null?void 0:s.geometry)??(r&&i?i:void 0)}function Xe(e){return e&&e.includes("*")}async function Ye(e){e&&await e.load()}function et(e){return!(!e.fullText&&!e.where)}function tt(e,t){const s=e==null?void 0:e.indexes;return!s||!(t!=null&&t.length)?!1:s.filter(r=>r.indexType==="FullText").some(r=>{var l;const i=((l=r.fields)==null?void 0:l.split(",").map(a=>a.trim().toLowerCase()))||[];return t.every(a=>i.includes(a.toLowerCase()))})}function st({text:e,searchFields:t}){return e.trim().split(" ").filter(s=>!!s.trim()).map(s=>new Mt({onFields:t,searchTerm:s,searchType:"prefix"}))}function rt(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsFullTextSearch)??!1}function it(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsPagination)??!1}function es(e){var t,s,r;return((r=(s=(t=e==null?void 0:e.fieldsIndex)==null?void 0:t.fields)==null?void 0:s.find(i=>i.type==="string"))==null?void 0:r.name)??""}function ot(e){return e.displayField||e.layer.displayField||es(e.layer)}function he(e,t){return!(!e||!(t!=null&&t.length))&&t.every(s=>ke(e,s))}function ke(e,t){return!!e.getField(t)}function ts(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function ss({codedValues:e},t,s){return ye(e??[],r=>{const i=r.name,l=s?i:i.toLowerCase();return(s?t:t.toLowerCase())===l?r.code.toString():null})??null}function nt(e){return e.replaceAll("'","''")}function oe(e,t){const s=t==null?void 0:t.where;return s?`(${e}) AND (${s})`:e}function rs({currentTerm:e,field:t,filter:s,exactMatch:r,url:i,type:l}){const a=t==null?void 0:t.type,u=t==null?void 0:t.name;if(a==="string"||a==="date"||a==="global-id"){const c=Jt.test(i??""),d=c&&ts(e)?"N":"";return oe(r&&l==="search"?`${u} = ${d}'${e}'`:c?`${u} LIKE ${d}${`'${e}%'`}`:`${`LOWER(${u})`} LIKE ${d}${`'${e.toLowerCase()}%'`}`,s)}if(a==="oid"||a==="small-integer"||a==="integer"||a==="single"||a==="double"){const c=Number(e);return isNaN(c)?null:oe(`${u} = ${c}`,s)}return oe(`${u} = ${e}`,s)}function is(e,t){return e?` OR (${t})`:`(${t})`}function lt({searchTerm:e,layer:t,searchFields:s,filter:r,exactMatch:i,query:l,type:a}){const{definitionExpression:u,url:c}=t;let d="";return!l.fullText&&e&&s&&s.forEach(h=>{var y;const S=t.getField(h),f=(y=t.getFieldDomain)==null?void 0:y.call(t,h,{excludeImpliedDomains:xe("esri-widget-legacy-field-domain-calculation")}),v=(f&&f.type==="coded-value"?ss(f,e,i):null)||e||null;if(v!==null){const x=rs({currentTerm:v,field:S,filter:r,exactMatch:i,url:c,type:a});x&&(d+=is(d,x))}}),u&&d?`(${u}) AND (${d})`:u||d}function os(e,t){let s=null;const{codedValues:r}=e;return r&&r.length&&r.some(i=>i.code===t&&(s=i.name,!0)),s}function ns(e,t){return e[t]??e[Object.keys(e).find(s=>s.toLowerCase()===t.toLowerCase())]}function at(e,t,s){var a;const r=e.sourceLayer,{attributes:i}=e,l=(a=r.getFieldDomain)==null?void 0:a.call(r,s,{feature:e,excludeImpliedDomains:xe("esri-widget-legacy-field-domain-calculation")});if(t)return qe(t,i);if(s&&i){const u=r.getField(s),c=ns(i,s);return c==null?"":l&&l.type==="coded-value"?os(l,c)??"":(u==null?void 0:u.type)==="date"?It(new Date(c)):typeof c=="number"?c.toString():typeof c!="string"?"":c.trim()}return""}function ls(e,t,s,r){const i=e.sourceLayer,{attributes:l}=e,{objectIdField:a}=i,u=a?l[a]:null;return{text:at(e,t.suggestionTemplate,r),key:u,sourceIndex:s}}function as(e,t,s,r){return e.features.map(i=>ls(i,t,s,r))}function us(e){return e!=null&&e.minScale!=null&&e.maxScale!=null}function cs(e,t,s,r,i,l,a){const u=e.clone(),c=e.sourceLayer,d=c==null?void 0:c.objectIdField,h=d?e.attributes[d]:null,S=at(e,s.searchTemplate,i);l!=null&&us(c)&&(c.minScale&&c.minScale<l?l=c.minScale:c.maxScale&&c.maxScale>l&&(l=c.maxScale));const f=u.geometry?Te(u.geometry,t??void 0,l??void 0):void 0,v=typeof a=="number"&&f?Se(ne(f),t??void 0,a):f,y=e.clone();return v!=null&&(y.geometry=Ze.fromExtent(v)),{extent:v,target:y,feature:u,key:h,name:S,sourceIndex:r}}function ds(e,t,s,r,i,l,a){return e.features.map(u=>cs(u,t,s,r,i,l,a))}var we;let O=we=class extends Ne{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,s)=>Xt({source:this,...t},s),this.getSuggestions=(t,s)=>Yt({source:this,...t},s)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new we({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?ne(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return((t=(e=this.layer.fieldsIndex)==null?void 0:e.fields.find(s=>s.type==="string"))==null?void 0:t.name)??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(s=>{const r=e.getField(s);return(r==null?void 0:r.alias)||s}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};o([n({json:{read:{source:"field.name"},write:{target:"field.name"}}})],O.prototype,"displayField",void 0),o([n({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],O.prototype,"exactMatch",void 0),o([n({value:null})],O.prototype,"layer",null),o([n()],O.prototype,"name",null),o([n({type:[String],json:{write:!0}})],O.prototype,"orderByFields",void 0),o([n()],O.prototype,"searchFields",void 0),o([n()],O.prototype,"searchTemplate",void 0),o([n()],O.prototype,"suggestionTemplate",void 0),O=we=o([G("esri.widgets.Search.LayerSearchSource")],O);const X=O;function hs(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function ps(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let W=class extends re{constructor(t){super(t),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};o([n({type:String,json:{write:!0}})],W.prototype,"address",void 0),o([n({type:Object,json:{write:!0}})],W.prototype,"attributes",void 0),o([n({type:Me,json:{write:!0}})],W.prototype,"extent",void 0),o([n({type:J,json:{write:!0}})],W.prototype,"location",void 0),o([n({type:Number,json:{write:!0}})],W.prototype,"score",void 0),W=o([G("esri.rest.support.AddressCandidate")],W);const ut=W;let T=class extends re{constructor(t){super(t),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};o([n({type:Object,json:{write:!0}})],T.prototype,"address",void 0),o([n(Ee)],T.prototype,"apiKey",void 0),o([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],T.prototype,"categories",void 0),o([n({type:String,json:{write:!0}})],T.prototype,"countryCode",void 0),o([n({type:Boolean,json:{write:!0}})],T.prototype,"forStorage",void 0),o([n({type:J,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],T.prototype,"location",void 0),o([n({type:String,json:{write:!0}})],T.prototype,"locationType",void 0),o([n({type:String,json:{write:!0}})],T.prototype,"magicKey",void 0),o([n({type:Number,json:{write:!0}})],T.prototype,"maxLocations",void 0),o([n({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],T.prototype,"outFields",void 0),o([n({type:pe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],T.prototype,"outSpatialReference",void 0),o([n({type:Me,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=s}}}})],T.prototype,"searchExtent",void 0),T=o([G("esri.rest.support.AddressToLocationsParameters")],T),T.from=Ie(T);const ct=T;async function gs(e,t,s){t=ct.from(t);const r=Ce(e),{address:i,...l}=t.toJSON(),a={...i,...l,f:"json"},u=Le({...r.query,...a}),c=Fe(u,s),d=`${r.path}/findAddressCandidates`;return $e(d,c).then(ms)}function ms({data:e}){if(!e)return[];const{candidates:t,spatialReference:s}=e;return t?t.map(r=>{if(!r)return;const{extent:i,location:l}=r,a=!i||ps(i);return hs(l)&&a?(i&&(i.spatialReference=s),l&&(l.spatialReference=s),ut.fromJSON(r)):void 0}):[]}let H=class extends re{constructor(t){super(t),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};o([n(Ee)],H.prototype,"apiKey",void 0),o([n({type:J,json:{write:{writer:(e,t)=>{const s=e?e.clone().normalize():null,r=s!==void 0;t.location=r?s:null}}}})],H.prototype,"location",void 0),o([n({type:String,json:{write:!0}})],H.prototype,"locationType",void 0),o([n({type:pe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],H.prototype,"outSpatialReference",void 0),H=o([G("esri.rest.support.LocationToAddressParameters")],H),H.from=Ie(H);const dt=H;async function ys(e,t,s){t=dt.from(t);const r=Ce(e),i={...t.toJSON(),f:"json"},l=Le({...r.query,...i}),a=Fe(l,s),u=`${r.path}/reverseGeocode`;return $e(u,a).then(fs)}function fs({data:e}){if(!e)return;const{address:t,location:s}=e,r=(t==null?void 0:t.Match_addr)||"";return ut.fromJSON({address:r,attributes:t||{},location:s,score:100})}let Y=class extends re{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};o([n({type:Boolean,json:{write:!0}})],Y.prototype,"isCollection",void 0),o([n({type:String,json:{write:!0}})],Y.prototype,"magicKey",void 0),o([n({type:String,json:{write:!0}})],Y.prototype,"text",void 0),Y=o([G("esri.rest.support.SuggestionCandidate")],Y);const vs=Y;let B=class extends re{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};o([n(Ee)],B.prototype,"apiKey",void 0),o([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],B.prototype,"categories",void 0),o([n({type:String,json:{write:!0}})],B.prototype,"countryCode",void 0),o([n({type:J,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],B.prototype,"location",void 0),o([n({type:Number,json:{write:!0}})],B.prototype,"maxSuggestions",void 0),o([n({type:pe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],B.prototype,"outSpatialReference",void 0),o([n({type:Me,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(s)}}}})],B.prototype,"searchExtent",void 0),o([n({type:String,json:{write:!0}})],B.prototype,"text",void 0),B=o([G("esri.rest.support.SuggestLocationsParameters")],B),B.from=Ie(B);const ht=B;async function _s(e,t,s){const r=Ce(e),i={...(t=ht.from(t)).toJSON(),f:"json"},l=Le({...r.query,...i}),a=Fe(l,s),u=`${r.path}/suggest`;return $e(u,a).then(Ss)}function Ss(e){const{data:t}=e;if(!t)return[];const{suggestions:s}=t;return s?s.map(r=>new vs(r)):[]}const ws="Single Line Input",bs=3e5;function xs(e,t){return e.location?Ts(e,t):Cs(e,t)}function pt(e,t){var r;if(t.localSearchDisabled)return null;const s=e==null?void 0:e.scale;return typeof s=="number"&&s<=bs?(r=e==null?void 0:e.extent)==null?void 0:r.center:null}async function Ms(e,t){const{source:s,spatialReference:r,view:i,suggestTerm:l,maxSuggestions:a,sourceIndex:u}=e,c=new ht,{apiKey:d,url:h}=s,S=gt(s,i),f=t==null?void 0:t.signal;if(!h)return null;d&&(c.apiKey=d),s.categories&&(c.categories=s.categories),r&&(c.outSpatialReference=r);const v=pt(i,s);if(v&&(c.location=v),!l.trim())return null;const{prefix:y="",suffix:x=""}=s,$=`${y}${l}${x}`;return c.text=$,S&&(c.searchExtent=S),c.maxSuggestions=a,s.countryCode&&(c.countryCode=s.countryCode),_s(h,c,{signal:f}).then(k=>Fs(k,u))}function Is(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function $s(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Ke(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const Rs="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function Ts(e,t){const{source:s,spatialReference:r,location:i,sourceIndex:l,view:a}=e,{apiKey:u,url:c,zoomScale:d,defaultZoomScale:h}=s;if(c==null)return[];const S=a==null?void 0:a.scale,f=t==null?void 0:t.signal,v=new dt({location:i});u&&(v.apiKey=u),r&&(v.outSpatialReference=r);try{return mt([await ys(c,v,{signal:f})],{sourceIndex:l,scale:S,view:a,zoomScale:d,defaultZoomScale:h})}catch{return[]}}function gt(e,t){const{filter:s,withinViewEnabled:r}=e,i=t==null?void 0:t.scale,l=t==null?void 0:t.extent,a=s==null?void 0:s.geometry;return(a?Te(a,t??void 0,i):void 0)||(r&&l?l:void 0)}async function Cs(e,t){var M;const{source:s,suggestResult:r,spatialReference:i,view:l,maxResults:a,sourceIndex:u}=e,c=s==null?void 0:s.zoomScale,d=s==null?void 0:s.defaultZoomScale;if(!((M=r.text)==null?void 0:M.trim()))return null;const S=!r.key&&s.prefix?s.prefix:"",f=!r.key&&s.suffix?s.suffix:"",v=`${S}${r.text}${f}`,y=new ct,{apiKey:x,url:$}=s,k=l==null?void 0:l.scale,E=gt(s,l),P=t==null?void 0:t.signal;if(x&&(y.apiKey=x),!$)return null;s.categories&&(y.categories=s.categories),s.locationType&&(y.locationType=s.locationType),i&&(y.outSpatialReference=i);const R=pt(l,s);R&&(y.location=R),y.maxLocations=a,E&&(y.searchExtent=E),s.countryCode&&(y.countryCode=s.countryCode);const{key:N}=r,A=`${N}`;return N&&(y.magicKey=A),y.address={},y.address[s.singleLineFieldName||ws]=v,s.outFields&&(y.outFields=s.outFields),gs($,y,{signal:P}).then(K=>mt(K,{key:A,scale:k,sourceIndex:u,view:l,zoomScale:c,defaultZoomScale:d}))}function Ls(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function Fs(e,t){return e.map(s=>Ls(s,t))}function Es(e,t){const{key:s,scale:r,sourceIndex:i,view:l,zoomScale:a,defaultZoomScale:u}=t,{attributes:c,extent:d,location:h,address:S}=e,f=new fe({geometry:h,attributes:c}),v=d||h,y=v?Te(v,l??void 0,r??void 0):void 0,x=y?typeof a=="number"?Se(y,l??void 0,a):typeof u=="number"&&(v==null?void 0:v.type)==="point"?Se(y,l??void 0,u):y:null,$=h?`${h.x},${h.y}`:"",k=S||$,E=f.clone();return x!=null&&(E.geometry=Ze.fromExtent(x)),{extent:x,feature:f,target:E,key:s,name:k,sourceIndex:i}}function mt(e,t){return e.filter(Boolean).map(s=>Es(s,t))}var be;let F=be=class extends Ne{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,s)=>xs({source:this,...t},s),this.getSuggestions=(t,s)=>Ms({source:this,...t},s)}clone(){return new be({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?ne(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};o([n()],F.prototype,"apiKey",void 0),o([n()],F.prototype,"categories",void 0),o([n()],F.prototype,"countryCode",void 0),o([n({json:{write:!0}})],F.prototype,"defaultZoomScale",void 0),o([n()],F.prototype,"localSearchDisabled",void 0),o([n()],F.prototype,"locationType",void 0),o([n({json:{write:!0}})],F.prototype,"name",void 0),o([n({json:{write:!0}})],F.prototype,"placeholder",void 0),o([n()],F.prototype,"searchTemplate",void 0),o([n({json:{write:!0}})],F.prototype,"singleLineFieldName",void 0),o([n({json:{read:{source:"suggest"},write:{target:"suggest"}}})],F.prototype,"suggestionsEnabled",void 0),o([n({json:{write:!0}})],F.prototype,"url",void 0),o([n({json:{write:!0}})],F.prototype,"zoomScale",void 0),F=be=o([G("esri.widgets.Search.LocatorSearchSource")],F);const yt=F,ft=()=>D.getLogger("esri.widgets.support.geolocationUtils"),Ns={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function ks(){const e=!!xe("esri-geolocation");return e||ft().warn("geolocation-unsupported","Geolocation unsupported."),e}function As(){const e=window.isSecureContext;return e||ft().warn("insecure-context","Geolocation requires a secure origin."),e}function Ve(){return ks()&&As()}function js(e){return e??(e=Ns),new Promise((s,r)=>{setTimeout(()=>r(new C("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(s,r,e??void 0)})}function Bs(e,t){const{position:s,view:r}=e,i=Os(s),l=i==null?void 0:i.coords;if(!l)throw new C("geometry-service:no-coords","Geolocation has no coordinates");return Gs(Ds(l),r,t)}function Os(e){const t=e&&e.coords||{},s={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:s,timestamp:e.timestamp}}function Ds({longitude:e,latitude:t,altitude:s}){return new J({longitude:e,latitude:t,z:s||void 0,spatialReference:{wkid:4326}})}function Gs(e,t,s){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve($t(e)):Ps(s).then(i=>{if(!i)throw new C("geometry-service:missing-url","Geometry service URL is missing");const l=new Zt({geometries:[e],outSpatialReference:r});return qt(i,l,s).then(a=>a[0])})}function Ps(e){if(ve.geometryServiceUrl)return Promise.resolve(ve.geometryServiceUrl);const t=Re.getDefault();return t.load(e).catch(()=>{}).then(()=>{var s,r;return(r=(s=t.helperServices)==null?void 0:s.geometry)==null?void 0:r.url})}function L(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const Ks=()=>Ot("esri/widgets/Search/t9n/Search"),He="highlight",de=Ct.ofType({key:e=>e.layer?"layer":"locator",base:Ne,typeMap:{layer:X,locator:yt}}),ze=pe.WGS84,Vs="esri/images/search/search-symbol-32.png",Hs=/<[\s\S]*?>/g,ee=-1;let g=class extends Ut(Rt.EventedMixin(Tt)){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new de,this.defaultSymbols={point:new Et({url:Nt(Vs),size:24,width:24,height:24}),polyline:new Ft({color:[130,130,130,1],width:2}),polygon:new Lt({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Re.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new de,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await Ks();this.messages=t,this.defaultPopupTemplate=new Ue({title:t.searchResult,content:"{Match_addr}"})};e(),this.addHandles([U(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),ce),kt(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:ee}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return(e=this.messages)==null?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,r=typeof s=="function"?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,i=this._get("allSources")||new de;return i.removeAll(),i.addMany(r.filter(Boolean)),i}get locationEnabled(){return this._get("locationEnabled")||Ve()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=Ve();if(e&&!t){const s=new C("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});D.getLogger(this).error(s)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(t===ee)return s??"";const r=e.at(t);return(r==null?void 0:r.placeholder)??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),r=(async()=>{var i;try{await this.when();const l=await this._getResultsFromSources(s,t);if((i=t==null?void 0:t.signal)!=null&&i.aborted)return null;const a={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(a,l,s);const u=this._getFirstResult(a.results),c=s.location&&u?u.name:s.text,d=c==null?void 0:c.replace(Hs,"");return this._set("searchTerm",d),(s.key&&typeof s.sourceIndex=="number"||s.location)&&this._set("selectedSuggestion",s),this._set("results",a.results),this._set("resultCount",a.results.reduce((h,S)=>{var f;return h+(((f=S.results)==null?void 0:f.length)??0)},0)),this.emit("search-complete",a),await this._selectFirstResult(u),a}finally{this._clearSearching()}})();return this._searching=r,r}async searchNearby(e){if(!this.locationEnabled){const s=new C("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw D.getLogger(this).error(s),s}const t=(async()=>{try{const s=await js(),r=await Bs({position:s,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const j=new C("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw D.getLogger(this).error(j),j}const{view:t}=this,s=L(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=s!=null?this.allSources.at(s):null;if(!r){const j=new C("select:missing-source","Cannot select without a source.",{source:r});throw D.getLogger(this).error(j),j}const i=r instanceof X?this._getLayerSourcePopupTemplate(r):r.popupTemplate,l=r.resultSymbol||this._getDefaultSymbol(e),a=L(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,u=L(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,c=L(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,d=c?i||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const j=new C("select:missing-feature","Cannot select without a feature.",{feature:h});throw D.getLogger(this).error(j),j}const{attributes:S,geometry:f,layer:v,sourceLayer:y}=h,x=f?Ge(f):null,$={layerViewQuery:this._getLayerView(h),elevationQuery:t&&x!=null?Wt(x,t):Promise.resolve(x)},k=await ae($),E=k.layerViewQuery.value,P=k.elevationQuery.value;l instanceof At&&(l.text=e.name);const R=t&&u?e.target||e.extent:null;await(R!=null?this._goToSearchResult(R):Promise.resolve());const A=E?h:new fe({geometry:f,symbol:l,attributes:S,layer:v,sourceLayer:y,popupTemplate:d}),M=t==null?void 0:t.popup,K=M&&c&&A.getEffectivePopupTemplate(M.defaultPopupTemplateEnabled);return K&&await t.openPopup({features:[A],location:P}),E&&jt(E)&&!K&&this._highlightFeature({graphic:A,layerView:E}),!E&&a&&t&&t.graphics.push(A),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",A),this.emit("select-result",{result:e,source:r,sourceIndex:s}),e}async suggest(e,t,s){const r=e||this.searchTerm;this.emit("suggest-start",{searchTerm:r}),await this._suggestTimer(t,s);const i=await this._suggestImmediate(r,s);return this._set("suggestions",i==null?void 0:i.results),this._set("suggestionCount",(i==null?void 0:i.results.reduce((l,a)=>{var u;return l+(((u=a.results)==null?void 0:u.length)??0)},0))??null),this.emit("suggest-complete",i),i}async when(){await Oe(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=ae([e==null?void 0:e.load(),t==null?void 0:t.when()]);if(this.destroyed||(await s,s!==this._updatingPromise))return}await Oe(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var t,s;const e=(s=(t=this.portal)==null?void 0:t.helperServices)==null?void 0:s.geocode;return e?e.map(r=>{var u;if(r.placefinding===!1)return;const i=ve.apiKey&&Ke(r.url)?{url:Rs}:null,l=yt.fromJSON({...r,...i}),a=l.url;if(Ke(a)||$s(a)||Is(a)){const c=l.outFields??["Addr_type","Match_addr","StAddr","City"],d=(l.placeholder||((u=this.messages)==null?void 0:u.placeholder))??"",h=typeof l.defaultZoomScale=="number"?l.defaultZoomScale:2500;l.singleLineFieldName="SingleLine",l.outFields=c,l.placeholder=d,l.defaultZoomScale=h}return l.singleLineFieldName?l:void 0}).filter(me):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e==null?void 0:e.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(i=>{const l=s.findLayerById(i.id);if(!l)return;const a=this._getLayerJSON(i),u=X.fromJSON(a);return u.placeholder=t,this._getLayer(l,a).then(c=>{u.layer=c}),u}).filter(me).toArray()}_getTableSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(i=>{if(!i.id)return;const l=s.findTableById(i.id);if(!l)return;const a=this._getLayerJSON(i),u=X.fromJSON(a);return u.placeholder=t,this._getLayer(l,a).then(c=>{u.layer=c}),u}).filter(me).toArray()}_convertApplicationProperties(){var a,u,c;const e=(a=this.view)==null?void 0:a.map,t=(c=(u=e==null?void 0:e.applicationProperties)==null?void 0:u.viewing)==null?void 0:c.search;if(!t)return[];const{enabled:s,hintText:r,layers:i,tables:l}=t;return s?[...this._getLayerSources(i,r),...this._getTableSources(l,r)]:[]}async _getSubLayer(e,t){var i;if(await e.load(),!e.allSublayers)throw new Error;const s=e.allSublayers.find(l=>l.id===t.subLayer);if(!s)throw new Error;const r=await((i=s.createFeatureLayer)==null?void 0:i.call(s));if(!r)throw new Error;return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find(r=>r.id===t.subLayer);if((s==null?void 0:s.type)!=="building-component")throw new Error;if(await s.load(),s.associatedLayer==null)throw new Error;return await s.associatedLayer.load(),s}async _getLayer(e,t){if(e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature")return e;if(e.type==="map-image")try{return await this._getSubLayer(e,t)}catch{const r=new C("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return D.getLogger(this).error(r),null}return e.type==="building-scene"?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var i;const e=(i=this.view)==null?void 0:i.popup,{resultGraphic:t}=this;if(!e||!t)return;const s="selectedFeature"in e,r=s?e.selectedFeature:null;s&&r&&r===t&&e.close()}_suggestTimer(e,t){const s=e??this.suggestionDelay;return Bt(s,null,t==null?void 0:t.signal)}_createLocationForSearch(e){return e instanceof fe&&e.geometry?Ge(e.geometry):e instanceof J?e:Array.isArray(e)&&e.length===2?new J({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&L(e,"key")&&L(e,"text")&&L(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:i}=this,l=!e&&r&&i,a=l&&r.key===i.key&&r.sourceIndex===i.sourceIndex,u=l&&r.location;return a||u?r:{location:t,text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){return ye(e,({results:t})=>t==null?void 0:t[0])??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){var i;await this.when();const s=await this._getSuggestionsFromSources(e,t);if((i=t==null?void 0:t.signal)!=null&&i.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r}_formatSourceResponse(e,t,s){const r=(t==null?void 0:t.value)||[],i=t==null?void 0:t.error,l=this.allSources.at(s);if(i){const a={sourceIndex:s,source:l,error:i};e.errors.push(a),D.getLogger(this).error(i),e.numErrors++}else{const a={sourceIndex:s,source:l,results:r};e.results.push(a),e.numResults+=r.length}}_formatResponse(e,t,s){if(t)if(e.activeSourceIndex===ee){const r=s&&L(s,"sourceIndex")&&s.sourceIndex!==-1?s.sourceIndex:void 0;t.forEach((i,l)=>{const a=r!==void 0?r:l;this._formatSourceResponse(e,i,a)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:s}=this,r=!e.location&&L(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,i=[];if(!s.length){const l=new C("search:no-sources-defined","At least one source is required.",{allSources:s});throw D.getLogger(this).error(l),l}return r===ee?s.forEach((l,a)=>{i.push(this._getResultsFromSource(e,a,t))}):i.push(this._getResultsFromSource(e,r,t)),ae(i)}async _getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:r}=this,i=[];if(!s.length){const l=new C("suggest:no-sources-defined","At least one source is required.",{allSources:s});throw D.getLogger(this).error(l),l}return r===ee?s.forEach((l,a)=>{i.push(this._getSuggestionsFromSource(e,a,t))}):i.push(this._getSuggestionsFromSource(e,r,t)),ae(i)}async _getResultsFromSource(e,t,s){var d,h;const r=t!=null?this.allSources.at(t):null;if(!r)return null;const{location:i=null}=e,l=((d=this.view)==null?void 0:d.spatialReference)||ze,a=L(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof X&&L(r,"exactMatch"))&&r.exactMatch,{view:c}=this;return(h=r.getResults)==null?void 0:h.call(r,{view:c,sourceIndex:t,location:i,suggestResult:e,spatialReference:l,exactMatch:u,maxResults:a},s)}async _getSuggestionsFromSource(e,t,s){var u,c;const r=this.allSources.at(t);if(!r)return null;e??(e="");const i=L(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,l=e==null?void 0:e.length,a=L(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(i&&e.trim()&&l>=a){const d=((u=this.view)==null?void 0:u.spatialReference)||ze,h=L(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:S}=this,f=!!(r instanceof X&&L(r,"exactMatch"))&&r.exactMatch;return(c=r.getSuggestions)==null?void 0:c.call(r,{view:S,sourceIndex:t,suggestTerm:e,spatialReference:d,maxSuggestions:h,exactMatch:f},s)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return L(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return ye(this.results??[],({results:t,sourceIndex:s})=>(t==null?void 0:t.includes(e))?s:null)??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const s={target:{target:e},options:{signal:t.signal}};e||(s.options.animate=!1),await this.callGoTo(s),this._gotoController=null}_getDefaultSymbol(e){var r;const{defaultSymbols:t}=this,s=(r=e.feature)==null?void 0:r.geometry;if(s==null)return null;switch(s.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(He)}async _getLayerView(e){var r,i;const{view:t}=this;if(!e||!t||((r=e.layer)==null?void 0:r.type)==="building-component"||((i=e.layer)==null?void 0:i.type)==="subtype-sublayer")return null;const{layer:s}=e;return s?(await t.when(),t.whenLayerView(s)):null}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:r,layer:i}=t,{objectIdField:l}=i,a=(l&&(r==null?void 0:r[l]))??null,u=s.highlight(a??t);this.addHandles(u,He)}_setResultFloor(e){var i,l,a;const{view:t}=this,s=(i=e.feature)==null?void 0:i.attributes,r=(l=e.feature)==null?void 0:l.sourceLayer;if(r&&"floorInfo"in r&&((a=r==null?void 0:r.floorInfo)!=null&&a.floorField)&&s){const u=s[r.floorInfo.floorField];t==null||t.emit("select-result-floor",u)}}};g.ALL_INDEX=ee,o([n()],g.prototype,"_searching",void 0),o([n()],g.prototype,"_updatingPromise",void 0),o([n({readOnly:!0,value:null})],g.prototype,"activeSource",null),o([n()],g.prototype,"activeSourceIndex",null),o([n()],g.prototype,"allPlaceholder",null),o([n({readOnly:!0})],g.prototype,"allSources",null),o([n()],g.prototype,"autoNavigate",void 0),o([n()],g.prototype,"autoSelect",void 0),o([n()],g.prototype,"defaultPopupTemplate",void 0),o([n({readOnly:!0})],g.prototype,"defaultSources",void 0),o([n()],g.prototype,"defaultSymbols",void 0),o([n()],g.prototype,"includeDefaultSources",void 0),o([n()],g.prototype,"locationEnabled",null),o([n()],g.prototype,"maxInputLength",void 0),o([n()],g.prototype,"maxResults",void 0),o([n()],g.prototype,"maxSuggestions",void 0),o([n()],g.prototype,"messages",void 0),o([n()],g.prototype,"minSuggestCharacters",void 0),o([n({readOnly:!0})],g.prototype,"placeholder",null),o([n()],g.prototype,"popupEnabled",void 0),o([n({type:Ue})],g.prototype,"popupTemplate",void 0),o([n({type:Re})],g.prototype,"portal",void 0),o([n()],g.prototype,"resultCount",void 0),o([n()],g.prototype,"resultGraphicEnabled",void 0),o([n({readOnly:!0})],g.prototype,"resultGraphic",void 0),o([n({readOnly:!0})],g.prototype,"results",void 0),o([n({readOnly:!0})],g.prototype,"selectedSuggestion",void 0),o([n()],g.prototype,"searchAllEnabled",void 0),o([n({readOnly:!0})],g.prototype,"selectedResult",void 0),o([n()],g.prototype,"searchTerm",null),o([n({type:de})],g.prototype,"sources",void 0),o([n({readOnly:!0})],g.prototype,"state",null),o([n()],g.prototype,"suggestionDelay",void 0),o([n()],g.prototype,"suggestionCount",void 0),o([n({readOnly:!0})],g.prototype,"suggestions",void 0),o([n()],g.prototype,"suggestionsEnabled",void 0),o([n({readOnly:!0})],g.prototype,"updating",null),o([n()],g.prototype,"view",void 0),o([n()],g.prototype,"clear",null),g=o([G("esri.widgets.Search.SearchViewModel")],g);const te=g;let Z=class extends Je{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const e={[q.showMoreResults]:this.showMoreResultsOpen};return p("div",{class:this.classes(q.base,b.widget)},p("div",{class:this.classes(q.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return p("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){var s;const e=(s=this.viewModel)==null?void 0:s.selectedResult,t=(e==null?void 0:e.name)||"";return p("div",{class:q.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){const{viewModel:e}=this;if(!e)return[];const t=e.results;if((e.resultCount??0)<2)return null;const s=t==null?void 0:t.map(r=>this._renderMoreResultsList(r));return p("div",{class:q.moreResultsList,key:"esri-search-renderer__more-results-container"},s)}_renderMoreResultsButton(){const{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:p("div",{class:q.moreResultsItem,key:"esri-search-renderer__more-results-button"},p("a",{bind:this,class:b.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return p("div",{class:q.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){var h,S,f;const{results:t}=e,s=(t==null?void 0:t.length)??0,r=s>0,i=(h=this.viewModel)==null?void 0:h.selectedResult,l=s===1&&t[0]===i,a=this._getSourceName(e.source,e.sourceIndex),u=(((f=(S=this.viewModel)==null?void 0:S.results)==null?void 0:f.length)??0)>1&&!l?this._renderMoreResultsHeader(a,e.sourceIndex):null,c=r&&t.map((v,y)=>this._renderMoreResultsListItem(v,y)),d=r&&!l?p("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},c):null;return r?p("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},u,d):null}_renderMoreResultsListItem(e,t){var r;const s=(r=this.viewModel)==null?void 0:r.selectedResult;return e!==s?p("li",{key:`esri-search-result-renderer__list-item-${t}`},p("a",{bind:this,class:b.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){var s,r;e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=(r=(s=this.viewModel)==null?void 0:s.view)==null?void 0:r.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){var s;e.preventDefault();const t=e.currentTarget["data-result"];(s=this.viewModel)==null||s.select(t)}_getSourceName(e,t){return t===te.ALL_INDEX?this.messages.all:e.name}};o([n(),_e("esri/widgets/Search/t9n/Search")],Z.prototype,"messages",void 0),o([n()],Z.prototype,"showMoreResultsOpen",void 0),o([n()],Z.prototype,"viewModel",void 0),o([Pe()],Z.prototype,"_showMoreResultsClick",null),o([Pe()],Z.prototype,"_selectResultClick",null),Z=o([G("esri.widgets.Search.SearchResultRenderer")],Z);const zs=Z,Ws=/<[a-z/][\s\S]*>/i,Zs=(e,t)=>{const s=Ht(t).split(/\s/),r=new RegExp(`(${s.join("|")})`,"gi");return e.replace(r,i=>`<strong>${i}</strong>`)};let m=class extends Je{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._focusAbortController=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new zs,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new te,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=s=>{var i;const r=s.relatedTarget;r&&((i=this._container)!=null&&i.contains(r))||this._clearActiveMenu()},this._renderSearchResultsContent=()=>this._searchResultRenderer,this.addHandles([U(()=>this.searchTerm,s=>{var r,i;(s&&this.activeMenu==="warning"||!s&&!((i=(r=this.viewModel)==null?void 0:r.selectedSuggestion)!=null&&i.location))&&this._clearActiveMenu()}),Dt(()=>{var s;return(s=this.viewModel)==null?void 0:s.allSources},"change",()=>this._watchSourceChanges()),U(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),ce),U(()=>this.viewModel,s=>this._searchResultRenderer.viewModel=s,ce),U(()=>this.viewModel.results,()=>this._searchResultRenderer.showMoreResultsOpen=!1),U(()=>{var s;return(s=this.viewModel)==null?void 0:s.defaultPopupTemplate},s=>{s&&(s.content=this._renderSearchResultsContent)},ce)])}destroy(){var e;this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=Gt(this._searchResultRenderer),(e=this._focusAbortController)==null||e.abort()}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){var e;return(e=this.viewModel)==null?void 0:e.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){var e;return(e=this.viewModel)==null?void 0:e.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._handleFocus(),this.emit("search-focus")}async _handleFocus(){var t,s;(t=this._focusAbortController)==null||t.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await Pt(Kt(e)),(s=this._inputNode)==null||s.focus()}blur(){var e;(e=this._inputNode)==null||e.blur(),this.emit("search-blur")}async search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;this._searchController=t;try{const r=await this.viewModel.search(e,{signal:s});return this._searchController!==t?void 0:(this.activeMenu=r!=null&&r.numResults?"none":"warning",this._searchController=null,r)}catch{return this._searchController!==t?void 0:(this._clearActiveMenu(),void(this._searchController=null))}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;this._suggestController=t;try{const r=await this.viewModel.suggest(e,null,{signal:s});return this._suggestController!==t?void 0:(this._suggestController=null,r!=null&&r.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),r)}catch{return this._suggestController!==t||(this._suggestController=null),null}}render(){const{state:e}=this.viewModel,t={[b.disabled]:e==="disabled",[b.widgetDisabled]:this.disabled};return p("div",{class:this.classes(_.base,b.widget,t)},e==="loading"?this._renderLoader():this._renderContainer())}_renderSubmitButton(){const{messages:e,disabled:t}=this;return p("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(_.submitButton,b.widgetButton),disabled:t,key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},p("span",{"aria-hidden":"true",class:z.search}))}_renderWarningMenu(){return p("div",{class:this.classes(b.menu,_.warningMenu),key:"esri-search__error-menu"},p("div",{class:_.warningMenuBody},this._renderWarning()))}_renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:r,disabled:i}=this,{activeSourceIndex:l,allSources:a}=this.viewModel;return a.length>1?p("button",{afterCreate:ue,"aria-controls":s,"aria-expanded":(t==="source").toString(),"aria-haspopup":"true","aria-label":e.searchIn,bind:this,class:this.classes(_.sourcesButton,b.widgetButton),"data-node-ref":"_sourceMenuButtonNode",disabled:i,id:r,key:"esri-search__source-menu-button",onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,title:e.searchIn,type:"button"},p("span",{"aria-hidden":"true",class:this.classes(z.downArrow,_.sourcesButtonDown)}),p("span",{"aria-hidden":"true",class:this.classes(z.upArrow,_.sourcesButtonUp)}),p("span",{class:_.sourceName},this._getSourceName(l))):null}_renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:r,sourceMenuId:i,sourceMenuButtonId:l}=this,a=r==="source"&&s>-1?this._buildId("source-item",s):null;return e.length>1?p("ul",{afterCreate:ue,"aria-activedescendant":a,"aria-labelledby":l,bind:this,class:b.menuList,"data-node-ref":"_sourceListNode",id:i,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,role:"menu",tabIndex:-1},t?this._renderSource(te.ALL_INDEX):null,e.map((u,c)=>this._renderSource(c)).toArray()):null}_renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?p("div",{class:this.classes(b.menu,_.sourcesMenu),key:"esri-search__source-menu"},this._renderSourcesList()):null}_renderLoader(){const{messages:e,messagesCommon:t,disabled:s}=this;return p("div",{class:b.loader,key:"base-loader",tabIndex:s?-1:void 0},p("span",{"aria-hidden":"true",class:b.loaderAnimation}),p("span",{class:z.fontFallbackText},e.searchButtonTitle),p("span",{class:b.loaderText},t.loading))}_renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this,r={[_.hasMultipleSources]:e.length>1,[_.isLoading]:t==="loading",[_.isSearching]:t==="searching",[_.showWarning]:s==="warning",[_.showSources]:s==="source",[_.showSuggestions]:s==="suggestion"};return p("div",{afterCreate:i=>{this._container=i,i.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:i=>{i.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,_.container),key:"base-container",tabIndex:-1},this._renderSourceMenuButton(),this._renderSourcesMenu(),this._renderInputContainer(),this._renderSubmitButton(),this._renderWarningMenu())}_renderClearButton(){return this.searchTerm?p("button",{bind:this,class:this.classes(_.clearButton,b.widgetButton),disabled:this.disabled,key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},p("span",{"aria-hidden":"true",class:z.close})):null}_renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,r=t&&!s,i=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return r?p("ul",{class:this.classes(b.menuList,_.suggestionList,_.suggestionListCurrentLocation),key:"esri-search__suggestion-list-current-location",role:"group"},p("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),bind:this,class:this.classes(b.menuItem,i?b.menuItemFocus:null),"data-current-location-item":!0,id:this._buildId("suggestion-item",0),onclick:this._handleUseCurrentLocationClick,role:"option"},p("span",{"aria-hidden":"true",class:z.locateCircled})," ",e.useCurrentLocation)):null}_renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:r,suggestionsMenuId:i,inputId:l,_activeMenuItemIndex:a,disabled:u}=this,{maxInputLength:c,placeholder:d,searchTerm:h,suggestionCount:S}=this.viewModel,f=!(!(t&&!s)&&!S),v=e==="suggestion"&&a>-1?this._buildId("suggestion-item",a):null;return p("input",{afterCreate:ue,"aria-activedescendant":v,"aria-autocomplete":"list","aria-controls":f?i:null,"aria-expanded":(f&&e==="suggestion").toString(),"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,autocomplete:"off",bind:this,class:this.classes(b.input,_.input),"data-node-ref":"_inputNode",disabled:u,id:l,maxlength:c,onblur:this.blur,onclick:this._openSuggestionMenu,onfocus:this.focus,oninput:this._handleInputPaste,onkeyup:this._handleInputKeyup,onpaste:this._handleInputPaste,placeholder:d,role:"combobox",title:h?"":d,type:"text",value:h})}_renderForm(){return p("form",{bind:this,class:_.form,disabled:this.disabled,key:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this._renderInput())}_renderSuggestList(e){const{sourceIndex:t}=e,{results:s}=e;return(s==null?void 0:s.length)?p("ul",{class:this.classes(b.menuList,_.suggestionList),key:`esri-search__suggestion-list-${t}`,role:"group"},s==null?void 0:s.map(i=>this._renderSuggestion(i,this._menuItemCount++))):null}_renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map(t=>[this._renderSuggestionHeader(t),this._renderSuggestList(t)]):[]}_renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:r}=this,{suggestionCount:i}=this.viewModel,l=t&&!e||i;return this._menuItemCount=0,l?p("div",{afterCreate:ue,"aria-labelledby":r,bind:this,class:this.classes(b.menu,_.suggestionsMenu),"data-node-ref":"_suggestionListNode",id:s,key:"esri-search__suggestions-menu",role:"listbox"},this._renderLocationGroup(),this._renderSuggestionsGroup()):null}_renderInputContainer(){return p("div",{class:_.inputContainer,key:"esri-search__input-container"},this._renderForm(),this._renderSuggestionsMenu(),this._renderClearButton())}_renderSuggestionHeader(e){var a;const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:r}=e,i=(a=e.results)==null?void 0:a.length,l=t.length>1&&s===te.ALL_INDEX;return i&&l?p("div",{class:b.menuHeader,key:`esri-search__suggestion-header-${r}`},this._getSourceName(r)):null}_renderSuggestion(e,t){const{_activeMenuItemIndex:s,viewModel:{searchTerm:r}}=this;if(!r)return;const i=this.activeMenu==="suggestion"&&s===t;return p("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),bind:this,class:this.classes(b.menuItem,i?b.menuItemFocus:null),"data-suggestion":e,id:this._buildId("suggestion-item",t),innerHTML:this._getSuggestResultHTML(e.text,r),key:`esri-search__suggestion_${t}`,onclick:this._handleSuggestionClick,role:"option"})}_renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,r={[b.menuItemActive]:e===t,[b.menuItemFocus]:this.activeMenu==="source"&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},i=s?e+1:e;return p("li",{"aria-checked":(e===t).toString(),bind:this,class:this.classes(_.source,b.menuItem,r),"data-source-index":e,id:this._buildId("source-item",i),key:`esri-search__source-${e}`,onclick:this._handleSourceClick,role:"menuitemradio"},this._getSourceName(e))}_renderNoResultsWarning(e){const{messages:t}=this,s=e?qe(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return p("div",{key:"esri-search__no_results"},p("div",{class:_.warningMenuHeader},t.noResults),p("div",{class:_.warningMenuText},s))}_renderEmptySearchWarning(){const{messages:e}=this;return p("div",{key:"esri-search__empty-search"},p("span",{"aria-hidden":"true",class:z.noticeTriangle}),p("span",{class:_.noValueText},e.emptyValue))}_renderLocateWarning(){const{messages:e}=this;return p("div",{key:"esri-search__locate-error"},p("span",{"aria-hidden":"true",class:z.noticeTriangle}),p("span",{class:_.noValueText},e.locateError))}_renderWarning(){var r;const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:s}=this;return t?this._renderLocateWarning():(r=s.selectedSuggestion)!=null&&r.location||e?this._renderNoResultsWarning(e):this._renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){const{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach(s=>this.addHandles(U(()=>s.name,()=>this.scheduleRender()),t))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){var t;const e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&((t=this._sourceListNode)==null||t.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=We(e.currentTarget);t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,(async()=>{try{const s=await this.viewModel.searchNearby({signal:t});this.activeMenu=s!=null&&s.numResults?"none":"warning"}catch{this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var s;if(!e)return;const t=qs(e);t!=null&&(this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),(s=this._sourceMenuButtonNode)==null||s.focus())}_cancelSuggest(){this._suggestController=De(this._suggestController)}_cancelSearch(){this._searchController=De(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){var i;const{key:t}=e;if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());const s=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=(i=this._suggestionListNode)==null?void 0:i.getElementsByTagName("li");if(r!=null&&r.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),s)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const l=r[this._activeMenuItemIndex];if(t==="Enter"&&l){const a=We(l);return void(a?(this._focus(),this.search(a)):Us(l)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,s){const r=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&s&&Js(t[this._activeMenuItemIndex],s)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){var s;const{key:t}=e;if(Vt(t)){e.preventDefault();const r=(s=this._sourceListNode)==null?void 0:s.getElementsByTagName("li"),i=r==null?void 0:r[this._activeMenuItemIndex];this._setSourceFromMenuItem(i)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){var i,l,a;const{key:t}=e,s=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(s&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void((i=this._sourceMenuButtonNode)==null?void 0:i.focus());const r=(l=this._sourceListNode)==null?void 0:l.getElementsByTagName("li");return r&&r.length!==0&&s?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,(a=this._sourceListNode)==null?void 0:a.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:r}=s,i=r.at(e);return e===te.ALL_INDEX?t.all:i&&i.name||t.untitledSource}_getSuggestResultHTML(e,t){return e?Ws.test(e)?e:Zs(e,t):this.messages.untitledResult}};function We(e){return e==null?void 0:e["data-suggestion"]}function qs(e){return e==null?void 0:e["data-source-index"]}function Us(e){return!!(e!=null&&e["data-current-location-item"])}function Js(e,t){const s=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=s.top+s.height,l=r.top+r.height,a=s.top,u=r.top;(i>l||a<u)&&e.scrollIntoView({block:"end"})}o([n()],m.prototype,"_activeMenuItemIndex",void 0),o([n()],m.prototype,"displayedSearchTerm",null),o([n({readOnly:!0})],m.prototype,"inputId",null),o([n({readOnly:!0})],m.prototype,"suggestionsMenuId",null),o([n({readOnly:!0})],m.prototype,"sourceMenuId",null),o([n({readOnly:!0})],m.prototype,"sourceMenuButtonId",null),o([n()],m.prototype,"activeMenu",void 0),o([n({readOnly:!0})],m.prototype,"activeSource",null),o([n()],m.prototype,"activeSourceIndex",null),o([n()],m.prototype,"allPlaceholder",null),o([n({readOnly:!0})],m.prototype,"allSources",null),o([n()],m.prototype,"autoNavigate",null),o([n()],m.prototype,"autoSelect",null),o([n({readOnly:!0})],m.prototype,"defaultSources",null),o([n()],m.prototype,"disabled",void 0),o([n()],m.prototype,"goToOverride",null),o([n()],m.prototype,"icon",null),o([n()],m.prototype,"includeDefaultSources",null),o([n()],m.prototype,"label",null),o([n()],m.prototype,"locationEnabled",null),o([n()],m.prototype,"maxResults",null),o([n()],m.prototype,"maxSuggestions",null),o([n(),_e("esri/widgets/Search/t9n/Search")],m.prototype,"messages",void 0),o([n(),_e("esri/t9n/common")],m.prototype,"messagesCommon",void 0),o([n()],m.prototype,"minSuggestCharacters",null),o([n()],m.prototype,"popupEnabled",null),o([n()],m.prototype,"popupTemplate",null),o([n()],m.prototype,"portal",null),o([n()],m.prototype,"resultGraphic",null),o([n()],m.prototype,"resultGraphicEnabled",null),o([n({readOnly:!0})],m.prototype,"results",null),o([n()],m.prototype,"searchAllEnabled",null),o([n()],m.prototype,"searchTerm",null),o([n({readOnly:!0})],m.prototype,"selectedResult",null),o([n()],m.prototype,"sources",null),o([n({readOnly:!0})],m.prototype,"suggestions",null),o([n()],m.prototype,"suggestionsEnabled",null),o([n()],m.prototype,"view",null),o([zt(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),n({type:te})],m.prototype,"viewModel",void 0),m=o([G("esri.widgets.Search")],m);const hr=m;export{hr as default};
