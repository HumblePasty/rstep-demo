const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-B68O6Zxk.js","./index-CgLC99fU.js","./index-C6GyxWqK.css","./layersCreator-BjSBhv8h.js","./portalLayers-BRLGMeWH.js","./associatedFeatureServiceUtils-D_jnvE26.js","./fetchService-CXnfF5IE.js"])))=>i.map(i=>d[i]);
import{r as o,o as a,p as h,nZ as M,cI as H,a3 as b,bd as I,n$ as p,E as D,z as J,t as m,b3 as Z,bc as z,ii as G,pC as k,w as Q,cH as U,iO as W,ah as K,a_ as X,H as N,aS as j,hn as Y,r5 as ee,b as te,ex as re,_ as L,K as _,$ as x,r6 as oe,eA as R,r7 as se,aO as O,aT as ae,r8 as ie,r9 as ne,bV as le,bS as ue,hp as q,ra as pe}from"./index-CgLC99fU.js";import{F as ye}from"./Basemap-Dmz7cfxt.js";import{e as de}from"./editableLayers-BEzarSAf.js";import{y as ce,m as he,b as me}from"./basemapUtils-Dxc4EhWK.js";let c=class extends M{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"row",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"column",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"rows",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"columns",void 0),c=o([h("esri.CameraLayout")],c);const V=c;let l=class extends H(b){constructor(...e){super(...e),this.position=new I([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new V}normalizeCtorArgs(e,t,s,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const i={position:e};return t!=null&&(i.heading=t),s!=null&&(i.tilt=s),r!=null&&(i.fov=r),i}return e}writePosition(e,t,s,r){const i=e.clone();i.x=p(e.x||0),i.y=p(e.y||0),i.z=e.hasZ?p(e.z||0):e.z,t[s]=i.write({},r)}readPosition(e,t){const s=new I;return s.read(e,t),s.x=p(s.x||0),s.y=p(s.y||0),s.z=s.hasZ?p(s.z||0):s.z,s}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};o([a({type:I,json:{write:{isRequired:!0}}})],l.prototype,"position",void 0),o([D("position")],l.prototype,"writePosition",null),o([J("position")],l.prototype,"readPosition",null),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>Z.normalize(p(e)))],l.prototype,"heading",void 0),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>z(p(e),-180,180))],l.prototype,"tilt",void 0),o([a({type:Number,nonNullable:!0,json:{default:55,write:!0}}),m(e=>z(p(e,55),1,170))],l.prototype,"fov",void 0),o([a({type:V,nonNullable:!0,json:{read:!1,write:!1}})],l.prototype,"layout",void 0),l=o([h("esri.Camera")],l);const ve=l;var S;let d=S=class extends b{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new S({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],d.prototype,"rotation",void 0),o([m("rotation")],d.prototype,"castRotation",null),o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],d.prototype,"scale",void 0),o([a({types:k,json:{read:G,write:!0,origins:{"web-scene":{read:G,write:{overridePolicy:C}}}}})],d.prototype,"targetGeometry",void 0),o([a({type:ve,json:{write:!0}})],d.prototype,"camera",void 0),d=S=o([h("esri.Viewpoint")],d);const Ce=d;function C(){return{enabled:!this.camera}}var T;let w=T=class extends b{constructor(e){super(e),this.type="none"}clone(){return new T({type:this.type})}};o([Q({none:"none",stayAbove:"stay-above"})],w.prototype,"type",void 0),w=T=o([h("esri.ground.NavigationConstraint")],w);var A;let u=A=class extends U(W){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new K;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&N.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{X(e)||N.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)j(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Y(e,this._get("layers")))}writeLayers(e,t,s,r){const i=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(y=>{if("write"in y){const v={};ee(y)().write(v,r)&&i.push(v)}else r!=null&&r.messages&&r.messages.push(new te("layer:unsupported",`Layers (${y.title}, ${y.id}) of type '${y.declaredClass}' cannot be persisted in the ground`,{layer:y}))})),t.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return re(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-B68O6Zxk.js"),__vite__mapDeps([0,1,2]),import.meta.url);_(t);const r=new s,i=this.layers.filter(F).toArray();return r.queryAll(i,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-B68O6Zxk.js"),__vite__mapDeps([0,1,2]),import.meta.url);_(t);const r=new s,i=this.layers.filter(F).toArray();return r.createSamplerAll(i,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:x(this.surfaceColor),navigationConstraint:x(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new A({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const r=(t==null?void 0:t.origin)||"web-scene",i=(t==null?void 0:t.portal)||null,y=(t==null?void 0:t.url)||null,{populateOperationalLayers:v}=await L(async()=>{const{populateOperationalLayers:$}=await import("./layersCreator-BjSBhv8h.js");return{populateOperationalLayers:$}},__vite__mapDeps([3,1,2,4,5,6]),import.meta.url);_(s);const P=[];if(e.layers&&Array.isArray(e.layers)){const $={context:{origin:r,url:y,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};P.push(v(this.layers,e.layers,$))}await Promise.allSettled(P)}};function we(e){return e&&"createElevationSampler"in e}function F(e){return e.type==="elevation"||we(e)}o([a({json:{read:!1}})],u.prototype,"layers",null),o([D("layers")],u.prototype,"writeLayers",null),o([a({readOnly:!0})],u.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:R,read:{reader:oe,source:"transparency"},write:{writer:(e,t)=>{t.transparency=se(e)},target:"transparency"}}})],u.prototype,"opacity",void 0),o([a({type:O,json:{type:[R],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],u.prototype,"surfaceColor",void 0),o([a({type:w,json:{write:!0}})],u.prototype,"navigationConstraint",void 0),u=A=o([h("esri.Ground")],u);const g=u,B={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function fe(e){let t=null;if(typeof e=="string")if(e in B){const s=B[e];t=new g({resourceInfo:{data:{layers:[s]}}})}else N.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ae(g,e);return t}let n=class extends ie(ne(le.EventedMixin(ue))){constructor(e){super(e),this.allLayers=new q({getCollections:()=>{var t,s,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(s=this.ground)==null?void 0:s.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=pe(this),this.basemap=null,this.editableLayers=new q({getCollections:()=>[this.allLayers],itemFilterFunction:de}),this.ground=new g,this._basemapCache=ce()}destroy(){he(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=j(this.basemap),j(this.ground),this._set("ground",null)}castBasemap(e){return me(e,this._basemapCache)}castGround(e){return fe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};o([a({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),o([a({readOnly:!0})],n.prototype,"allTables",void 0),o([a({type:ye,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),o([m("basemap")],n.prototype,"castBasemap",null),o([a({readOnly:!0})],n.prototype,"editableLayers",void 0),o([a({type:g,nonNullable:!0})],n.prototype,"ground",void 0),o([m("ground")],n.prototype,"castGround",null),o([a()],n.prototype,"undoRedo",void 0),n=o([h("esri.Map")],n);const Ie=n;var E;let f=E=class extends b{constructor(e){super(e),this.color=new O([0,0,0,1])}clone(){return new E(x({color:this.color}))}};o([a({type:O,json:{write:!0}})],f.prototype,"color",void 0),f=E=o([h("esri.webmap.background.ColorBackground")],f);const Ne=f;export{Ie as L,Ne as a,Ce as m};
