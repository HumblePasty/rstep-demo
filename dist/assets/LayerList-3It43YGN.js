const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-action-group-UjGF3OpY.js","./index-iVlkrMet.js","./index-C6GyxWqK.css","./calcite-action-menu-Bv1n3YH-.js","./calcite-action-C3p1LNKY.js","./calcite-icon-uZdnCpqZ.js","./calcite-list-item-CCOyX-sU.js","./utils3-xH_9tLW3.js","./resources4-F8vB_VGv.js","./handle-BP33bdj7.js","./calcite-list-Dp5vfzDW.js","./filter-DFNjemHN.js","./input2-BhfhZKGN.js","./Validation-CuhM_4_G.js","./input-j1u1wOBY.js","./input-message-BOY1F8ba.js","./progress-aXRgJX-G.js","./calcite-button-qjzyXLWO.js","./calcite-flow-CLSvNCgC.js","./calcite-flow-item-BzjAbMSF.js","./CatalogLayerList-C7OfU76J.js","./ReactiveMap-BBqjIwDS.js","./catalogUtils-J1X8hQ-e.js","./actionUtils-D65qOIxf.js","./TableList-Dh1ZwWX6.js"])))=>i.map(i=>d[i]);
import{i8 as j,i9 as H,_,bG as c,n6 as K,n7 as J,n8 as Q,n9 as W,na as X,nb as Y,mM as D,mL as E,r as n,o as s,p as $,bZ as ee,cP as te,ak as P,nc as ie,mK as oe,nd as z,ne as U,gR as ne,gS as se,kI as M,M as O,bI as F,nf as le,ng as ae,mI as re,ic as B,mN as ce}from"./index-iVlkrMet.js";import{s as V}from"./ReactiveMap-BBqjIwDS.js";import{a as de}from"./catalogUtils-J1X8hQ-e.js";import{t as G,n as pe}from"./actionUtils-D65qOIxf.js";var S;let a=S=class extends j{constructor(e){super(e),this.dragEnabled=!1,this.listModeDisabled=!1,this.parent=null,this.parentTitles=null,this.viewModel=null,this._onActionMenuOpen=i=>{this.item.actionsOpen=i.target.open},this._setTooltipReference=i=>{var t;(t=this.onTooltipReferenceChange)==null||t.call(this,this.item.layer.uid,i)},this._removeTooltipReference=()=>{var i;(i=this.onTooltipReferenceChange)==null||i.call(this,this.item.layer.uid,null)}}loadDependencies(){return H({"action-group":()=>_(()=>import("./calcite-action-group-UjGF3OpY.js"),__vite__mapDeps([0,1,2]),import.meta.url),"action-menu":()=>_(()=>import("./calcite-action-menu-Bv1n3YH-.js"),__vite__mapDeps([3,1,2]),import.meta.url),action:()=>_(()=>import("./calcite-action-C3p1LNKY.js"),__vite__mapDeps([4,1,2]),import.meta.url),icon:()=>_(()=>import("./calcite-icon-uZdnCpqZ.js"),__vite__mapDeps([5,1,2]),import.meta.url),"list-item":()=>_(()=>import("./calcite-list-item-CCOyX-sU.js"),__vite__mapDeps([6,1,2,7,8,9]),import.meta.url),list:()=>_(()=>import("./calcite-list-Dp5vfzDW.js"),__vite__mapDeps([10,1,2,8,7,11,12,13,14,15,16]),import.meta.url),notice:()=>_(()=>import("./index-iVlkrMet.js").then(e=>e.x_),__vite__mapDeps([1,2]),import.meta.url)})}render(){var T,g;const e=this.parentTitles??[],{_title:i,item:t,activeItem:o,selectedDragItemLayerUid:l,selectionMode:d,selectedItems:m,messages:p,parent:h,css:u}=this,y="visibleAtCurrentTimeExtent"in t&&"layerInvisibleAtTime"in p&&!t.visibleAtCurrentTimeExtent?`${i} (${p.layerInvisibleAtTime})`:"visibleAtCurrentScale"in t&&"layerInvisibleAtScale"in p&&!t.visibleAtCurrentScale?`${i} (${p.layerInvisibleAtScale})`:i,C="parent"in t&&((g=(T=t.parent)==null?void 0:T.layer)==null?void 0:g.type)==="catalog",{layer:f}=t,w="visibleAtCurrentScale"in t&&!t.visibleAtCurrentScale||"visibleAtCurrentTimeExtent"in t&&!t.visibleAtCurrentTimeExtent;return c("calcite-list-item",{afterCreate:b=>this._focusSelectedDragEl(b,t),afterUpdate:b=>this._focusSelectedDragEl(b,t),class:this.classes(u.item,"itemActive"in u&&{[u.itemActive]:o===t}),"data-item":t,"data-layer-id":f.id,dragDisabled:!t.sortable||C,dragSelected:f.uid===l,id:f.uid,key:`list-item-${f.uid}`,label:i,metadata:{parentTitles:e,_title:i},open:"open"in t&&t.open,selected:d!=="none"&&m.includes(t),title:y,unavailable:w,value:f.uid,onCalciteListItemDragHandleChange:b=>this._handleCalciteListItemDragHandleChange(b,t),onCalciteListItemSelect:b=>"visible"in t&&this._handleCalciteListItemSelect(b,t,h),onCalciteListItemToggle:b=>"open"in t&&this._handleCalciteListItemToggle(b,t)},this._renderedCatalogFootprintIcon,this._renderedCatalogDynamicIcon,c("div",{class:this.classes(u.itemContent,"itemInvisible"in u&&{[u.itemInvisible]:w}),slot:"content"},i),this._renderedItemStatus,this._renderedItemToggle,this._renderedCatalogSelectNode,this._renderedItemTemporaryIcon,this._renderedChildList,this._renderedItemMessage,this._renderedPanel,this._renderedPanelAction,this._renderedActions)}get _title(){const{messages:e}=this;return this.item.title||("untitledTable"in e?e.untitledTable:e.untitledLayer)}get _renderedItemStatus(){const{item:e,parent:i,visibleElements:t,css:o}=this;if(!t.statusIndicators)return null;const{publishing:l}=e,d="updating"in e&&e.updating&&!i,m="connectionStatus"in e?e.connectionStatus:void 0,p=!!m;return c("calcite-icon",{class:this.classes(o.statusIndicator,{[o.publishing]:l},"updating"in o&&{[o.updating]:d},"connectionStatus"in o&&{[o.connectionStatus]:p},"connectionStatusConnected"in o&&{[o.connectionStatusConnected]:p&&m==="connected"}),icon:K({connectionStatus:m,publishing:l}),key:"layer-item-status",scale:"s",slot:"content-end"})}get _renderedItemTemporaryIcon(){const{item:e,visibleElements:i,css:t}=this,{layer:o}=e,l="temporaryLayerIndicators"in i&&i.temporaryLayerIndicators,d="temporaryTableIndicators"in i&&i.temporaryTableIndicators,m="persistenceEnabled"in o&&(de(o)||!o.persistenceEnabled);return(l||d)&&m?c("calcite-icon",{class:t.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"actions-start",title:this.messages.temporary}):null}get _renderedItemToggle(){const{item:e,parent:i,messages:t,visibilityAppearance:o,css:l}=this;if(!("visible"in e&&"layerVisibility"in t&&"visibleToggle"in l&&o))return null;const{visible:d}=e,m=i==null?void 0:i.visibilityMode;if(m==="inherited")return null;const p=J({visible:d,exclusive:m==="exclusive",visibilityAppearance:o}),h=o==="checkbox",u=t.layerVisibility;return c("calcite-action",{appearance:"transparent",class:l.visibleToggle,icon:h?p:void 0,key:"visibility-toggle",onclick:()=>this._toggleVisibility(e,i),scale:"s",slot:h?"actions-start":"actions-end",text:u,title:u},h?null:c("calcite-icon",{class:this.classes({[l.visibleIcon]:m!=="exclusive"&&d}),icon:p,scale:"s"}))}get _renderedPanel(){const{panel:e}=this.item;return!(e!=null&&e.open)||e.disabled||e.flowEnabled?null:c("div",{class:this.css.itemContentBottom,key:`content-panel-${e.uid}`,slot:"content-bottom"},e.render())}get _renderedPanelAction(){const{panel:e}=this.item;if(!(e!=null&&e.visible))return null;const{open:i,title:t,disabled:o}=e;return c("calcite-action",{active:i,appearance:"transparent",disabled:o,icon:G(e),key:`action-${e.uid}`,onclick:()=>this._togglePanel(e),scale:"s",slot:"actions-end",text:t??"",title:t??void 0},this._renderFallbackIcon(e))}get _renderedActions(){switch(this._actionsCount){case 0:return null;case 1:return this._singleAction;default:return this._renderedActionMenu}}get _renderedActionMenu(){const{item:e,messagesCommon:i}=this,t=i.options;return c("calcite-action-menu",{appearance:"transparent",key:"item-action-menu",label:i.menu,open:e.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:this._onActionMenuOpen},c("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:t,title:t}),this._renderedActionMenuContent)}get _renderedActionMenuContent(){return this._filteredSections.toArray().map(e=>c("calcite-action-group",{key:`action-section-${e.uid}`},e.toArray().map(i=>this._renderAction({action:i,textEnabled:!0}))))}get _renderedCatalogFootprintIcon(){var t;const{css:e}=this,i=((t=this.item.layer)==null?void 0:t.type)==="catalog-footprint";return"itemCatalogIcon"in e&&i?c("calcite-icon",{class:e.itemCatalogIcon,icon:"footprint",key:"footprint",scale:"s",slot:"content-start"}):null}get _renderedCatalogDynamicIcon(){var t;const{css:e}=this,i=((t=this.item.layer)==null?void 0:t.type)==="catalog-dynamic-group";return"itemCatalogIcon"in e&&i?c("calcite-icon",{class:e.itemCatalogIcon,icon:"catalog-dataset",key:"catalog-dataset",scale:"s",slot:"content-start"}):null}get _renderedCatalogSelectNode(){const{_title:e,item:i,visibleElements:t}=this;if(!("visible"in i))return;const{layer:o}=i,l=(o==null?void 0:o.type)==="catalog-dynamic-group";return"catalogLayerList"in t&&t.catalogLayerList&&l?c("calcite-action",{appearance:"transparent",disabled:!o.visible,icon:"chevron-right",iconFlipRtl:!0,onclick:()=>this._triggerOnCatalogOpen(i),scale:"s",slot:"actions-end",text:e}):null}get _renderedChildList(){const{dragEnabled:e,item:i,rootGroupUid:t,listModeDisabled:o,selectionMode:l}=this;if(!("visible"in i))return;const d=[...this.parentTitles??[],i.title],{children:m,layer:p}=i,h=(p==null?void 0:p.type)!=="catalog-dynamic-group"&&Q(i),u=!o&&W(p);return h||!u&&!h&&e&&(p==null?void 0:p.type)==="group"?c("calcite-list",{canPull:y=>!!this.canMove&&this.canMove(y,"pull"),canPut:y=>!!this.canMove&&this.canMove(y,"put"),"data-item":i,"data-layer-type":t,dragEnabled:!!e&&i.childrenSortable&&X(i),group:`${t}-${p.uid}`,key:`child-list-${p.uid}`,selectionAppearance:"border",selectionMode:l},m==null?void 0:m.filter(y=>!y.hidden).toArray().map(y=>this._renderItem(y,i,d)),this._renderedTablesItem):null}get _hasTables(){var t,o;const{layerTablesEnabled:e}=this,i=this.item.layer;if(!e||!i)return!1;switch(i.type){case"knowledge-graph":return e.includes(i.type)&&!!((t=i.tables)!=null&&t.length);case"map-image":case"tile":return e.includes(i.type)&&!!((o=i.subtables)!=null&&o.length);default:return!1}}get _renderedTablesItem(){const{item:e,messages:i,css:t}=this,{layer:o}=e;return"itemTableIcon"in t&&"visible"in e&&"tables"in i&&this._hasTables?c("calcite-list-item",{class:t.item,"data-layer-id":o.id,dragDisabled:!0,key:`list-item-table-list-tables-${o.uid}`,title:i.tables,onCalciteListItemSelect:()=>this._triggerOnTablesOpen(e)},c("div",{class:t.itemContent,slot:"content"},i.tables),c("calcite-icon",{class:t.itemTableIcon,icon:"table",scale:"s",slot:"content-start"}),c("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"})):null}get _renderedItemMessage(){const{item:e,messages:i,css:t}=this;return e.error?c("div",{class:t.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},c("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},"tableError"in i?i.tableError:i.layerError))):"incompatible"in e&&e.incompatible&&"layerIncompatible"in i?c("div",{class:t.itemMessage,key:"esri-layer-list__incompatible",slot:"content-bottom"},c("calcite-notice",{afterCreate:this._setTooltipReference,afterRemoved:this._removeTooltipReference,bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},c("div",{slot:"message"},i.layerIncompatible))):null}get _singleAction(){return this._renderAction({action:Y(this._filteredSections),textEnabled:!1})}get _filteredSections(){return this.item.actionsSections.map(e=>e.filter(i=>i.visible))}get _actionsCount(){return this.item.actionsSections.reduce((e,i)=>e+i.length,0)}_renderAction(e){const{item:i}=this,{action:t,textEnabled:o}=e;if(!t)return null;const{active:l,disabled:d,title:m,type:p,indicator:h}=t;return c("calcite-action",{active:p==="toggle"&&t.value,appearance:"transparent",disabled:d,icon:G(t),indicator:h,key:`action-${t.uid}`,loading:l,onclick:()=>this._triggerAction(i,t),scale:"s",slot:o?void 0:"actions-end",text:m??"",textEnabled:o,title:m??void 0},this._renderFallbackIcon(t))}_renderFallbackIcon(e){const{css:i}=this,{className:t,icon:o}=e;if(o)return null;const l="image"in e?e.image:void 0,d={[i.itemActionIcon]:!!t,[i.itemActionImage]:!!l};return t&&(d[t]=!0),l||t?c("span",{"aria-hidden":"true",class:this.classes(i.itemActionIcon,d),key:"icon",styles:pe(l)}):null}_renderItem(e,i,t=[]){return c(S,{activeItem:this.activeItem,canMove:this.canMove,css:this.css,dragEnabled:this.dragEnabled,item:e,key:`layerListItem-${e.layer.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:i,parentTitles:t,rootGroupUid:this.rootGroupUid,selectedDragItemLayerUid:this.selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this.onAction,onCatalogOpen:this.onCatalogOpen,onPanelOpen:this.onPanelOpen,onSelectedDragItemLayerUidChange:this.onSelectedDragItemLayerUidChange,onTablesOpen:this.onTablesOpen,onTooltipReferenceChange:this.onTooltipReferenceChange})}_triggerAction(e,i){i&&e&&(i.type==="toggle"&&(i.value=!i.value),this.onAction(i,e))}_triggerOnTablesOpen(e){e&&this.onTablesOpen&&this.onTablesOpen(e)}_triggerOnCatalogOpen(e){var i;e&&((i=this.onCatalogOpen)==null||i.call(this,e))}_focusSelectedDragEl(e,i){this.selectedDragItemLayerUid===i.layer.uid&&D(e)}_handleCalciteListItemToggle(e,i){e.stopPropagation(),i.open=e.target.open}_handleCalciteListItemDragHandleChange(e,i){var o;e.stopPropagation();const t=e.target.dragSelected;(o=this.onSelectedDragItemLayerUidChange)==null||o.call(this,t?i.layer.uid:null)}_handleCalciteListItemSelect(e,i,t){E(e.target)===i&&this.selectionMode==="none"&&(t==null?void 0:t.visibilityMode)!=="inherited"&&this._toggleVisibility(i,t)}_togglePanel(e){e.open=!e.open,e.open&&this.onPanelOpen()}_toggleVisibility(e,i){if(!e)return;(i==null?void 0:i.visibilityMode)==="exclusive"&&e.visible||(e.visible=!e.visible)}};a.vnodeSelector="calcite-list-item",n([s()],a.prototype,"activeItem",void 0),n([s()],a.prototype,"canMove",void 0),n([s()],a.prototype,"css",void 0),n([s()],a.prototype,"dragEnabled",void 0),n([s()],a.prototype,"item",void 0),n([s()],a.prototype,"layerTablesEnabled",void 0),n([s()],a.prototype,"listModeDisabled",void 0),n([s()],a.prototype,"messages",void 0),n([s()],a.prototype,"messagesCommon",void 0),n([s()],a.prototype,"onAction",void 0),n([s()],a.prototype,"onPanelOpen",void 0),n([s()],a.prototype,"onCatalogOpen",void 0),n([s()],a.prototype,"onTablesOpen",void 0),n([s()],a.prototype,"onSelectedDragItemLayerUidChange",void 0),n([s()],a.prototype,"onTooltipReferenceChange",void 0),n([s()],a.prototype,"parent",void 0),n([s()],a.prototype,"parentTitles",void 0),n([s()],a.prototype,"rootGroupUid",void 0),n([s()],a.prototype,"selectionMode",void 0),n([s()],a.prototype,"selectedItems",void 0),n([s()],a.prototype,"selectedDragItemLayerUid",void 0),n([s()],a.prototype,"visibleElements",void 0),n([s()],a.prototype,"visibilityAppearance",void 0),n([s()],a.prototype,"_title",null),n([s()],a.prototype,"_renderedItemStatus",null),n([s()],a.prototype,"_renderedItemTemporaryIcon",null),n([s()],a.prototype,"_renderedItemToggle",null),n([s()],a.prototype,"_renderedPanel",null),n([s()],a.prototype,"_renderedPanelAction",null),n([s()],a.prototype,"_renderedActions",null),n([s()],a.prototype,"_renderedActionMenu",null),n([s()],a.prototype,"_renderedActionMenuContent",null),n([s()],a.prototype,"_renderedCatalogFootprintIcon",null),n([s()],a.prototype,"_renderedCatalogDynamicIcon",null),n([s()],a.prototype,"_renderedCatalogSelectNode",null),n([s()],a.prototype,"_renderedChildList",null),n([s()],a.prototype,"_hasTables",null),n([s()],a.prototype,"_renderedTablesItem",null),n([s()],a.prototype,"_renderedItemMessage",null),n([s()],a.prototype,"_singleAction",null),n([s()],a.prototype,"_filteredSections",null),n([s()],a.prototype,"_actionsCount",null),a=S=n([$("esri.widgets.LayerList.LayerListItem")],a);const me=a,ue=["label","description","metadata"],v="esri-layer-list",L=`${v}__item`,A={base:v,actionMenu:`${v}__action-menu`,actionGroup:`${v}__action-group`,filterNoResults:`${v}__filter-no-results`,item:L,itemActive:`${L}--active`,itemContent:`${L}-content`,itemContentBottom:`${L}-content-bottom`,itemMessage:`${L}-message`,itemInvisible:`${L}--invisible`,itemActionIcon:`${L}-action-icon`,itemActionImage:`${L}-action-image`,itemTemporaryIcon:`${L}-temporary-icon`,itemTableIcon:`${L}-table-icon`,itemCatalogIcon:`${L}-catalog-icon`,statusIndicator:`${v}__status-indicator`,publishing:`${v}__publishing`,updating:`${v}__updating`,connectionStatus:`${v}__connection-status`,connectionStatusConnected:`${v}__connection-status--connected`,visibleToggle:`${v}__visible-toggle`,visibleIcon:`${v}__visible-icon`};let I=class extends ee{constructor(){super(...arguments),this.catalogLayerList=!0,this.closeButton=!1,this.collapseButton=!1,this.errors=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.statusIndicators=!0,this.temporaryLayerIndicators=!1}};n([s({type:Boolean,nonNullable:!0})],I.prototype,"catalogLayerList",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"closeButton",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"collapseButton",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"errors",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"filter",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"flow",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"heading",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"statusIndicators",void 0),n([s({type:Boolean,nonNullable:!0})],I.prototype,"temporaryLayerIndicators",void 0),I=n([$("esri.widgets.LayerList.LayerListVisibleElements")],I);const Z=I,he=P.ofType(re);let r=class extends te(j){constructor(e,i){super(e,i),this._activeItem=null,this._tooltipReferenceMap=new V,this._focusRootFlowItem=!1,this._focusPanelFlowItem=!1,this._focusLayerFlowItem=null,this._layerListMap=new V,this._lastDragDetail=null,this._selectedDragItemLayerUid=null,this._rootGroupUid=`operational-${this.uid}`,this._openedLayersController=null,this.catalogLayerList=null,this.catalogOptions=null,this.collapsed=!1,this.dragEnabled=!1,this.filterPlaceholder="",this.filterText="",this.headingLevel=2,this.knowledgeGraphOptions=null,this.layerTablesEnabled=new P(["knowledge-graph"]),this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.mapImageOptions=null,this.messages=null,this.messagesCommon=null,this.minDragEnabledItems=ie,this.minFilterItems=oe,this.openedLayers=new P,this.openedLayerLists=new P,this.selectedItems=new he,this.selectionMode="none",this.tableList=null,this.tileOptions=null,this.viewModel=new z,this.visibilityAppearance="default",this.visibleElements=new Z,this._canMove=({dragEl:t,fromEl:o,toEl:l},d)=>{var R,x,N;const m=d==="pull"?this.listItemCanGiveFunction:this.listItemCanReceiveFunction,p=E(t);if(!(p!=null&&p.sortable))return!1;const h=E(o),u=U(o),y=E(l),C=U(l),f=!!u&&!!C&&u===C,w={selected:p,from:h,to:y},T=o.group,g=l.group,b=((R=h==null?void 0:h.layer)==null?void 0:R.type)??"",q=((x=y==null?void 0:y.layer)==null?void 0:x.type)??"",k=new Set(["map-image","catalog","knowledge-graph"]);return T&&g&&typeof m=="function"?m.call(null,w):f&&!k.has(b)&&!k.has(q)&&((N=p==null?void 0:p.layer)==null?void 0:N.type)!=="sublayer"},this._onCatalogOpen=t=>{this.openedLayers.push(t.layer.parent),this._focusLayerFlowItem=t.layer.uid},this._onTablesOpen=t=>{this.openedLayers.push(t.layer),this._focusLayerFlowItem=t.layer.uid},this._onPanelOpen=()=>{this._focusPanelFlowItem=!0},this._onSelectedDragItemLayerUidChange=t=>{this._selectedDragItemLayerUid=t},this._onTooltipReferenceChange=(t,o)=>{o?this._tooltipReferenceMap.set(t,o):this._tooltipReferenceMap.delete(t)},this._onTriggerAction=(t,o)=>{this.triggerAction(t,o)},this._clearActiveItem=()=>{this._activeItem=null},this._setActiveItem=t=>{if(this.visibilityAppearance!=="default")return;const o=Array.from(t.composedPath()).find(l=>{var d;return(d=l.classList)==null?void 0:d.contains(A.item)});this._activeItem=E(o)},this._onCalciteListOrderChange=t=>{const{_lastDragDetail:o}=this,{toEl:l,fromEl:d,dragEl:m,newIndex:p}=t;if(d&&l&&!((o==null?void 0:o.newIndex)===p&&(o==null?void 0:o.dragEl)===m&&(o==null?void 0:o.toEl)===l&&(o==null?void 0:o.fromEl)===d))if(this._lastDragDetail=t,d!==l)this._moveLayerFromChildList({toEl:l,fromEl:d,dragEl:m,newIndex:p});else{const h=Array.from(d.children).filter(u=>u==null?void 0:u.matches("calcite-list-item")).map(u=>u.value);this._sortLayers(d,h)}}}initialize(){this.addHandles(ne(()=>this.openedLayers,"change",()=>this._handleOpenedLayersChange(),se))}loadDependencies(){return H({button:()=>_(()=>import("./calcite-button-qjzyXLWO.js"),__vite__mapDeps([17,1,2]),import.meta.url),flow:()=>_(()=>import("./calcite-flow-CLSvNCgC.js"),__vite__mapDeps([18,1,2]),import.meta.url),"flow-item":()=>_(()=>import("./calcite-flow-item-BzjAbMSF.js"),__vite__mapDeps([19,1,2]),import.meta.url),list:()=>_(()=>import("./calcite-list-Dp5vfzDW.js"),__vite__mapDeps([10,1,2,8,7,11,12,13,14,15,16]),import.meta.url),notice:()=>_(()=>import("./index-iVlkrMet.js").then(e=>e.x_),__vite__mapDeps([1,2]),import.meta.url),tooltip:()=>_(()=>import("./index-iVlkrMet.js").then(e=>e.xZ),__vite__mapDeps([1,2]),import.meta.url)})}destroy(){this._destroyOpenedLayerLists(),this._tooltipReferenceMap.clear()}get _totalItems(){return this.viewModel.operationalItems.flatten(e=>e.children.filter(i=>i.layer.type!=="catalog-dynamic-group")).length}get _dragEnabled(){return this._totalItems>=this.minDragEnabledItems&&this.dragEnabled}get _filterEnabled(){return this._totalItems>=this.minFilterItems&&this.visibleElements.filter}get _renderedOpenLayerFlowItems(){return this.openedLayers.toArray().map(e=>this._renderLayerFlowItem(e))}get icon(){return"layers"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get multipleSelectionEnabled(){return M(O.getLogger(this),"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0}),this.selectionMode==="multiple"}set multipleSelectionEnabled(e){M(O.getLogger(this),"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0}),this.selectionMode=e?"multiple":this.selectionEnabled?"single":"none"}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get selectionEnabled(){return M(O.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0}),this.selectionMode!=="none"&&this.dragEnabled}set selectionEnabled(e){M(O.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0}),this.dragEnabled=e,this.selectionMode=e?this.multipleSelectionEnabled?"multiple":"single":"none"}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}triggerAction(e,i){return this.viewModel.triggerAction(e,i)}render(){var o,l;const e=(o=this.viewModel)==null?void 0:o.state,i={[F.hidden]:e==="loading",[F.disabled]:e==="disabled"},t=(l=this.operationalItems)==null?void 0:l.filter(d=>!d.hidden&&(this.visibleElements.errors||!d.error));return c("div",{class:this.classes(A.base,F.widget,F.panel,i)},t!=null&&t.length?[this._renderItemTooltips(t),this._renderItems(t)]:this._renderNoItems())}async _createFlowList(e,i){const{_layerListMap:t}=this,o=t.get(e);if(o)return o;const l=e.type==="catalog"?await this._createCatalogLayerList(e):await this._createTableList(e);return i.aborted||t.set(e,l),l}async _handleOpenedLayersChange(){var p;const{_layerListMap:e,openedLayers:i,openedLayerLists:t}=this;(p=this._openedLayersController)==null||p.abort();const o=new AbortController,{signal:l}=o;this._openedLayersController=o,e.forEach((h,u)=>{i.includes(u)||(h.destroy(),e.delete(u))});const d=await Promise.all(i.map(h=>this._createFlowList(h,l)));if(l.aborted)return;t.removeAll(),t.addMany(d);const m=t.at(-1);m?"catalogLayer"in m?(this._set("catalogLayerList",m),this._set("tableList",null)):(this._set("catalogLayerList",null),this._set("tableList",m)):(this._set("catalogLayerList",null),this._set("tableList",null))}_destroyOpenedLayerLists(){this.openedLayerLists.destroyAll(),this.openedLayers.removeAll(),this._layerListMap.clear()}_renderItemTooltip(e){const{_tooltipReferenceMap:i,messages:t}=this;return e?c("calcite-tooltip",{key:`tooltip-${e.layer.uid}`,referenceElement:i.get(e.layer.uid)},t.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){var i;return e.incompatible?this._renderItemTooltip(e):(i=e.children)==null?void 0:i.filter(t=>!t.hidden).toArray().map(t=>this._renderItemTooltipNodes(t))}_renderItemTooltips(e){return e==null?void 0:e.toArray().map(i=>this._renderItemTooltipNodes(i))}_renderNoItemsMessage(){return c("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return c("div",{class:A.itemMessage,key:"esri-layer-list__no-items"},c("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}async _createCatalogLayerList(e){const{default:i}=await _(()=>import("./CatalogLayerList-C7OfU76J.js"),__vite__mapDeps([20,1,2,21,22,23]),import.meta.url),{headingLevel:t,catalogOptions:o,view:l,filterPlaceholder:d,listItemCreatedFunction:m,minFilterItems:p,selectionMode:h,visibilityAppearance:u,_onCatalogOpen:y,_onTablesOpen:C,layerTablesEnabled:f}=this;return new i({headingLevel:t,view:l,filterPlaceholder:d,listItemCreatedFunction:m,minFilterItems:p,selectionMode:h,visibilityAppearance:u,...o,catalogLayer:e,layerTablesEnabled:f,onCatalogOpen:y,onTablesOpen:C})}_getTableListParams(e){switch(e.type){case"knowledge-graph":return{...this.knowledgeGraphOptions,tables:e.tables};case"map-image":return{...this.mapImageOptions,tables:e.subtables};case"tile":return{...this.tileOptions,tables:e.subtables};default:return null}}async _createTableList(e){const{default:i}=await _(()=>import("./TableList-Dh1ZwWX6.js"),__vite__mapDeps([24,1,2,21,22,23]),import.meta.url),{headingLevel:t,selectionMode:o,dragEnabled:l}=this;return new i({headingLevel:t,selectionMode:o,dragEnabled:l,...this._getTableListParams(e)})}_renderLayerFlowItem(e){var l;const{messages:i,openedLayers:t}=this,o=e.title||this.messages.untitledLayer;return c("calcite-flow-item",{afterCreate:this._focusLayerFlowItemNode,afterUpdate:this._focusLayerFlowItemNode,bind:this,"data-layer-uid":e.uid,description:o,heading:i[e.type==="catalog"?"catalogLayers":"tables"],headingLevel:this.headingLevel,key:`flow-layer-list-${e.uid}`,onCalciteFlowItemBack:d=>{d.preventDefault(),t.pop();const m=t.at(-1);m?this._focusLayerFlowItem=m.uid:this._focusRootFlowItem=!0}},(l=this._layerListMap.get(e))==null?void 0:l.render())}_renderPanelFlowItems(e){return e?e.flatten(i=>i.children).filter(({hidden:i,panel:t})=>!i&&(t==null?void 0:t.open)&&!t.disabled&&t.flowEnabled).toArray().map(({title:i,panel:t})=>{const o=()=>this._handlePanelFlowItemBack(t);return c("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:i,heading:t.title,headingLevel:this.headingLevel,key:`flow-panel-${t.uid}`,onCalciteFlowItemBack:l=>{l.preventDefault(),o()}},t.render(),c("calcite-button",{appearance:"transparent",onclick:o,slot:"footer-actions",width:"full"},this.messagesCommon.back))}):[]}_handlePanelFlowItemBack(e){e.open=!1,this._focusRootFlowItem=!0}_focusRootFlowItemNode(e){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,D(e))}_focusLayerFlowItemNode(e){this._focusLayerFlowItem===e.dataset.layerUid&&(this._focusLayerFlowItem=null,D(e))}_focusPanelFlowItemNode(e){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,D(e))}_renderItems(e){const{visible:i,collapsed:t,_filterEnabled:o,_rootGroupUid:l,visibleElements:{closeButton:d,collapseButton:m,heading:p,flow:h},_dragEnabled:u,selectionMode:y,filterText:C,filterPlaceholder:f,messages:w}=this,T=[c("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:d,closed:!i,collapsed:t,collapsible:m,heading:p?w.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},c("calcite-list",{afterCreate:g=>{g.addEventListener("focusin",this._setActiveItem),g.addEventListener("focusout",this._clearActiveItem)},afterRemoved:g=>{g.removeEventListener("focusin",this._setActiveItem),g.removeEventListener("focusout",this._clearActiveItem)},canPull:g=>this._canMove(g,"pull"),canPut:g=>this._canMove(g,"put"),"data-layer-type":l,dragEnabled:u,filterEnabled:o,filterPlaceholder:f,filterProps:ue,filterText:o?C:"",group:l,key:"root-list",label:w.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:y,onCalciteListChange:g=>this._handleCalciteListChange(g),onCalciteListDragEnd:g=>this._handleCalciteListDragEnd(g.detail),onCalciteListFilter:g=>{var b;return this.filterText=((b=g.target)==null?void 0:b.filterText)??""},onCalciteListOrderChange:g=>this._onCalciteListOrderChange(g.detail)},e==null?void 0:e.toArray().map(g=>this._renderItem(g)),e!=null&&e.length&&o?c("div",{class:A.filterNoResults,slot:"filter-no-results"},c("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(e),this._renderedOpenLayerFlowItems];return i?h?c("calcite-flow",{key:"root-flow"},T):T:null}_renderItem(e,i,t){return c(me,{activeItem:this._activeItem,canMove:this._canMove,css:A,dragEnabled:this.dragEnabled,item:e,key:`layerListItem-${e.layer.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.viewModel.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:i,parentTitles:t,rootGroupUid:this._rootGroupUid,selectedDragItemLayerUid:this._selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this._onTriggerAction,onCatalogOpen:this._onCatalogOpen,onPanelOpen:this._onPanelOpen,onSelectedDragItemLayerUidChange:this._onSelectedDragItemLayerUidChange,onTablesOpen:this._onTablesOpen,onTooltipReferenceChange:this._onTooltipReferenceChange})}_moveLayerFromChildList({toEl:e,fromEl:i,dragEl:t,newIndex:o}){const l=E(t),d=E(e),m=E(i);this.viewModel.moveListItem(l,m,d,o)}_handleCalciteListDragEnd(e){const{fromEl:i,dragEl:t,oldIndex:o}=e;i.insertBefore(t,i.children[o])}_sortLayers(e,i){var t,o;if(e)if(e.group===this._rootGroupUid)le((o=(t=this.view)==null?void 0:t.map)==null?void 0:o.layers,i);else{const l=E(e);if(!l)return;ae(l,i)}}_handleCalciteListChange(e){const{selectionMode:i,selectedItems:t}=this;if(i==="none")return;const o=e.target.selectedItems.map(l=>E(l)).filter(Boolean);t.removeAll(),t.addMany(o)}};n([s()],r.prototype,"_activeItem",void 0),n([s()],r.prototype,"_tooltipReferenceMap",void 0),n([s()],r.prototype,"_focusRootFlowItem",void 0),n([s()],r.prototype,"_focusPanelFlowItem",void 0),n([s()],r.prototype,"_focusLayerFlowItem",void 0),n([s()],r.prototype,"_layerListMap",void 0),n([s()],r.prototype,"_totalItems",null),n([s()],r.prototype,"_dragEnabled",null),n([s()],r.prototype,"_filterEnabled",null),n([s()],r.prototype,"_renderedOpenLayerFlowItems",null),n([s({readOnly:!0})],r.prototype,"catalogLayerList",void 0),n([s()],r.prototype,"catalogOptions",void 0),n([s()],r.prototype,"collapsed",void 0),n([s()],r.prototype,"dragEnabled",void 0),n([s()],r.prototype,"filterPlaceholder",void 0),n([s()],r.prototype,"filterText",void 0),n([s()],r.prototype,"headingLevel",void 0),n([s()],r.prototype,"icon",null),n([s()],r.prototype,"knowledgeGraphOptions",void 0),n([s()],r.prototype,"label",null),n([s()],r.prototype,"layerTablesEnabled",void 0),n([s()],r.prototype,"listItemCanGiveFunction",void 0),n([s()],r.prototype,"listItemCanReceiveFunction",void 0),n([s()],r.prototype,"listItemCreatedFunction",null),n([s()],r.prototype,"mapImageOptions",void 0),n([s(),B("esri/widgets/LayerList/t9n/LayerList")],r.prototype,"messages",void 0),n([s(),B("esri/t9n/common")],r.prototype,"messagesCommon",void 0),n([s()],r.prototype,"minDragEnabledItems",void 0),n([s()],r.prototype,"minFilterItems",void 0),n([s()],r.prototype,"multipleSelectionEnabled",null),n([s({readOnly:!0})],r.prototype,"openedLayers",void 0),n([s({readOnly:!0})],r.prototype,"openedLayerLists",void 0),n([s()],r.prototype,"operationalItems",null),n([s()],r.prototype,"selectionEnabled",null),n([s()],r.prototype,"selectedItems",void 0),n([s()],r.prototype,"selectionMode",void 0),n([s({readOnly:!0})],r.prototype,"tableList",void 0),n([s()],r.prototype,"tileOptions",void 0),n([s()],r.prototype,"view",null),n([ce("trigger-action"),s({type:z})],r.prototype,"viewModel",void 0),n([s()],r.prototype,"visibilityAppearance",void 0),n([s({type:Z,nonNullable:!0})],r.prototype,"visibleElements",void 0),r=n([$("esri.widgets.LayerList")],r);const ge=r,fe=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{fe as L,me as _,ue as t};
