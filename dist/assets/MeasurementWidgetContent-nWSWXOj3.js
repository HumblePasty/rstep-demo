const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-label-C4rgJ2LW.js","./index-DbqNxVxJ.js","./index-C6GyxWqK.css","./calcite-option-CWBxYkHT.js","./calcite-select-TIZRzkuR.js","./Validation-DUj1EKmr.js","./input-message-EeAHckxI.js","./calcite-button-DSmL_C8w.js"])))=>i.map(i=>d[i]);
import{c0 as z,kV as ee,kT as F,kU as N,kW as I,eF as te,kS as ie,r5 as B,r6 as se,b1 as K,a0 as oe,iG as G,px as re,kC as ne,r as o,o as n,p as g,i4 as r,k0 as c,mD as d,bm as H,kO as ae,r7 as de,r8 as he,r9 as le,ra as pe,rb as W,rc as Y,rd as ce,bZ as j,re as ue,bu as _e,k as q,n as J,ak as ve,rf as me,m as we,rg as ge,rh as ye,i6 as xe,M as Oe,i8 as Q,i9 as X,_ as S,bG as l,ri as Ve,ic as Pe}from"./index-DbqNxVxJ.js";import{d as Te}from"./SnappingVisualizer2D-qTd7Kz-c.js";var U;let u=U=class extends z.EventedAccessor{constructor(t){super(t),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=ee(!!t.hasZ,!1,t.view.spatialReference),this._snappingManager=t.snappingManager,this._editGeometryOperations=new F(new N(t.editGeometryType??"polygon",this._coordinateHelper),I.Local),this._snappingGraphicsLayer=new te({id:U.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new ie({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new Te(this._snappingGraphicsLayer)}),this._activeComponent=new B(t.view.spatialReference,I.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(t){const e={...t};return delete e.editGeometryType,delete e.snappingManager,e}initialize(){this._snappingOperation=new se({view:this.view}),this.view.type==="2d"&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),this._snappingManager!=null&&this._snappingManager.doneSnapping(),this._snappingOperation=K(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map(t=>t.pos)}get vertices(){return this._stagedVertex!=null?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return this._hasZ!=null?this._hasZ:this.view.type==="3d"}set hasZ(t){this._hasZ=t,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(t){this._snappingOperation.stagedPoint=oe(t)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(t){const e=t&&this.screenToMap(t);return e==null?null:e.hasZ?[e.x,e.y,e.z]:[e.x,e.y]}getCoordsAndPointFromScreenPoint(t){const e=this.screenToMap(t);return e==null?null:e.hasZ?{vertex:[e.x,e.y,e.z],mapPoint:e}:{vertex:[e.x,e.y],mapPoint:e}}screenToMap(t){let e=null;if(this.view.type==="3d")if(this.hasZ){const i=this.elevationInfo??fe;e=this.view.sceneIntersectionHelper.intersectElevationFromScreen(G(t.x,t.y),i,this._getGeometryZValue())}else{const i=this.elevationInfo??Ce;e=this.view.sceneIntersectionHelper.intersectElevationFromScreen(G(t.x,t.y),i,0),e!=null&&(e.z=void 0)}else e=this.view.toMap(t),e!=null&&(e.z=this.hasZ?this._getGeometryZValue():void 0);return e}_pushCursorVertex(t,e){const i=re(t[0],t[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=i;const s=this._snappingManager;if(s==null)return this._stagedVertex=i,void e();ne(this._snappingOperation.snap({point:i},s,this._snappingContext)).then(()=>{e()})}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(t){var a;const e=(a=this._editGeometryOperations.data.components[0].getLastVertex())==null?void 0:a.pos;if(e&&t[0]===e[0]&&t[1]===e[1])return!0;const{x:i,y:s}=this._coordinateHelper.vectorToDehydratedPoint(t);return this._lastVertexUnsnapped!=null&&i===this._lastVertexUnsnapped.x&&s===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(t){return He(t)&&(this._activePointerId==null||this._activePointerId===t.pointerId)}_vertexAddHandler(t){const e=this._stagedVertex!=null?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);e!=null&&this._addVertex(e,t.native)}_drawCompleteHandler(t){this._completeDrawing(t.native)}};u.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",o([n({readOnly:!0})],u.prototype,"vertices",null),o([n({type:Boolean,nonNullable:!0})],u.prototype,"interactiveUndoDisabled",void 0),o([n({readOnly:!0})],u.prototype,"history",void 0),o([n({readOnly:!0})],u.prototype,"redoHistory",void 0),o([n()],u.prototype,"snapToScene",void 0),o([n()],u.prototype,"view",void 0),o([n()],u.prototype,"elevationInfo",void 0),o([n({nonNullable:!0})],u.prototype,"defaultZ",void 0),o([n()],u.prototype,"hasZ",null),o([n()],u.prototype,"_snappingOperation",void 0),o([n()],u.prototype,"_stagedVertex",null),u=U=o([g("esri.views.draw.DrawAction")],u);const fe={mode:"absolute-height",offset:0},Ce={mode:"on-the-ground",offset:0};function He(t){return t.pointerType!=="mouse"||t.button===0}const b=u;class v{constructor(e,i,s){this.view=e,this.vertexIndex=i,this.vertices=s,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class P{constructor(e,i,s){this.view=e,this.vertexIndex=i,this.vertices=s,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}let y=class{constructor(e,i,s,a=null){this.view=e,this.vertexIndex=i,this.vertices=s,this.mapPoint=a,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=s.length===1?s[0]:null}preventDefault(){this.defaultPrevented=!0}};class x{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=e.length===1?e[0]:null}preventDefault(){this.defaultPrevented=!0}}const Z=Symbol("view-handles"),R=Symbol("undo-redo-handles");let E=class extends b{constructor(t){super(t),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",t=>{t.stopPropagation()},r.TOOL),this.view.on("pointer-down",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._activePointerId=t.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=c(t),t.pointerType==="touch"&&this._updateCursor())},r.TOOL),this.view.on("pointer-move",t=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=c(t),t.pointerType!=="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-drag",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)},r.TOOL),this.view.on("pointer-up",t=>{if(this._shouldHandlePointerEvent(t))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(t);else{const e=t.pointerType==="touch";this._updateCursor(e)}},r.TOOL),this.view.on("drag",["Shift"],t=>{t.stopPropagation()},r.TOOL),this.view.on("double-click",t=>{t.stopPropagation(),this._drawCompleteHandler(t)},r.TOOL),this.view.on("double-click",["Control"],t=>{t.stopPropagation(),this._drawCompleteHandler(t)},r.TOOL),this.view.on("key-down",t=>{const{key:e,repeat:i}=t;e===d.vertexAdd&&!i&&this._cursorScreenPoint?(t.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(t)):e!==d.complete||i?e!==d.undo||this.interactiveUndoDisabled||i?e!==d.redo||this.interactiveUndoDisabled||i?e!==d.pan||i||t.stopPropagation():(t.stopPropagation(),this.redo()):(t.stopPropagation(),this.undo()):(t.stopPropagation(),this._drawCompleteHandler(t))},r.TOOL),this.view.on("key-up",t=>{t.key===d.pan&&t.stopPropagation()},r.TOOL)],Z)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",t=>{if(this.notifyChange("vertices"),t.operation==="undo"){const e=[...this._committedVertices];this._stagedVertex!=null&&e.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new P(this.view,t.vertices[0].index,e))}}),this._editGeometryOperations.on("vertex-add",t=>{if(this.notifyChange("vertices"),t.operation==="apply"){const e=this._committedVertices.length-1,i=new v(this.view,e,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if(t.operation==="redo"){const e=[...this._committedVertices];this._stagedVertex!=null&&e.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new v(this.view,t.vertices[0].index,e))}})],R)}_removeViewHandles(){this.removeHandles(Z)}_removeUndoRedoHandles(){this.removeHandles(R)}_addVertex(t){const e=this._coordinateHelper.arrayToVector(t);this._isDuplicateOfLastVertex(e)||this._editGeometryOperations.appendVertex(e)}_updateCursor(t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);e==null||t||this._pushCursorVertex(e.vertex,()=>this.emit("cursor-update",new y(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new H(this._stagedVertex):null)))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new x(this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}};E=o([g("esri.views.draw.MultipointDrawAction")],E);const be=E;let p=class extends z.EventedMixin(ae){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,i=de(this.hasZ,this.elevationInfo);this.drawOperation=new he({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:e.type==="3d"?new pe(e,i):null,elevationDrawSurface:e.type==="3d"?new le(i,this.defaultZ,e):null,hasM:!1,elevationInfo:i}),this.addHandles([this.drawOperation.on("vertex-add",s=>this.onVertexAdd(s)),this.drawOperation.on("vertex-remove",s=>this.onVertexRemove(s)),this.drawOperation.on("vertex-update",s=>this.onVertexUpdate(s)),this.drawOperation.on("cursor-update",s=>this.onCursorUpdate(s)),this.drawOperation.on("complete",s=>this.onComplete(s))]),this.finishToolCreation()}destroy(){this.drawOperation=K(this.drawOperation),this._set("view",null)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.geometryIncludingUncommittedVertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}canRedo(){return this.drawOperation.canRedo}canUndo(){return this.drawOperation.canUndo}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};o([n({constructOnly:!0,nonNullable:!0})],p.prototype,"defaultZ",void 0),o([n()],p.prototype,"drawOperation",void 0),o([n({constructOnly:!0})],p.prototype,"elevationInfo",void 0),o([n({value:!0})],p.prototype,"enabled",null),o([n({constructOnly:!0})],p.prototype,"geometryType",void 0),o([n({constructOnly:!0})],p.prototype,"hasZ",void 0),o([n({constructOnly:!0})],p.prototype,"mode",void 0),o([n()],p.prototype,"snapToScene",void 0),o([n({readOnly:!0})],p.prototype,"type",void 0),o([n({readOnly:!0})],p.prototype,"updating",null),o([n({constructOnly:!0,nonNullable:!0})],p.prototype,"view",void 0),p=o([g("esri.views.draw.DrawTool")],p);let $=class extends b{constructor(t){super(t),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),this.view.type==="3d"&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",t=>{t.key===d.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(t)))},r.TOOL)])}_addViewHandles2DOnly(){this.view.type==="2d"&&this.addHandles([this.view.on("pointer-down",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._activePointerId=t.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=c(t),t.pointerType==="touch"&&this._updateCursor())},r.TOOL),this.view.on("pointer-move",t=>{this._abortSnapping(),this._cursorScreenPoint=c(t),t.pointerType!=="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-drag",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)},r.TOOL),this.view.on("pointer-up",t=>{if(this._shouldHandlePointerEvent(t))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)t.stopPropagation(),this._vertexAddHandler(t);else{const e=t.pointerType==="touch";this._updateCursor(e)}},r.TOOL),this.view.on("drag",["Shift"],t=>{t.stopPropagation()},r.TOOL)])}_addDrawTool(){const t=new p({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=t,this.view.addAndActivateTool(t),this.addHandles([t.on("cursor-update",e=>{e.vertices.length===1&&this.emit("cursor-update",new y(this.view,e.vertices[0].vertexIndex,t.getVertexCoords()))}),t.on("complete",e=>{this.emit("draw-complete",new x(t.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()})])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(t){const e=this._coordinateHelper.arrayToVector(t);this._isDuplicateOfLastVertex(e)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(e),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);e==null||t||this._pushCursorVertex(e.vertex,()=>this.emit("cursor-update",new y(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new H(this._stagedVertex):null)))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping();const t=new x(this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this.removeAllHandles()}};$=o([g("esri.views.draw.PointDrawAction")],$);const Se=$;let T=class extends b{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=W}initialize(){this._addViewHandles(),this.view.type==="3d"&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return this.mode==="freehand"||this.mode==="hybrid"}get _clickEnabled(){return this.mode==="click"||this.mode==="hybrid"}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e;return((e=this._drawTool)==null?void 0:e.canUndo())??super.canUndo()}canRedo(){var e;return((e=this._drawTool)==null?void 0:e.canRedo())??super.canRedo()}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles(this.view.on("key-down",e=>{const{key:i,repeat:s}=e;i!==d.vertexAdd||s?i!==d.complete||s?i!==d.undo||this.interactiveUndoDisabled||s?i!==d.redo||this.interactiveUndoDisabled||s||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))},r.TOOL))}_addViewHandles2DOnly(){this.view.type==="2d"&&(this.addHandles([this.view.on("click",e=>{e.stopPropagation()},r.TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=c(e),e.pointerType==="touch"&&this._updateCursor())},r.TOOL),this.view.on("pointer-move",e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=c(e),e.pointerType!=="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=c(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)},r.TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return this.vertices.length===1&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const i=e.pointerType==="touch";this._updateCursor(i)}},r.TOOL),this.view.on("drag",e=>{this._dragEnabled&&this._activePointerId!=null&&!this._panEnabled&&e.stopPropagation()},r.TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},r.TOOL),this.view.on("double-click",e=>{e.stopPropagation(),this._drawCompleteHandler(e)},r.TOOL),this.view.on("double-click",["Control"],e=>{e.stopPropagation(),this._drawCompleteHandler(e)},r.TOOL),this.view.on("key-down",e=>{const{key:i,repeat:s}=e;i!==d.pan||s||(e.stopPropagation(),this._panEnabled=!0)},r.TOOL),this.view.on("key-up",e=>{e.key===d.pan&&(e.stopPropagation(),this._panEnabled=!1)},r.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",e=>{if(this.notifyChange("vertices"),e.operation==="undo"){const i=[...this._committedVertices];this._stagedVertex!=null&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new P(this.view,e.vertices[0].index,i))}}),this._editGeometryOperations.on("vertex-add",e=>{if(this.notifyChange("vertices"),e.operation==="apply"){const i=this._committedVertices.length-1,s=new v(this.view,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if(e.operation==="redo"){const i=[...this._committedVertices];this._stagedVertex!=null&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new v(this.view,e.vertices[0].index,i))}})])}_addDrawTool(){const e=new p({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),e.on("vertex-add",i=>{if(i.vertices.length===1){const{view:s}=this,a=i.vertices[0].vertexIndex,h=e.getVertexCoords();this.emit("vertex-add",new v(s,a,h)),i.operation!=="undo"&&i.operation!=="redo"||this.emit(i.operation,new v(s,a,h))}}),e.on("vertex-remove",i=>{if(i.vertices.length===1){const{view:s}=this,a=i.vertices[0].vertexIndex,h=e.getVertexCoords();this.emit("vertex-remove",new P(s,a,h)),i.operation!=="undo"&&i.operation!=="redo"||this.emit(i.operation,new P(s,a,h))}}),e.on("cursor-update",i=>{i.vertices.length===1&&this.emit("cursor-update",new y(this.view,i.vertices[0].vertexIndex,e.getVertexCoords()))}),e.on("complete",i=>{this.emit("draw-complete",new x(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()})}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const i=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(i)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i))}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);i==null||e||this._pushCursorVertex(i.vertex,()=>this.emit("cursor-update",new y(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new H(this._stagedVertex):null)))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping();const e=new x(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};o([n()],T.prototype,"_dragEnabled",null),o([n()],T.prototype,"_clickEnabled",null),o([n({type:Y})],T.prototype,"mode",void 0),T=o([g("esri.views.draw.PolygonDrawAction")],T);const Ae=T;let f=class extends b{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=W}initialize(){this._addViewHandles(),this.view.type==="3d"&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return this.mode==="click"||this.mode==="hybrid"}get _dragEnabled(){return this.mode==="freehand"||this.mode==="hybrid"}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e;return((e=this._drawTool)==null?void 0:e.canUndo())??super.canUndo()}canRedo(){var e;return((e=this._drawTool)==null?void 0:e.canRedo())??super.canRedo()}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",e=>{const{key:i,repeat:s}=e;i!==d.vertexAdd||s?i!==d.complete||s?i!==d.undo||this.interactiveUndoDisabled||s?i!==d.redo||this.interactiveUndoDisabled||s||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))},r.TOOL)])}_addViewHandles2DOnly(){this.view.type==="2d"&&(this.addHandles([this.view.on("click",e=>{e.stopPropagation()},r.TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=c(e),e.pointerType==="touch"&&this._updateCursor())},r.TOOL),this.view.on("pointer-move",e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=c(e),e.pointerType!=="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=c(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)},r.TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return this.vertices.length===1&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const i=e.pointerType==="touch";this._updateCursor(i)}},r.TOOL),this.view.on("drag",e=>{this._dragEnabled&&this._activePointerId!=null&&!this._panEnabled&&e.stopPropagation()},r.TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},r.TOOL),this.view.on("double-click",e=>{e.stopPropagation(),this._drawCompleteHandler(e)},r.TOOL),this.view.on("double-click",["Control"],e=>{e.stopPropagation(),this._drawCompleteHandler(e)},r.TOOL),this.view.on("key-down",e=>{const{key:i,repeat:s}=e;i!==d.pan||s||(e.stopPropagation(),this._panEnabled=!0)},r.TOOL),this.view.on("key-up",e=>{e.key===d.pan&&(e.stopPropagation(),this._panEnabled=!1)},r.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",e=>{if(this.notifyChange("vertices"),e.operation==="undo"){const i=[...this._committedVertices];this._stagedVertex!=null&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new P(this.view,e.vertices[0].index,i))}}),this._editGeometryOperations.on("vertex-add",e=>{if(this.notifyChange("vertices"),e.operation==="apply"){const i=this._committedVertices.length-1,s=new v(this.view,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if(e.operation==="redo"){const i=[...this._committedVertices];this._stagedVertex!=null&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new v(this.view,e.vertices[0].index,i))}})])}_addDrawTool(){const e=new p({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",i=>{if(i.vertices.length!==1)return;const{view:s}=this,a=i.vertices[0].vertexIndex,h=e.getVertexCoords();this.emit("vertex-add",new v(s,a,h)),i.operation!=="undo"&&i.operation!=="redo"||this.emit(i.operation,new v(s,a,h))}),e.on("vertex-remove",i=>{if(i.vertices.length!==1)return;const{view:s}=this,a=i.vertices[0].vertexIndex,h=e.getVertexCoords();this.emit("vertex-remove",new P(s,a,h)),i.operation!=="undo"&&i.operation!=="redo"||this.emit(i.operation,new P(s,a,h))}),e.on("cursor-update",i=>{i.vertices.length===1&&this.emit("cursor-update",new y(this.view,i.vertices[0].vertexIndex,e.getVertexCoords()))}),e.on("complete",i=>{this.emit("draw-complete",new x(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()})])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const i=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(i)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i))}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);i==null||e||this._pushCursorVertex(i.vertex,()=>this.emit("cursor-update",new y(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new H(this._stagedVertex):null)))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping();const e=new x(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};o([n()],f.prototype,"_clickEnabled",null),o([n()],f.prototype,"_dragEnabled",null),o([n({type:Y})],f.prototype,"mode",void 0),f=o([g("esri.views.draw.PolylineDrawAction")],f);const De=f,Ie=["freehand","click"];let A=class extends b{constructor(t){super(t),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){this.view.type==="2d"?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this.mode==="click"?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",t=>{t.stopPropagation(),t.mapPoint&&!this._panEnabled&&this.getCoordsFromScreenPoint(c(t))!=null&&(this._vertexAddHandler(t),this._drawCompleteHandler(t))},r.TOOL),this.view.on("pointer-down",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=c(t),this._activePointerId=t.pointerId,this._vertexAddHandler(t),this._isDragging=!1,t.pointerType==="touch"&&this._updateCursor()))},r.TOOL),this.view.on("pointer-move",t=>{this._abortSnapping(),this._activePointerId==null&&t.pointerType!=="touch"&&(this._cursorScreenPoint=c(t),this._updateCursor())},r.TOOL),this.view.on("pointer-drag",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=c(t),this._updateCursor())},r.TOOL),this.view.on("pointer-up",t=>{this._shouldHandlePointerEvent(t)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(t),this._committedVertices.length===2&&this._drawCompleteHandler(t),this._isDragging=!1)},r.TOOL),this.view.on("key-down",t=>{t.key===d.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(t),this._drawCompleteHandler(t)):t.key===d.pan&&(this._panEnabled=!0)},r.TOOL),this.view.on("key-up",t=>{t.key===d.pan&&(this._panEnabled=!1)},r.TOOL),this.view.on("drag",t=>{this._activePointerId!=null&&t.stopPropagation()},r.TOOL),this.view.on("drag",["Shift"],t=>{t.stopPropagation()},r.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",t=>{this._abortSnapping(),this._cursorScreenPoint=c(t),this._activePointerId=t.pointerId,this._isDragging=!1,t.pointerType==="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-move",t=>{this._abortSnapping(),this._cursorScreenPoint=c(t),this._activePointerId==null&&t.pointerType!=="touch"&&this._updateCursor()},r.TOOL),this.view.on("pointer-drag",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._isDragging=!0)},r.TOOL),this.view.on("pointer-up",t=>{this._shouldHandlePointerEvent(t)&&(this._abortSnapping(),this._activePointerId=null,t.stopPropagation(),this._isDragging||this._vertexAddHandler(t),this.vertices.length!==2||this._isDragging||this._drawCompleteHandler(t),this._isDragging=!1)},r.TOOL),this.view.on("key-down",t=>{t.key===d.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(t),this.vertices.length===2&&this._drawCompleteHandler(t)),t.key===d.complete&&this._cursorScreenPoint&&this.vertices.length===2&&(this._vertexAddHandler(t),this._drawCompleteHandler(t))},r.TOOL)]}_addDrawTool(){const t=new p({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=t,this.view.addAndActivateTool(t),this.addHandles([t.on("vertex-add",e=>{e.vertices.length===1&&this.emit("vertex-add",new v(this.view,e.vertices[0].vertexIndex,t.getVertexCoords()))}),t.on("cursor-update",e=>{e.vertices.length===1&&this.emit("cursor-update",new y(this.view,e.vertices[0].vertexIndex,t.getVertexCoords()))}),t.on("complete",e=>{this.emit("draw-complete",new x(t.getVertexCoords())),this._removeDrawTool()}),this.view.on("key-down",e=>{e.key!==d.vertexAdd||e.repeat||this.mode!=="click"?e.key!==d.complete||e.repeat||t.completeCreateOperation():t.drawOperation.numCommittedVertices>0?t.completeCreateOperation():t.drawOperation.commitStagedVertex()},r.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(t){const e=this._coordinateHelper.arrayToVector(t);if(this._isDuplicateOfLastVertex(e))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(e),this._committedVertices.length===1&&(this.viewAlignedCoordinateSystem=ce(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,s=new v(this.view,i,this.vertices);this.emit("vertex-add",s)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);t!=null&&this._pushCursorVertex(t.vertex,()=>this.emit("cursor-update",new y(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new H(this._stagedVertex):null)))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new x(this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new F(new N("polygon",this._coordinateHelper),I.Local),this._activeComponent=new B(this._coordinateHelper.spatialReference,I.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};o([n({type:Ie})],A.prototype,"mode",void 0),A=o([g("esri.views.draw.SegmentDrawAction")],A);const Le=A;let C=class extends j{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,i){this.reset();const s={view:this.view,...i};switch(e){case"point":s.editGeometryType="point",this.activeAction=new Se(s);break;case"polyline":s.editGeometryType="polyline",this.activeAction=new De(s);break;case"multipoint":s.editGeometryType="polygon",this.activeAction=new be(s);break;case"polygon":s.editGeometryType="polygon",this.activeAction=new Ae(s);break;case"rectangle":case"circle":case"ellipse":case"triangle":s.editGeometryType="polygon",this.activeAction=new Le(s)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};o([n()],C.prototype,"activeAction",void 0),o([n({readOnly:!0})],C.prototype,"type",void 0),o([n()],C.prototype,"view",void 0),C=o([g("esri.views.draw.Draw")],C);const Ne=C;function ke(t,e){const i=new ue({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:e==null?void 0:e.distance,touchSensitivityMultiplier:(e==null?void 0:e.touchSensitivityMultiplier)??_e.touchSensitivityMultiplier});return{...q(()=>{var s,a;return((a=(s=t.map)==null?void 0:s.allLayers)==null?void 0:a.toArray())??[]},s=>{i.featureSources=new ve(s).map(a=>new me({layer:a}))},J),options:i}}const D=new Map;function Be(t){if(!D.has(t)){const s=ke(t,{distance:10}),a=Ee(t,s.options);D.set(t,{referenceCount:0,snappingManager:a,remove:()=>{s.remove(),a.destroy()}})}const e=D.get(t);e.referenceCount++;const i=we(()=>Ue(t,e));return{snappingManager:e.snappingManager,...i}}function Ue(t,e){e.referenceCount--,e.referenceCount>0||ye(()=>{e.referenceCount===0&&(e.remove(),D.delete(t))})}function Ee(t,e){return new ge({view:t,options:e})}let O=class extends j{constructor(e){super(e),this.tool=null,this._loggedUnsupportedErrorOnce=!1,(e==null?void 0:e.visible)!=null&&(this.visible=e.visible)}initialize(){this.addHandles(q(()=>({ready:this.view!=null&&this.view.ready,supported:this.supported}),({ready:e,supported:i})=>{!e||i||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)},J))}destroy(){this.removeTool(),this.view=null}get active(){return this.tool!=null&&this.tool.active}get disabled(){return this.view==null||!this.view.ready||!this.supported}get supported(){return this.view==null||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const i="tools";this.removeHandles(i),e!=null&&this.addHandles(e.tools.on("after-remove",s=>{s.item===this.tool&&this._set("tool",null)}),i)}set visible(e){this._set("visible",e),this.tool!=null&&(this.tool.visible=e)}createTool(e={interactive:!1}){if(this.removeTool(),this.view==null||!this.view.ready||!this.supported)return;const i=this.constructTool();i.created?(this._set("tool",i),this.view.tools.add(i)):e.interactive?(this._set("tool",i),this.view.addAndActivateTool(i),xe(()=>i.created,()=>{i.active&&this.view!=null&&(this.view.activeTool=null)},{initial:!0,once:!0})):i.destroy()}removeTool(){var s;const e=this.tool;if(e==null)return;const i=(s=this.view)==null?void 0:s.tools;i!=null?i.remove(e):e.destroy(),this._set("tool",null)}logError(...e){Oe.getLogger(this).error(...e)}};o([n({constructOnly:!0})],O.prototype,"tool",void 0),o([n()],O.prototype,"active",null),o([n()],O.prototype,"disabled",null),o([n()],O.prototype,"supported",null),o([n({value:null})],O.prototype,"view",null),o([n({type:Boolean,value:!0})],O.prototype,"visible",null),O=o([g("esri.widgets.support.InteractiveToolViewModel")],O);const L="esri-unit-select",k={base:L,label:`${L}__label`,select:`${L}__select`};let V=class extends Q{constructor(t,e){super(t,e),this._onSelectChange=i=>{this.onChange(i.target.value)}}loadDependencies(){return X({label:()=>S(()=>import("./calcite-label-C4rgJ2LW.js"),__vite__mapDeps([0,1,2]),import.meta.url),option:()=>S(()=>import("./calcite-option-CWBxYkHT.js"),__vite__mapDeps([3,1,2]),import.meta.url),select:()=>S(()=>import("./calcite-select-TIZRzkuR.js"),__vite__mapDeps([4,1,2,5,6]),import.meta.url)})}render(){const{messages:t,options:e,selectLabel:i,value:s,_onSelectChange:a}=this;return l("div",{class:k.base,key:"units"},l("calcite-label",{class:k.label},i,l("calcite-select",{class:k.select,label:i,onCalciteSelectChange:a},e.map(h=>{var M;return l("calcite-option",{key:h,selected:h===s,value:h},Ve(h)?t.systems[h]:(M=t.units[h])==null?void 0:M.pluralCapitalized)}))))}};o([n()],V.prototype,"options",void 0),o([n()],V.prototype,"onChange",void 0),o([n()],V.prototype,"selectLabel",void 0),o([n()],V.prototype,"value",void 0),o([n(),Pe("esri/core/t9n/Units")],V.prototype,"messages",void 0),V=o([g("esri.widgets.support.UnitSelect")],V);const m="esri-measurement-widget-content",w={base:m,actions:`${m}__actions`,error:`${m}__error`,hint:`${m}__hint`,hintText:`${m}__hint-text`,settings:`${m}__settings`,measurement:`${m}__measurement`,measurementItem:`${m}__measurement-item`,measurementItemDisabled:`${m}__measurement-item--disabled`,measurementItemTitle:`${m}__measurement-item__title`,measurementItemValue:`${m}__measurement-item__value`};let _=class extends Q{constructor(t,e){super(t,e)}loadDependencies(){return X({button:()=>S(()=>import("./calcite-button-DSmL_C8w.js"),__vite__mapDeps([7,1,2]),import.meta.url)})}render(){return l("div",{class:w.base},this._renderContent())}_renderContent(){const{supported:t,active:e,state:i}=this;switch(i){case"disabled":case"ready":return t?e?this._renderHint():this._renderActions():this._renderUnsupportedMessage();case"measuring":case"measured":return[this._renderSettings(),this._renderMeasurement(),this._renderActions()]}}_renderUnsupportedMessage(){return l("section",{class:w.error,key:"unsupported"},l("p",null,this.messages.unsupported))}_renderHint(){const{messages:t}=this;return l("section",{class:w.hint,key:"hint"},l("p",{class:w.hintText},t.hint))}_renderSettings(){return l("div",{class:w.settings,key:"settings"},l(V,{options:this.unitOptions,selectLabel:this.messages.unit,value:this.unit,onChange:this.onUnitChange}))}_renderMeasurement(){return l("section",{class:w.measurement,key:"measurement"},this.measurementItems.map(t=>this._renderMeasurementItem(t)))}_renderMeasurementItem({key:t,title:e,value:i}){return l("div",{class:this.classes(w.measurementItem,i==null&&w.measurementItemDisabled),key:t},l("span",{class:w.measurementItemTitle},e),l("span",{"aria-live":"polite",class:w.measurementItemValue},i??this.messages.notApplicable))}_renderActions(){const{messages:t}=this;return l("div",{class:w.actions},l("calcite-button",{class:this.newMeasurementButtonClass,disabled:this.state==="disabled",onclick:this.onNewMeasurementClick},t.newMeasurement))}};o([n()],_.prototype,"active",void 0),o([n()],_.prototype,"measurementItems",void 0),o([n()],_.prototype,"messages",void 0),o([n()],_.prototype,"newMeasurementButtonClass",void 0),o([n()],_.prototype,"onNewMeasurementClick",void 0),o([n()],_.prototype,"onUnitChange",void 0),o([n()],_.prototype,"state",void 0),o([n()],_.prototype,"supported",void 0),o([n()],_.prototype,"unit",void 0),o([n()],_.prototype,"unitOptions",void 0),_=o([g("esri.widgets.support.MeasurementWidgetContent")],_);export{Be as a,Ne as l,O as p,_ as u};
